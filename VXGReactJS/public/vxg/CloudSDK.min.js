// CloudSDK.min.js
// version: 2.0.52
// date-of-build: 181102
// copyright (c) VXG Inc

window.Log=function(e){var o=this;o.mElementID=e,o.el=document.getElementById(e),o.el&&(o.el.innerHTML='<div class="logger-line">Start</div>'),o.escape=function(e){if(void 0===e)return"undefined";"object"==typeof e&&(e=JSON.stringify(e));var o=e,r=[[/&/g,"&amp;"],[/</g,"&lt;"],[/>/g,"&gt;"],[/"/g,"&quot;"]];for(var t in r)o=o.replace(r[t][0],r[t][1]);return o},o.info=function(e){console.log(e),o.el&&(o.el.innerHTML+='<div class="logger-line info">'+o.escape(e)+"</div>")},o.error=function(e){console.error(e),o.el&&(o.el.innerHTML+='<div class="logger-line error">'+o.escape(e)+"</div>")},o.warn=function(e){console.warn(e),o.el&&(o.el.innerHTML+='<div class="logger-line warn">'+o.escape(e)+"</div>")}},window.CloudHelpers=window.CloudHelpers||{},CloudHelpers.parseUri=function(e){var o={},r=(o.source=e).split("/");o.protocol=r[0],o.protocol=o.protocol.slice(0,o.protocol.length-1),o.protocol=o.protocol.toLowerCase(),e=e.slice(o.protocol.length+3),"http"==o.protocol&&(o.port=80),"https"==o.protocol&&(o.port=443);var t=e.indexOf("/");t=-1!=t?t:e.length;var n=e.indexOf("?");n=-1!=n?n:e.length;var a=Math.min(t,n),l=e.substring(0,a);e=e.slice(a);for(var s="";-1!=l.indexOf("@");)s+=l.substring(0,l.indexOf("@")+1),l=l.slice(l.indexOf("@")+1);if(""!=s)if(-1!=s.indexOf(":")){var i=s.split(":");o.user=i[0],o.password=i[1],o.password=o.password.substring(0,o.password.length-1)}else o.user=s;if(-1!=l.indexOf(":")){var c=new RegExp(".*:(\\d+)$","g").exec(l);c&&1<c.length&&(o.port=parseInt(c[1],10),l=l.slice(0,l.length-c[1].length-1))}return o.host=l,-1!=e.indexOf("?")?(o.query=e.substring(e.indexOf("?"),e.length),o.path=e.substring(0,e.indexOf("?"))):(o.query="",o.path=e),o.path&&""!=o.path||(o.path="/"),o},CloudHelpers.parseUriTests=function(){function e(e,o,r,t){o!=r?console.error("Expected value of "+t+" '"+r+"', but got '"+o+"' in url "+e):console.log("OK")}var o=[{url:"rtsp://aaa12:hjh@1111@100.224.0.117:1024/live/strm/tracks/601?starttime=20160616T191653Z",protocol:"rtsp",port:1024,host:"100.224.0.117",user:"aaa12",password:"hjh@1111"},{url:"rtsp://100.224.0.117/live/strm/tracks/601?starttime=20160616T191653Z",host:"100.224.0.117",protocol:"rtsp"},{url:"rtsp://184.72.239.149/vod/mp4:BigBuckBunny_115k.mov",host:"184.72.239.149",protocol:"rtsp"},{url:"http://10.20.16.128:8080?source=rtmp%3A//10.20.16.128%3A1935/live/u1m14c14_primary%3Fticket%3Dmedia.eyJuIjogInUxbTE0YzE0X3ByaW1hcnkifQ.1529657953.w-ziQmsqYdfmQ1kgmVdgaHCixrI",host:"10.20.16.128",port:8080,path:"",protocol:"http"},{url:"127.0.0.1",host:"127.0.0.1",path:"",protocol:""}];for(var r in o){var t=o[r],n=CloudHelpers.parseUri(t.url);e(t.url,n.protocol,t.protocol,"protocol"),e(t.url,n.port,t.port,"port"),e(t.url,n.host,t.host,"host"),e(t.url,n.user,t.user,"user"),e(t.url,n.path,t.path,"path"),e(t.url,n.query,t.query,"query"),e(t.url,n.password,t.password,"password")}},CloudHelpers.promise=function(){var o={completed:!1,failed:!1,successed:!1,done:function(e){return o.done_callback=e,o.completed&&"function"==typeof o.done_callback&&o.successed&&o.done_callback.apply(this,o.result_arguments),o},fail:function(e){return o.fail_callback=e,o.completed&&"function"==typeof o.fail_callback&&o.failed&&o.fail_callback.apply(this,o.error_arguments),o},resolve:function(){o.completed||(o.result_arguments=arguments,"function"==typeof o.done_callback&&o.done_callback.apply(this,o.result_arguments)),o.successed=!0,o.completed=!0},reject:function(){o.completed||(o.error_arguments=arguments,"function"==typeof o.fail_callback&&o.fail_callback.apply(this,o.error_arguments)),o.failed=!0,o.completed=!0}};return o},CloudHelpers.waitPromises=function(e){var o=CloudHelpers.promise(),r=e.length,t=[];function n(e){t.push(e),t.length==r&&o.resolve(t)}for(var a in e)e[a].done(n).fail(n);return o},CloudHelpers.request=function(e){var r=CloudHelpers.promise(),t="onload"in new XMLHttpRequest?new XMLHttpRequest:new XDomainRequest;return t.open(e.type,e.url,!0),e.contentType&&t.setRequestHeader("Content-Type",e.contentType),e.token&&t.setRequestHeader("Authorization","SkyVR "+e.token),t.onload=function(){var e="";if(""!=this.responseText)try{e=JSON.parse(this.responseText)}catch(e){return console.error(e),void r.reject(CloudReturnCode.ERROR_WRONG_RESPONSE)}var o=this.status;200<=o&&o<300?r.resolve(e):r.reject(e),delete t},t.onerror=function(){r.reject(t),delete t},e.data?t.send(e.data):t.send(),r},CloudHelpers.request2=function(e){var r=CloudHelpers.promise(),t="onload"in new XMLHttpRequest?new XMLHttpRequest:new XDomainRequest;return t.open(e.type,e.url,!0),t.withCredentials=!0,e.contentType&&t.setRequestHeader("Content-Type",e.contentType),e.token&&t.setRequestHeader("Authorization","SkyVR "+e.token),e.access_token&&t.setRequestHeader("Authorization","Acc "+e.access_token),e.license_key&&t.setRequestHeader("Authorization","Lic "+e.license_key),t.onload=function(){var e="";if(""!=this.responseText)try{e=JSON.parse(this.responseText)}catch(e){return console.error(e),void r.reject(CloudReturnCode.ERROR_WRONG_RESPONSE)}var o=this.status;200<=o&&o<300?r.resolve(e):r.reject(e),delete t},t.onerror=function(){r.reject(t),delete t},e.data?t.send(e.data):t.send(),r},CloudHelpers.requestJS=function(url,beforeEval){var p=CloudHelpers.promise(),xhr="onload"in new XMLHttpRequest?new XMLHttpRequest:new XDomainRequest;return xhr.open("GET",url,!0),xhr.onload=function(){var r="";if(""!=this.responseText)try{r=this.responseText}catch(e){return console.error(e),void p.reject(CloudReturnCode.ERROR_WRONG_RESPONSE)}var st=this.status;200<=st&&st<300?(beforeEval&&(r=beforeEval(r)),eval(r),p.resolve(r)):p.reject(r),delete xhr},xhr.onerror=function(){p.reject(xhr),delete xhr},xhr.send(),p},CloudHelpers.handleError=function(e,o,r){e.errorDetail&&404==e.status?o.reject(CloudReturnCode.ERROR_NOT_FOUND):e.errorDetail&&401==e.status?o.reject(CloudReturnCode.ERROR_NOT_AUTHORIZED):r?r(e,o):o.reject(e)},CloudHelpers.requestAsyncList=function(t,n,a){var l={meta:{limit:1e3,offset:0,total_count:-1},objects:[]};n.limit=l.meta.limit,n.offset=l.meta.offset,t(n).fail(function(e){a.reject(e)}).done(function(e){if(l.meta.total_count=e.meta.total_count,l.objects=l.objects.concat(e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)a.resolve(l);else{for(var o=[],r=l.meta.limit;r<l.meta.total_count;r+=l.meta.limit)n.offset=r,o.push(t(n));CloudHelpers.waitPromises(o).done(function(e){for(var o=0;o<e.length;o++)l.objects=l.objects.concat(e[o].objects);a.resolve(l)}).fail(function(e){a.reject(e)})}})},CloudHelpers.flashVersion=void 0,CloudHelpers.getFlashVersion=function(){try{try{var e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");try{e.AllowScriptAccess="always"}catch(e){return"6,0,0"}}catch(e){}return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(e){try{if(navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(e){}}return"0,0,0"},CloudHelpers.supportFlash=function(){return CloudHelpers.flashVersion||(CloudHelpers.flashVersion=CloudHelpers.getFlashVersion()),"0,0,0"!=CloudHelpers.flashVersion},CloudHelpers.useHls=function(){return CloudHelpers.isMobile()||!CloudHelpers.supportFlash()||CloudHelpers.containsPageParam("hls")},CloudHelpers.supportWebRTC=function(){return!!(window.mozRTCPeerConnection||window.webkitRTCPeerConnection||window.RTCPeerConnection)},CloudHelpers.mapToUrlQuery=function(e){if(!e)return"";var o=[];for(var r in e)o.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return o.join("&")},CloudHelpers.lang=function(){return CloudHelpers.sLang||CloudHelpers.locale()},CloudHelpers.locale=function(){if(langs=["en","ko","ru"],CloudHelpers.sLang="en",CloudHelpers.containsPageParam("lang")&&-1<=langs.indexOf(CloudHelpers.pageParams.lang))CloudHelpers.sLang=CloudHelpers.pageParams.lang;else if(navigator){var e="en";e=navigator.language?navigator.language.substring(0,2):e,e=navigator.browserLanguage?navigator.browserLanguage.substring(0,2):e,e=navigator.systemLanguage?navigator.systemLanguage.substring(0,2):e,e=navigator.userLanguage?navigator.userLanguage.substring(0,2):e,-1<=langs.indexOf(e)?CloudHelpers.sLang=e:console.warn("Unsupported lang "+e+", will be used default lang: "+CloudHelpers.sLang),CloudHelpers.sLang=-1<=langs.indexOf(e)?e:CloudHelpers.sLang}else CloudHelpers.sLang="en";return CloudHelpers.sLang},CloudHelpers.parsePageParams=function(){for(var e=window.location.search.slice(1).split("&"),o={},r=new RegExp("(.*)=([^&#]*)"),t=0;t<e.length;t++)""!=e[t].trim()&&(p=r.exec(e[t].trim()),null==p?o[decodeURIComponent(e[t].trim().replace(/\+/g," "))]="":o[decodeURIComponent(p[1].replace(/\+/g," "))]=decodeURIComponent(p[2].replace(/\+/g," ")));return o},CloudHelpers.pageParams=CloudHelpers.parsePageParams(),CloudHelpers.containsPageParam=function(e){return void 0!==CloudHelpers.pageParams[e]},CloudHelpers.keepParams=["lang","url","fcno","vendor","demo","messaging","hls","svcp_host","backwardDeactivateAfter","mobile","experimental_hls","page_id","preview","customswf"],CloudHelpers.changeLocationState=function(e){var o=[];for(var r in CloudHelpers.keepParams){var t=CloudHelpers.keepParams[r];CloudHelpers.containsPageParam(t)&&o.push(t+"="+encodeURIComponent(CloudHelpers.pageParams[t]))}for(var n in e)o.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));var a=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+o.join("&");try{window.history.pushState?window.history.pushState(e,document.title,a):console.error("window.history.pushState - function not found")}catch(e){console.error("changeLocationState: Could not change location to "+a)}CloudHelpers.pagePwindow.btoa("Hello, world"),arams=CloudHelpers.parsePageParams()},CloudHelpers.osname=function(){var e="unknown";return-1!=navigator.appVersion.indexOf("Win")&&(e="win"),-1!=navigator.appVersion.indexOf("Mac")&&(e="mac"),-1!=navigator.appVersion.indexOf("X11")&&(e="unix"),-1!=navigator.appVersion.indexOf("Linux")&&(e="linux"),e},CloudHelpers.isSafari=function(){var e=-1<window.navigator.userAgent.toLowerCase().indexOf("chrome"),o=-1<window.navigator.userAgent.toLowerCase().indexOf("safari");return!e&&o},CloudHelpers.isEdge=function(){return-1<window.navigator.userAgent.indexOf("Edge")},CloudHelpers.isChrome=function(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)},CloudHelpers.isMobile=function(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))},CloudHelpers.isIpV4=function(e){return null!=e.match(/^([0-9]{1,3}\.){3}[0-9]{1,3}/)},CloudHelpers.parseUTCTime=function(e){var o=(e=(e=(e=e.replace(new RegExp("-","g")," ")).replace(new RegExp("T","g")," ")).replace(new RegExp(":","g")," ")).split(" "),r=new Date;r.setUTCFullYear(parseInt(o[0],10)),r.setUTCMonth(parseInt(o[1],10)-1),r.setUTCDate(parseInt(o[2],10)),r.setUTCHours(parseInt(o[3],10)),r.setUTCMinutes(parseInt(o[4],10)),r.setUTCSeconds(parseInt(o[5],10));var t=r.getTime();return t-=t%1e3},CloudHelpers.formatUTCTime=function(e){var o=new Date;return o.setTime(e),o.getUTCFullYear()+"-"+("00"+(o.getUTCMonth()+1)).slice(-2)+"-"+("00"+o.getUTCDate()).slice(-2)+"T"+("00"+o.getUTCHours()).slice(-2)+":"+("00"+o.getUTCMinutes()).slice(-2)+":"+("00"+o.getUTCSeconds()).slice(-2)},CloudHelpers.ONE_SECOND=1e3,CloudHelpers.ONE_MINUTE=6e4,CloudHelpers.ONE_HOUR=36e5,CloudHelpers.getCurrentTimeUTC=function(){return Date.now()},CloudHelpers.isLocalFile=function(){return"https:"!=window.location.protocol&&"http:"!=window.location.protocol},CloudHelpers.combineURL=function(e,o,r){""==o&&(o=void 0),""==r&&(r=void 0);var t=CloudHelpers.parseUri(e),n=t.protocol+"://";return(o||r)&&(n+=o,r&&(n+=":"+r),n+="@"),n+=t.host+(""!=t.port?":"+t.port:"")+t.path},CloudHelpers.validIpV4=function(e){for(var o=e.split("."),r=0;r<4;r++){var t=parseInt(o[r],10);if(t<0||255<t)return!1}return!0},CloudHelpers.convertIpV4ToInt=function(e){for(var o=e.split("."),r=0,t=1,n=3;0<=n;n--)r+=parseInt(o[n],10)*t,t*=256;return r},CloudHelpers.isValidHostID=function(e){var o=CloudHelpers.parseUri(e);return"localhost"==o.host||(!(CloudHelpers.isIpV4(o.host)&&!CloudHelpers.validIpV4(o.host))||(console.error("Address "+o.host+" - invalid address"),!1))},CloudHelpers.isLocalUrlOrIP=function(e){var o=CloudHelpers.parseUri(e);if("localhost"==o.host)return!0;if(CloudHelpers.isIpV4(o.host)){if(!CloudHelpers.validIpV4(o.host))return console.error("Address "+o.host+" - invalid address"),!0;var r=CloudHelpers.convertIpV4ToInt(o.host),t=[];for(var n in t.push({from:"127.0.0.0",to:"127.255.255.255",comment:"localhost addresses"}),t){var a=CloudHelpers.convertIpV4ToInt(t[n].from),l=CloudHelpers.convertIpV4ToInt(t[n].to),s=t[n].comment;if(a<=r&&r<=l)return console.error(s),!0}}return!1},CloudHelpers.isPublicUrl=function(e){var o=CloudHelpers.parseUri(e);if("localhost"==o.host)return!1;if(CloudHelpers.isIpV4(o.host)){if(!CloudHelpers.validIpV4(o.host))return console.error("Address "+o.host+" - invalid address"),!1;var r=CloudHelpers.convertIpV4ToInt(o.host),t=[];for(var n in t.push({from:"10.0.0.0",to:"10.255.255.255",comment:"single class A network"}),t.push({from:"172.16.0.0",to:"172.31.255.255",comment:"16 contiguous class B network"}),t.push({from:"192.168.0.0",to:"192.168.255.255",comment:"256 contiguous class C network"}),t.push({from:"169.254.0.0",to:"169.254.255.255",comment:"Link-local address also refered to as Automatic Private IP Addressing"}),t.push({from:"127.0.0.0",to:"127.255.255.255",comment:"localhost addresses"}),t){var a=CloudHelpers.convertIpV4ToInt(t[n].from),l=CloudHelpers.convertIpV4ToInt(t[n].to),s=t[n].comment;if(a<=r&&r<=l)return console.error(s),!1}}return!0},CloudHelpers.isFrame=function(){try{return window.self!==window.top}catch(e){return!0}},CloudHelpers.isFireFox=function(){return-1<navigator.userAgent.toLowerCase().indexOf("firefox")},CloudHelpers.isAndroid=function(){return!!navigator.userAgent.match(/Android/i)},CloudHelpers.isIOS=function(){return!!(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))},CloudHelpers.isWindowsPhone=function(){return!!navigator.userAgent.match(/Windows Phone/i)},CloudHelpers.isBlackBerry=function(){return!!navigator.userAgent.match(/BlackBerry/i)},CloudHelpers.splitUserInfoFromURL=function(e){var o=CloudHelpers.parseUri(e);return{url:o.protocol+"://"+o.host+(o.port?":"+o.port:"")+o.path,login:o.user,password:o.password}},CloudHelpers.getAbsolutePosition=function(e){var o={x:e.offsetLeft,y:e.offsetTop};if(e.offsetParent){var r=CloudHelpers.getAbsolutePosition(e.offsetParent);o.x+=r.x,o.y+=r.y}return o},CloudHelpers.cache=CloudHelpers.cache||{},CloudHelpers.cache.timezones=CloudHelpers.cache.timezones||{},CloudHelpers.getOffsetTimezone=function(e){if(!moment)return console.warn("Requrired moment.js library"),0;if(null==CloudHelpers.cache.timezones[e]){var o=new Date;if(e&&""!=e){var r=moment(o).tz(e).format("Z"),t=r[0];(t<"0"||"9"<t)&&(r=r.substring(1));var n="-"==t?-1:1,a=r.split(":");r=n*(60*parseInt(a[0],10)+parseInt(a[1],10)),CloudHelpers.cache.timezones[e]=6e4*r}else CloudHelpers.cache.timezones[e]=0}return CloudHelpers.cache.timezones[e]},Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},CloudHelpers.autoPlayAllowed=!0,CloudHelpers.checkAutoplay=function(){var e=document.createElement("video").play();null!=window.Promise&&e instanceof Promise&&e.catch(function(e){if(console.error("error:",e),"NotAllowedError"!=e.name)throw e;console.error("error.name:","NotAllowedError"),CloudHelpers.autoPlayAllowed=!1}).then(function(){CloudHelpers.autoPlayAllowed?console.log("checkAutoplay: Allowed"):console.log("checkAutoplay: Not allowed")})},CloudHelpers.checkAutoplay(),CloudHelpers.humanFileSize=function(e){if(e<1024)return e+" B";for(var o=-1;++o,1024<=(e/=1024););return e.toFixed(1)+" "+["kB","MB","GB","TB","PB","EB","ZB","YB"][o]},CloudHelpers.base64_encode=function(e){return window.btoa(e)},CloudHelpers.base64_decode=function(e){return window.atob(e)},CloudHelpers.copy=function(e){if(null==e||"object"!=typeof e)return console.error("Expected object"),e;var o=e.constructor();for(var r in e)e.hasOwnProperty(r)&&(o[r]=e[r]);return o},CloudHelpers.unpackAccessToken=function(e){var o={host:"web.skyvr.videoexpertsgroup.com"};try{var r=atob(e);if(r=JSON.parse(r),console.log("Token: ",r),!r.token)return console.error('Invalid access token format (missing "token")'),null;if(!r.access)return console.error('Invalid access token format (missing "access")'),null;r.token&&r.camid&&r.access&&""!==r.token&&""!==r.camid&&""!==r.access&&(o.share_token=r.token,o.camid=r.camid,o.access=r.access),r.api&&(o.host=r.api),r.api_p&&(o.api_port=r.api_p),r.api_security_port&&(o.api_security_port=r.api_security_port)}catch(e){return console.error("Invalid access token format"),null}if(o.base_url=o.host,"web.skyvr.videoexpertsgroup.com"==o.host)o.base_url="https://"+o.host;else if("https:"===location.protocol)o.base_url="https://"+o.host,null!=o.api_secutiry_port?(o.base_url+=":"+o.api_secutiry_port,o.port=o.api_secutiry_port):o.port=443;else{if("http:"!==location.protocol)return console.error("Invalid protocol"),null;o.base_url="http://"+o.host,null!=self.api_port?(o.base_url+=":"+o.api_port,o.port=o.api_port):o.port=80}return o},window.CloudAPI=function(e,o){var l=this;l.token=e.token,l.token_expire=e.expire,l.token_expireUTC=Date.parse(e.expire+"Z"),l.host=o,l.token_type=e.type,l.isShareToken=function(){return"share"==l.token_type},l.endpoints={api:l.host+"api/v2/",cameras:l.host+"api/v2/cameras/",admin_cameras:l.host+"api/v2/admin/cameras/",camsess:l.host+"api/v2/camsess/",server:l.host+"api/v2/server/",account:l.host+"api/v2/account/",cmngrs:l.host+"api/v2/cmngrs/",storage:l.host+"api/v2/storage/",clips:l.host+"api/v2/storage/clips/",channels:l.host+"api/v3/channels/"},l.endpoints_v4={api:l.host+"api/v4/",live_watch:l.host+"api/v4/live/watch/"},l._getCloudToken=function(){return l.token},l.updateApiToken=function(){return CloudHelpers.request({url:l.endpoints.account+"token/api/",type:"GET",token:l._getCloudToken()})},l.isShareToken()||l.updateApiToken().done(function(e){console.warn("[CloudConnection] Cloud Token Api refreshed"),l.token=e.token,l.token_expire=e.expire,l.token_expireUTC=Date.parse(e.expire+"Z"),clearInterval(l.updateTokenInterval),l.updateTokenInterval=setInterval(function(){l.token_expireUTC-(new Date).getTime()<12e5?l.updateApiToken().done(function(e){console.warn("[CloudConnection] Cloud Token api refreshed"),l.token=e.token,l.token_expire=e.expire,l.token_expireUTC=Date.parse(e.expire+"Z")}):console.log("[CloudConnection] Cloud Token is live")},3e5)}),l.dispose=function(){l.token=null,clearInterval(l.updateTokenInterval)},l.createCamera=function(e){return CloudHelpers.request({url:l.endpoints.cameras+"?detail=detail",type:"POST",token:l._getCloudToken(),data:JSON.stringify(e),contentType:"application/json"})},l.camerasList=function(e){e=e||{},l.isShareToken()&&(e.token=l._getCloudToken());var o=CloudHelpers.mapToUrlQuery(e);return CloudHelpers.request({url:l.endpoints.cameras+"?"+o,type:"GET",token:l._getCloudToken(),contentType:"application/json"})},l.getCameraList=l.camerasList,l.deleteCamera=function(e){return CloudHelpers.request({url:l.endpoints.cameras+e+"/",type:"DELETE",token:l._getCloudToken()})},l.getCamera=function(e,o){(o=o||{}).detail="detail",l.isShareToken()&&(o.token=l._getCloudToken());var r=CloudHelpers.mapToUrlQuery(o);return CloudHelpers.request({url:l.endpoints.cameras+e+"/?"+r,type:"GET",token:l._getCloudToken()})},l.getCamera2=function(e,o){o=o||{},l.isShareToken()&&(o.token=l._getCloudToken());var r=CloudHelpers.mapToUrlQuery(o);return CloudHelpers.request({url:l.endpoints.cameras+e+"/?"+r,type:"GET",token:l._getCloudToken()})},l.cameraUsage=function(e){return CloudHelpers.request({url:l.endpoints.cameras+e+"/usage/",type:"GET",token:l._getCloudToken()})},l.updateCamera=function(e,o){o=o||{},l.isShareToken()&&(o.token=l._getCloudToken());var r=CloudHelpers.mapToUrlQuery(o);return CloudHelpers.request({url:l.endpoints.cameras+e+"/?"+r,type:"PUT",token:l._getCloudToken(),data:JSON.stringify(o),contentType:"application/json"})},l.cameraLiveUrls=function(e){var o={},r=l.endpoints.cameras+e+"/live_urls/?media_urls=webrtc&";l.isShareToken()&&(o.token=l._getCloudToken(),o.media_urls="webrtc",r=l.endpoints_v4.live_watch+"?");var t=CloudHelpers.mapToUrlQuery(o);return CloudHelpers.request({url:r+t,type:"GET",token:l._getCloudToken(),data:JSON.stringify(o)})},l.cameraStreamUrls_webrtc=function(e){var o={},r=l.endpoints.cameras+e+"/stream_urls/?";o.proto="webrtc",l.isShareToken()&&(o.token=l._getCloudToken());var t=CloudHelpers.mapToUrlQuery(o);return CloudHelpers.request({url:r+t,type:"GET",token:l._getCloudToken(),data:JSON.stringify(o)})},l.getServerTime=function(){var r=CloudHelpers.promise();return CloudHelpers.request({url:l.endpoints.api+"server/time/",type:"GET"}).done(function(e){var o=CloudHelpers.getCurrentTimeUTC();l.diffServerTime=Date.parse(e.utc+"Z")-o,r.resolve(e)}).fail(function(e){r.reject(e)}),r},l.getAccountInfo=function(){return CloudHelpers.request({url:l.endpoints.account,type:"GET",token:l._getCloudToken()})},l.getAccountCapabilities=function(){return CloudHelpers.request({url:l.endpoints.account+"capabilities/",type:"GET",token:l._getCloudToken()})},l.cameraMediaStreams=function(e){return CloudHelpers.request({url:l.endpoints.cameras+e+"/media_streams/",type:"GET",token:l._getCloudToken()})},l.updateCameraMediaStreams=function(e,o){return CloudHelpers.request({url:l.endpoints.cameras+e+"/media_streams/",type:"PUT",data:JSON.stringify(o),contentType:"application/json",token:l._getCloudToken()})},l.cameraPreview=function(e){var o={};l.isShareToken()&&(o.token=l._getCloudToken());var r=CloudHelpers.mapToUrlQuery(o);return CloudHelpers.request({url:l.endpoints.cameras+e+"/preview/?"+r,type:"GET",token:l._getCloudToken()})},l.cameraUpdatePreview=function(e){return CloudHelpers.request({url:l.endpoints.cameras+e+"/preview/update/",type:"POST",token:l._getCloudToken()})},l.storageRecords=function(e,o,r){var t=CloudHelpers.promise(),n={camid:e,limit:1e3,offset:0,start:o};return r&&(n.end=r),l.isShareToken()&&(n.token=l._getCloudToken()),CloudHelpers.requestAsyncList(function(e){var o=CloudHelpers.mapToUrlQuery(e);return CloudHelpers.request({url:l.endpoints.storage+"data/?"+o,type:"GET",token:l._getCloudToken()})},n,t),t},l.storageRecordsFirst=function(e,o,r){CloudHelpers.promise();var t={camid:e,limit:r,offset:0,start:o};t.limit=r,l.isShareToken()&&(t.token=l._getCloudToken());var n=CloudHelpers.mapToUrlQuery(t);return CloudHelpers.request({url:l.endpoints.storage+"data/?"+n,type:"GET",token:l._getCloudToken()})},l.storageTimeline=function(e,o,r,t){var n={start:o,end:r,slices:t};l.isShareToken()&&(n.token=l._getCloudToken());var a=CloudHelpers.mapToUrlQuery(n);return CloudHelpers.request({url:l.endpoints.storage+"timeline/"+e+"/?"+a,type:"GET",token:l._getCloudToken()})},l.storageActivity=function(e,o){var r={camid:e};o&&(r.daysincamtz=""),l.isShareToken()&&(r.token=l._getCloudToken());var t=CloudHelpers.mapToUrlQuery(r);return CloudHelpers.request({url:l.endpoints.storage+"activity/?"+t,type:"GET",token:l._getCloudToken()})},l.resetCameraManager=function(e,o){return l.isShareToken()?(o=o||{},CloudHelpers.request({url:l.endpoints.cmngrs+e+"/reset/?token="+l._getCloudToken(),type:"POST",data:JSON.stringify(o),contentType:"application/json"})):(o=o||{},CloudHelpers.request({url:l.endpoints.cmngrs+e+"/reset/",type:"POST",token:l._getCloudToken(),data:JSON.stringify(o),contentType:"application/json"}))},l.updateCameraManager=function(e,o){return o=o||{},CloudHelpers.request({url:l.endpoints.cmngrs+e+"/",type:"PUT",token:l._getCloudToken(),data:JSON.stringify(o),contentType:"application/json"})},l.getCamsessList=function(e){var o=CloudHelpers.mapToUrlQuery(e);return CloudHelpers.request({url:l.endpoints.camsess+"?"+o,type:"GET",token:l._getCloudToken(),contentType:"application/json"})},l.getCamsess=function(e){return CloudHelpers.request({url:l.endpoints.camsess+e+"/?detail=detail",type:"GET",token:l._getCloudToken(),contentType:"application/json"})},l.getCamsessRecords=function(e){return CloudHelpers.request({url:l.endpoints.camsess+e+"/records/",type:"GET",token:l._getCloudToken(),contentType:"application/json"})},l.deleteCamsess=function(e){return CloudHelpers.request({url:l.endpoints.camsess+e+"/",type:"DELETE",token:l._getCloudToken()})},l.creareCameraSharingToken=function(e,o,r){return o=o||"",CloudHelpers.request({url:l.endpoints.cameras+e+"/sharings/",type:"POST",data:JSON.stringify({camid:e,name:o,access:r}),contentType:"application/json",token:l._getCloudToken()})},l.updateCameraSharingToken=function(e,o,r){return(r=r||{}).camid=e,r.shid=o,CloudHelpers.request({url:l.endpoints.cameras+e+"/sharings/"+o+"/",type:"PUT",data:JSON.stringify(r),contentType:"application/json",token:l._getCloudToken()})},l.getCameraSharingTokensList=function(e){return CloudHelpers.request({url:l.endpoints.cameras+e+"/sharings/?detail=detail",type:"GET",token:l._getCloudToken()})},l.deleteCameraSharingToken=function(e,o){return CloudHelpers.request({url:l.endpoints.cameras+e+"/sharings/"+o+"/",type:"DELETE",token:l._getCloudToken()})},l.getChannels=function(){return CloudHelpers.request({url:l.endpoints.channels,type:"GET",token:l._getCloudToken()})},l.getCameraStreamingURLs=function(e){return CloudHelpers.request({url:l.endpoints.cameras+e+"/stream_urls/",type:"GET",token:l._getCloudToken()})}},window.SkyVR=window.CloudAPI,CloudAPI.config={url:"",url_cameras:"",url_api:"",cameraID:"",user_name:"",vendor:""},CloudAPI.setToCookie=function(e,o){var r=new Date((new Date).getTime()+6048e5);document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(o)+"; path=/; expires="+r.toUTCString()},CloudAPI.getFromCookie=function(e){var o=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return o?decodeURIComponent(o[1]):""},CloudAPI.removeFromCookie=function(e){document.cookie=encodeURIComponent(e)+"=; path=/;"},CloudAPI.cache={cameras:{},timezones:{}},CloudAPI.cache.cameraInfo=function(e){return e?CloudAPI.cache.cameras[e]:CloudAPI.isCameraID()?CloudAPI.cache.cameras[CloudAPI.cameraID()]:void 0},CloudAPI.cache.getCameraInfo=CloudAPI.cache.cameraInfo,CloudAPI.cache.mergeObjects=function(e,o){for(var r in o){var t=typeof o[r];"boolean"==t||"string"==t||"number"==t?e[r]!=o[r]&&(e[r]&&(console.log("Changed "+r),CloudAPI.events.trigger("CAMERA_INFO_CHANGED",{name:r,new_value:o[r]})),e[r]=o[r]):Array.isArray(o[r])?e[r]=o[r]:"object"==t&&(e[r]||(e[r]={}),e[r]=CloudAPI.cache.mergeObjects(e[r],o[r]))}return e},CloudAPI.cache.updateCameraInfo=function(e){var o=e.id;CloudAPI.cache.cameras[o]||(CloudAPI.cache.cameras[o]={}),CloudAPI.cache.cameras[o]=CloudAPI.cache.mergeObjects(CloudAPI.cache.cameras[o],e)},CloudAPI.cache.setCameraInfo=function(e){var o=e.id;null==CloudAPI.cache.cameras[o]&&(CloudAPI.cache.cameras[o]={});var r=!(!e.p2p_streaming||1!=e.p2p_streaming),t=CloudAPI.cache.cameras[o];return CloudAPI.cache.cameras[o]=CloudAPI.cache.mergeObjects(t,e),CloudAPI.cache.cameras[o].lastTimeUpdated=Date.now(),r},CloudAPI.cache.setP2PSettings=function(e,o){null==CloudAPI.cache.cameras[e]&&(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].p2p=o,CloudAPI.cache.cameras[e].p2p_settings=CloudAPI.cache.cameras[e].p2p},CloudAPI.cache.setMemoryCard=function(e,o){null==CloudAPI.cache.cameras[e]&&(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].memory_card=o},CloudAPI.cache.setPtzCaps=function(e,o){null==CloudAPI.cache.cameras[e]&&(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].ptz=o},CloudAPI.cache.updateCameraAudio=function(e,o){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].audio||(CloudAPI.cache.cameras[e].audio={}),CloudAPI.cache.cameras[e].audio=CloudAPI.cache.mergeObjects(CloudAPI.cache.cameras[e].audio,o)},CloudAPI.cache.cameraAudio=function(e){return e=e||CloudAPI.cameraID(),CloudAPI.cache.cameras[e]?CloudAPI.cache.cameras[e].audio:{}},CloudAPI.cache.updateCameraVideo=function(e,o){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].video||(CloudAPI.cache.cameras[e].video={});var r=CloudAPI.cache.cameras[e].video;CloudAPI.cache.cameras[e].video=CloudAPI.cache.mergeObjects(r,o)},CloudAPI.cache.cameraVideo=function(e){return e=e||CloudAPI.cameraID(),CloudAPI.cache.cameras[e]?CloudAPI.cache.cameras[e].video:{}},CloudAPI.cache.cameraVideoStreamName=function(e){if(e=e||CloudAPI.cameraID(),!CloudAPI.cache.cameras[e])return{};var o=CloudAPI.cache.cameras[e].video;if(o.streams)for(var r in o.streams)return r},CloudAPI.cache.cameraVideoStreams=function(e){if(e=e||CloudAPI.cameraID(),!CloudAPI.cache.cameras[e])return{};var o=CloudAPI.cache.cameras[e].video;return o.streams?o.streams:void 0},CloudAPI.cache.setLimits=function(e,o){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].limits=o},CloudAPI.cache.updateCameraVideoStream=function(e,o,r){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].video||(CloudAPI.cache.cameras[e].video={}),CloudAPI.cache.cameras[e].video.streams||(CloudAPI.cache.cameras[e].video.streams={}),CloudAPI.cache.cameras[e].video.streams[o]||(CloudAPI.cache.cameras[e].video.streams[o]={});var t=CloudAPI.cache.cameras[e].video.streams[o];CloudAPI.cache.cameras[e].video.streams[o]=CloudAPI.cache.mergeObjects(t,r)},CloudAPI.cache.setAudioStream=function(e,o,r){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].audio||(CloudAPI.cache.cameras[e].audio={}),CloudAPI.cache.cameras[e].audio.streams||(CloudAPI.cache.cameras[e].audio.streams={}),CloudAPI.cache.cameras[e].audio.streams[o]=r},CloudAPI.cache.setMediaStreams=function(e,o){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].media_streams=o},CloudAPI.cache.updateEventProcessingEventsMotion=function(e,o){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].event_processing||(CloudAPI.cache.cameras[e].event_processing={}),CloudAPI.cache.cameras[e].event_processing.events||(CloudAPI.cache.cameras[e].event_processing.events={}),CloudAPI.cache.cameras[e].event_processing.events.motion||(CloudAPI.cache.cameras[e].event_processing.events.motion={});var r=CloudAPI.cache.cameras[e].event_processing.events.motion;CloudAPI.cache.cameras[e].event_processing.events.motion=CloudAPI.cache.mergeObjects(r,o)},CloudAPI.cache.updateCameraEventProcessingEventsSound=function(e,o){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].event_processing||(CloudAPI.cache.cameras[e].event_processing={}),CloudAPI.cache.cameras[e].event_processing.events||(CloudAPI.cache.cameras[e].event_processing.events={}),CloudAPI.cache.cameras[e].event_processing.events.sound||(CloudAPI.cache.cameras[e].event_processing.events.sound={});var r=CloudAPI.cache.cameras[e].event_processing.events.sound;CloudAPI.cache.cameras[e].event_processing.events.sound=CloudAPI.cache.mergeObjects(r,o)},CloudAPI.generateNewLocation=function(e){var o=[];return CloudHelpers.containsPageParam("lang")&&o.push("lang="+encodeURIComponent(CloudAPI.pageParams.lang)),CloudHelpers.containsPageParam("vendor")&&o.push("vendor="+encodeURIComponent(CloudAPI.pageParams.vendor)),CloudHelpers.containsPageParam("mobile")&&o.push("mobile="+encodeURIComponent(CloudAPI.pageParams.mobile)),o.push("p="+encodeURIComponent(e)),"?"+o.join("&")},CloudAPI.setURL=function(e){if(CloudAPI.config.url!=e){CloudAPI.config.url=e,CloudAPI.config.url_api=e+"api/v2/",CloudAPI.config.url_cameras=e+"api/v2/cameras/",CloudAPI.config.url_admin_cameras=e+"api/v2/admin/cameras/",CloudAPI.config.url_camsess=e+"api/v2/camsess/",CloudAPI.config.url_server=e+"api/v2/server/",CloudAPI.config.url_account=e+"api/v2/account/",CloudAPI.config.url_cmngrs=e+"api/v2/cmngrs/",CloudAPI.config.url_storage=e+"api/v2/storage/",CloudAPI.config.url_clips=e+"api/v2/storage/clips/",CloudAPI.config.anonToken={token:"",type:"anon",expire:"",expireTimeUTC:0},localStorage.getItem("SkyVR_anonToken")&&(CloudAPI.config.anonToken=JSON.parse(localStorage.getItem("SkyVR_anonToken"))),CloudAPI.config.apiToken={token:"",type:"api",expire:"",expireTimeUTC:0},CloudAPI.config.shareToken={};var o=CloudAPI.getFromStorage("SkyVR_apiToken");if(o){var r=JSON.parse(o);r.expireTimeUTC>Date.now()&&(CloudAPI.config.apiToken=r)}CloudAPI.setToStorage("CloudAPI_svcp_host",e)}},CloudAPI.isExpiredApiToken=function(){return!CloudAPI.config.apiToken.expireTimeUTC||!(CloudAPI.config.apiToken.expireTimeUTC>Date.now())},CloudAPI.applyApiToken=function(){$.ajaxSetup({crossDomain:!0,cache:!1,beforeSend:function(e,o){CloudAPI.config.apiToken&&CloudAPI.config.apiToken.token&&e.setRequestHeader("Authorization","SkyVR "+CloudAPI.config.apiToken.token)}})},CloudAPI.enable401handler=function(){},CloudAPI.disable401handler=function(){$.ajaxSetup({error:function(e,o,r){}})},CloudAPI.printStack=function(){var e=new Error;console.error(e.stack)},CloudAPI.PAGE_SIGNIN="signin",CloudAPI.hasAccess=function(e,o){if(SkyUI.isDemo())return!0;if(!e)return!1;if(!e.access)return!0;var r=!1;for(var t in e.access)e.access[t]==o&&(r=!0);return r},CloudAPI.hasAccessSettings=function(e){return!!SkyUI.isDemo()||(e=e||CloudAPI.cache.cameraInfo(),CloudAPI.hasAccess(e,"all"))},CloudAPI.hasAccessMotionDetection=function(e){return!!SkyUI.isDemo()||(e=e||CloudAPI.cache.cameraInfo(),CloudAPI.hasAccess(e,"all")||CloudAPI.hasAccess(e,"ptz"))},CloudAPI.hasAccessClips=function(e){return!!SkyUI.isDemo()||(e=e||CloudAPI.cache.cameraInfo(),CloudAPI.hasAccess(e,"clipping")||CloudAPI.hasAccess(e,"clipplay")||CloudAPI.hasAccess(e,"watch")||CloudAPI.hasAccess(e,"cplay")||CloudAPI.hasAccess(e,"all"))},CloudAPI.hasAccessLive=function(e){return!!SkyUI.isDemo()||(e=e||CloudAPI.cache.cameraInfo(),CloudAPI.hasAccess(e,"ptz")||CloudAPI.hasAccess(e,"live")||CloudAPI.hasAccess(e,"watch")||CloudAPI.hasAccess(e,"all"))},CloudAPI.hasAccessPlayback=function(e){return!!SkyUI.isDemo()||(e=e||CloudAPI.cache.cameraInfo(),CloudAPI.hasAccess(e,"clipping")||CloudAPI.hasAccess(e,"play")||CloudAPI.hasAccess(e,"watch")||CloudAPI.hasAccess(e,"splay")||CloudAPI.hasAccess(e,"all"))},CloudAPI.hasAccessMakeClip=function(e){return!!SkyUI.isDemo()||(e=e||CloudAPI.cache.cameraInfo(),CloudAPI.hasAccess(e,"clipping")||CloudAPI.hasAccess(e,"all"))},CloudAPI.hasAccessBackAudio=function(e){return!!SkyUI.isDemo()||(e=e||CloudAPI.cache.cameraInfo(),CloudAPI.hasAccess(e,"all")||CloudAPI.hasAccess(e,"backaudio"))},CloudAPI.handleNothing=function(e){},CloudAPI.handleNothingError=function(e,o,r){},CloudAPI.handleError=function(e,o,r){console.error(r)},CloudAPI.parseUri=function(e){function a(e){for(var t=a.options,o=t.parser[t.strictMode?"strict":"loose"].exec(e),n={},r=14;r--;)n[t.key[r]]=o[r]||"";return n[t.q.name]={},n[t.key[12]].replace(t.q.parser,function(e,o,r){o&&(n[t.q.name][o]=r)}),n}return a.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},a(e)},CloudAPI.logout=function(e){$.ajax({url:CloudAPI.config.url_account+"logout/",type:"POST",success:e,error:CloudAPI.handleError})},CloudAPI.cameraVideoStream=function(o){var r=$.Deferred();if(!CloudAPI.isCameraID())return r.reject(),r;var t=CloudAPI.config.cameraID;return $.ajax({url:CloudAPI.config.url_cameras+t+"/video/streams/"+o+"/",type:"GET"}).done(function(e){CloudAPI.cache.updateCameraVideoStream(t,o,e),r.resolve(e)}).fail(function(){r.reject()}),r},CloudAPI.cameraLimits=function(){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var e=CloudAPI.config.cameraID;return $.ajax({url:CloudAPI.config.url_cameras+e+"/limits/",type:"GET"}).done(function(e){CloudAPI.cache.setLimits(CloudAPI.cameraID(),e),o.resolve(e)}).fail(function(){o.reject()}),o},CloudAPI.cameraEventProcessingEventsMotion=function(){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var r=CloudAPI.config.cameraID;return $.ajax({url:CloudAPI.config.url_cameras+r+"/event_processing/events/motion/",type:"GET"}).done(function(e){CloudAPI.cache.updateEventProcessingEventsMotion(r,e),o.resolve(e)}).fail(function(){o.reject()}),o},CloudAPI.updateCameraEventProcessingEventsMotion=function(e){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var r=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+r+"/event_processing/events/motion/",type:"PUT",data:JSON.stringify(e),contentType:"application/json"}).done(function(){CloudAPI.cache.updateEventProcessingEventsMotion(r,e),o.resolve()}).fail(function(){o.reject()}),o},CloudAPI.cameraEventProcessingEventsSound=function(){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var r=CloudAPI.config.cameraID;return $.ajax({url:CloudAPI.config.url_cameras+r+"/event_processing/events/sound/",type:"GET"}).done(function(e){CloudAPI.cache.updateCameraEventProcessingEventsSound(r,e),o.resolve(e)}).fail(function(){o.reject()}),o},CloudAPI.cameraSendPtz=function(e){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var r=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+r+"/send_ptz/",type:"POST",data:JSON.stringify(e),contentType:"application/json"}).done(function(e){console.log(e),o.resolve()}).fail(function(){o.reject()}),o},CloudAPI.cameraPtzExecute=function(e){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var r=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+r+"/ptz/execute/",type:"POST",data:JSON.stringify(e),contentType:"application/json"}).done(function(e){console.log(e),o.resolve()}).fail(function(){o.reject()}),o},CloudAPI.cameraPtz=function(o){var r=$.Deferred();if(!CloudAPI.isCameraID())return r.reject(),r;o=o||CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+o+"/ptz/",type:"GET"}).done(function(e){CloudAPI.cache.setPtzCaps(o,e),r.resolve(e)}).fail(function(e){r.reject(e)}),r},CloudAPI.updateCameraEventProcessingEventsSound=function(e){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var r=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+r+"/event_processing/events/sound/",type:"PUT",data:JSON.stringify(e),contentType:"application/json"}).done(function(){CloudAPI.cache.updateCameraEventProcessingEventsSound(r,e),o.resolve()}).fail(function(){o.reject()}),o},CloudAPI.updateCameraVideoStream=function(e,o){var r=$.Deferred();if(!CloudAPI.isCameraID())return r.reject(),r;var t=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+t+"/video/streams/"+e+"/",type:"PUT",data:JSON.stringify(o),contentType:"application/json"}).done(function(){console.log("[CLOUDAPI] [CLOUDAPI] Updated video/streams/"+e+" in cache for "+t),CloudAPI.cache.updateCameraVideoStream(t,e,o),r.resolve()}).fail(function(){r.reject()}),r},CloudAPI.setVBRQuality=function(e,o,r,t){if(CloudAPI.isCameraID()){r=null==r?CloudAPI.handleNothing:r,t=null==t?CloudAPI.handleError:t;var n={};n.vbr_quality=e,n.vbr=!0,$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.config.cameraID+"/video/streams/"+o+"/",type:"PUT",success:r,error:r,data:JSON.stringify(n),contentType:"application/json"})}},CloudAPI.formatMemoryCard=function(){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var e=CloudAPI.config.cameraID;return $.ajax({url:CloudAPI.config.url_cameras+e+"/format_memory_card/",type:"POST"}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}),o},CloudAPI.cameraMemoryCard=function(o){var r=$.Deferred();return(o=o||CloudAPI.config.cameraID)?$.ajax({url:CloudAPI.config.url_cameras+o+"/memory_card/",type:"GET"}).done(function(e){CloudAPI.cache.setMemoryCard(o,e),r.resolve(e)}).fail(function(){CloudAPI.cache.setMemoryCard(o,{status:"none"}),r.reject()}):r.reject(),r},CloudAPI.cameraWifi=function(){var o=$.Deferred();return CloudAPI.isCameraID()?$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.config.cameraID+"/wifi/",type:"GET"}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}):o.reject(),o},CloudAPI.cameraFirmwares=function(){var o=$.Deferred();return CloudAPI.isCameraID()?$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.config.cameraID+"/firmwares/?limit=1000",type:"GET",contentType:"application/json"}).done(function(e){o.resolve(e.objects)}).fail(function(){o.reject()}):o.reject(),o},CloudAPI.cameraFirmwaresUpgrade=function(e){var r=$.Deferred();if(!CloudAPI.isCameraID())return r.reject(),r;console.log("[CLOUDAPI] upgrade firmware to version: "+e);var o={};return o.version=e,$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.config.cameraID+"/firmwares/upgrade/",type:"POST",data:JSON.stringify(o),contentType:"application/json"}).done(function(){r.resolve()}).fail(function(e,o){console.error("[CLOUDAPI] cameraFirmwaresUpgrade, "+o,e),r.reject()}),r},CloudAPI.accountInfo=function(){var o=$.Deferred();return $.ajax({url:CloudAPI.config.url_account,type:"GET",cache:!1}).done(function(e){CloudAPI.cache.account=e,o.resolve(e)}).fail(function(e){console.log("Fail "+CloudAPI.config.url_account),console.error(e),o.reject(e)}),o},CloudAPI.anonToken=function(){var o=$.Deferred(),e=Date.now(),r=CloudAPI.config.anonToken.expireTimeUTC-6e5,t=CloudAPI.config.anonToken.expireTimeUTC-3e5;return r<e&&e<t?($.ajaxSetup({crossDomain:!0,cache:!1,headers:{Authorization:"SkyVR "+CloudAPI.config.anonToken.token}}),o.resolve(CloudAPI.config.anonToken)):$.ajax({url:CloudAPI.config.url_account+"token/anon/",type:"GET"}).done(function(e){CloudAPI.config.anonToken.token=e.token,CloudAPI.config.anonToken.type=e.type,CloudAPI.config.anonToken.expire=e.expire,CloudAPI.config.anonToken.expireTimeUTC=Date.parse(e.expire+"Z"),CloudAPI.setToStorage("SkyVR_anonToken",JSON.stringify(CloudAPI.config.anonToken)),$.ajaxSetup({crossDomain:!0,cache:!1,headers:{Authorization:"SkyVR "+e.token}}),o.resolve(CloudAPI.config.anonToken)}).fail(function(){o.reject()}),o},CloudAPI.accountShare=function(e){return CloudAPI.cameraID(),$.ajax({url:CloudAPI.config.url_account+"share/",type:"POST",data:JSON.stringify(e),contentType:"application/json",cache:!1})},CloudAPI.capabilities=function(e,o){e=null==e?CloudAPI.handleNothing:e,o=null==o?CloudAPI.handleError:o,$.ajax({url:CloudAPI.config.url_api+"capabilities/",type:"GET",success:e,error:o})},CloudAPI.cameraInfo=function(o){var r=$.Deferred();return null==(o=o||CloudAPI.cameraID())?(r.reject(),r):$.ajax({url:CloudAPI.config.url_cameras+o+"/",type:"GET"}).done(function(e){CloudAPI.cache.cameras[e.id]&&!CloudAPI.cache.cameras[e.id].memory_card?(console.log("cameraInfo cahce has not memory card info for camid="+e.id),CloudAPI.cameraMemoryCard(e.id)):CloudAPI.cache.cameras[e.id]||(console.log("cameraInfo has not in cache for camid="+e.id),CloudAPI.cameraMemoryCard(e.id)),CloudAPI.cache.setCameraInfo(e)?CloudAPI.cameraP2PSettings(o).done(function(e){r.resolve(CloudAPI.cache.cameras[o])}).fail(function(){r.resolve(CloudAPI.cache.cameras[o])}):r.resolve(CloudAPI.cache.cameras[o])}).fail(function(){r.reject()})},CloudAPI.updateCamera=function(o){var r=$.Deferred();return CloudAPI.isCameraID()?$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/",type:"PUT",data:JSON.stringify(o),contentType:"application/json"}).done(function(e){console.log("[CLOUDAPI] Updated camera in cache for "+CloudAPI.cameraID()),o.id=CloudAPI.cameraID(),CloudAPI.cache.updateCameraInfo(o),r.resolve(e)}).fail(function(){r.reject()}):r.reject(),r},CloudAPI.cameraMesaging=function(e){var o=$.Deferred();return null==(e=e||CloudAPI.cameraID())?(o.reject(),o):$.ajax({url:CloudAPI.config.url_cameras+e+"/raw_messaging/",type:"GET"}).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)})},CloudAPI.updateCameraAudio=function(o){var r=$.Deferred();if(!CloudAPI.isCameraID())return r.reject(),r;var t=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+t+"/audio/",type:"PUT",data:JSON.stringify(o),contentType:"application/json"}).done(function(e){console.log("[CLOUDAPI] Updated audio in cache for "+t),CloudAPI.cache.updateCameraAudio(t,o),r.resolve(e)}).fail(function(){r.reject()}),r},CloudAPI.cameraAudio=function(){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var r=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+r+"/audio/",type:"GET"}).done(function(e){CloudAPI.cache.updateCameraAudio(r,e),o.resolve(e)}).fail(function(){o.reject()}),o},CloudAPI.cameraVideo=function(){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var r=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+r+"/video/",type:"GET"}).done(function(e){CloudAPI.cache.updateCameraVideo(r,e),o.resolve(e)}).fail(function(){o.reject()}),o},CloudAPI.updateCameraVideo=function(o){var r=$.Deferred();if(!CloudAPI.isCameraID())return r.reject(),r;var t=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+t+"/video/",type:"PUT",contentType:"application/json",data:JSON.stringify(o)}).done(function(e){CloudAPI.cache.updateCameraVideo(t,o),r.resolve(e)}).fail(function(){r.reject()}),r},CloudAPI.setCameraVideo=function(e,o,r){if(CloudAPI.isCameraID())return o=o||CloudAPI.handleNothing,r=r||CloudAPI.handleError,$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/video/",type:"PUT",success:o,error:r,contentType:"application/json",data:JSON.stringify(e)})},CloudAPI.cameraMediaStreams=function(){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var r=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+r+"/media_streams/",type:"GET"}).done(function(e){CloudAPI.cache.setMediaStreams(r,e),o.resolve(e)}).fail(function(){o.reject()}),o},CloudAPI.updateCameraMediaStreams=function(e,o){var r=$.Deferred();return(o=o||CloudAPI.cameraID())?$.ajax({url:CloudAPI.config.url_cameras+o+"/media_streams/",type:"PUT",data:JSON.stringify(e),contentType:"application/json"}).done(function(e){r.resolve(e)}).fail(function(e){r.reject(e)}):r.reject(),r},CloudAPI.cameraLiveUrls=function(e){var o=$.Deferred();return(e=e||CloudAPI.cameraID())?$.ajax({url:CloudAPI.config.url_cameras+e+"/live_urls/",type:"GET"}).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)}):o.reject(),o},CloudAPI.cameraBackwardStart=function(){if(CloudAPI.isCameraID()){var e={};CloudAPI.config.backwardURL&&(e.url=CloudAPI.config.backwardURL,CloudAPI.config.tmpBackwardURL==CloudAPI.config.backwardURL?CloudAPI.config.tmpBackwardURLCount++:(CloudAPI.config.tmpBackwardURLCount=1,CloudAPI.config.tmpBackwardURL=CloudAPI.config.backwardURL),CloudAPI.isP2PStreaming()&&(console.log("[CLOUDAPI] Send (audio streaming) backward start: "+CloudAPI.config.backwardURL),$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/audio/backward/start/",type:"POST",success:CloudAPI.handleNothing,data:JSON.stringify(e),contentType:"application/json"})))}},CloudAPI.cameraBackwardStop=function(){if(CloudAPI.isCameraID()){var e={};if(CloudAPI.config.backwardURL){if(e.url=CloudAPI.config.backwardURL,CloudAPI.config.tmpBackwardURL==CloudAPI.config.backwardURL){if(0==CloudAPI.config.tmpBackwardURLCount)return;CloudAPI.config.tmpBackwardURLCount--}CloudAPI.isP2PStreaming()&&(console.log("[CLOUDAPI] Send (audio streaming) backward stop: "+CloudAPI.config.backwardURL),$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/audio/backward/stop/",type:"POST",success:CloudAPI.handleNothing,data:JSON.stringify(e),contentType:"application/json"}))}}},CloudAPI.cameraSchedule=function(){if(CloudAPI.isCameraID())return $.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/schedule/",type:"GET",cache:!1})},CloudAPI.updateCameraSchedule=function(e){return $.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/schedule/",type:"PUT",data:JSON.stringify(e),cache:!1,contentType:"application/json"})},CloudAPI.hasAccessCameraPreview=function(e){var o=CloudAPI.cache.cameraInfo(e);return!!o&&(CloudAPI.hasAccess(o,"live")||CloudAPI.hasAccess(o,"all")||CloudAPI.hasAccess(o,"ptz"))},CloudAPI.cameraPreview=function(e,o,r){return o=null==o?CloudAPI.handleNothing:o,r=null==r?CloudAPI.handleError:r,$.ajax({url:CloudAPI.config.url_cameras+e+"/preview/",type:"GET",success:o,error:r})},CloudAPI.hasAccessCameraUpdatePreview=function(e){var o=CloudAPI.cache.cameraInfo(e);return!!o&&(CloudAPI.hasAccess(o,"live")||CloudAPI.hasAccess(o,"all")||CloudAPI.hasAccess(o,"ptz"))},CloudAPI.cameraUpdatePreview=function(e){return $.ajax({url:CloudAPI.config.url_cameras+e+"/preview/update/",type:"POST"})},CloudAPI.storageDataFirstRecord=function(e){var o=$.Deferred(),r={camid:CloudAPI.cameraID(),limit:1,offset:0};return e&&(r.start=e),$.ajax({url:CloudAPI.config.url_storage+"data/",data:r,cache:!1,type:"GET"}).done(function(e){0<e.objects.length?o.resolve(e.objects[0]):o.reject()}).fail(function(){o.reject()}),o},CloudAPI.storageEventsFirstRecord=function(){var o=$.Deferred(),e={camid:CloudAPI.cameraID(),limit:1,offset:0};return $.ajax({url:CloudAPI.config.url_storage+"events/",data:e,cache:!1,type:"GET"}).done(function(e){0<e.objects.length?o.resolve(e.objects[0]):o.reject()}).fail(function(){o.reject()}),o},CloudAPI.storageThumbnailsFirstRecord=function(){var o=$.Deferred(),e={camid:CloudAPI.cameraID(),limit:1,offset:0};return $.ajax({url:CloudAPI.config.url_storage+"thumbnails/",data:e,cache:!1,type:"GET"}).done(function(e){0<e.objects.length?o.resolve(e.objects[0]):o.reject()}).fail(function(){o.reject()}),o},CloudAPI.getAllData=function(e,o){},CloudAPI.storageThumbnails=function(e,o){var t=$.Deferred(),n={meta:{limit:1e3,offset:0,total_count:-1},objects:[]},a={camid:CloudAPI.cameraID(),limit:n.meta.limit,offset:n.meta.offset,start:e};function l(e){var o=$.Deferred();return $.ajax({url:CloudAPI.config.url_storage+"thumbnails/",data:e,cache:!1,async:!0,type:"GET"}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}),o}return o&&(a.end=o),l(a).fail(function(){t.reject()}).done(function(e){if(n.meta.total_count=e.meta.total_count,n.meta.expire=e.meta.expire,$.merge(n.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)t.resolve(n);else{for(var o=[],r=n.meta.limit;r<e.meta.total_count;r+=n.meta.limit)a.offset=r,o.push(l(a));$.when.apply($,o).done(function(){for(var e=0;e<arguments.length;e++)$.merge(n.objects,arguments[e].objects);t.resolve(n)}).fail(function(){t.reject()})}}),t},CloudAPI.storageTimeline=function(e,o){var t=$.Deferred(),n={meta:{limit:1e3,offset:0,total_count:-1},objects:[]},a={slices:1,camid:CloudAPI.cameraID(),limit:n.meta.limit,offset:n.meta.offset,start:e};function l(e){var o=$.Deferred();return $.ajax({url:CloudAPI.config.url_storage+"timeline/"+CloudAPI.cameraID()+"/",data:e,cache:!1,async:!0,type:"GET"}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}),o}return o&&(a.end=o),l(a).fail(function(){t.reject()}).done(function(e){if(n.meta.total_count=e.meta.total_count,n.meta.expire=e.meta.expire,$.merge(n.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)t.resolve(n);else{for(var o=[],r=n.meta.limit;r<e.meta.total_count;r+=n.meta.limit)a.offset=r,o.push(l(a));$.when.apply($,o).done(function(){for(var e=0;e<arguments.length;e++)$.merge(n.objects,arguments[e].objects);t.resolve(n)}).fail(function(){t.reject()})}}),t},CloudAPI.storageEvents=function(e,o){var t=$.Deferred(),n={meta:{limit:1e3,offset:0,total_count:-1},objects:[]},a={camid:CloudAPI.cameraID(),limit:n.meta.limit,offset:n.meta.offset,start:e};function l(e){var o=$.Deferred();return $.ajax({url:CloudAPI.config.url_storage+"events/",data:e,cache:!1,async:!0,type:"GET"}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}),o}return o&&(a.end=o),l(a).fail(function(){t.reject()}).done(function(e){if(n.meta.total_count=e.meta.total_count,n.meta.expire=e.meta.expire,$.merge(n.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)t.resolve(n);else{for(var o=[],r=n.meta.limit;r<e.meta.total_count;r+=n.meta.limit)a.offset=r,o.push(l(a));$.when.apply($,o).done(function(){for(var e=0;e<arguments.length;e++)$.merge(n.objects,arguments[e].objects);t.resolve(n)}).fail(function(){t.reject()})}}),t},CloudAPI.cameraMotionDetectionDemo=function(){return JSON.parse('{"caps": {"columns": 23, "max_regions": 8, "region_shape": "rect", "rows": 15, "sensitivity": "region"}}')},CloudAPI.cameraMotionDetection=function(){return $.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/motion_detection/",type:"GET"})},CloudAPI.cameraMotionDetectionRegionsDemo=function(){return JSON.parse('{"meta": {"limit": 20, "next": null, "offset": 0, "previous": null, "total_count": 8}, "objects": [{"enabled": true, "id": 2686, "map": "ZmQwMDBjM2ZjMDAwN2Y4MDAwZmYwMDAxZmUwMDAzZmNlNjAw", "name": "motion1", "sensitivity": 5}, {"enabled": true, "id": 2687, "map": "ZjYwMDBmMGZmODAwMWZmMDAwM2ZlMDAwN2ZjMDAwZmY4MDAxZmZmMDAw", "name": "motion2", "sensitivity": 5}, {"enabled": true, "id": 2688, "map": "ZjQwMDBmM2ZlMDAwN2ZjMDAwZmY4MDAxZmYwMDAzZmUwMDA3ZmNmMjAw", "name": "motion3", "sensitivity": 5}, {"enabled": true, "id": 2689, "map": "ZWMwMDBjMWZlMDAwM2ZjMDAwN2Y4MDAwZmYwMDAxZmVmNzAw", "name": "motion4", "sensitivity": 5}, {"enabled": true, "id": 2690, "map": "ZTQwMDA2ZTAwMDAxYzAwMDAzODBmOTAw", "name": "motion5", "sensitivity": 5}, {"enabled": true, "id": 2691, "map": "MmIwMWZmMDAwM2ZlMDAwN2ZjMDAwZmY4MDAxZmYwMDAzZmUwMDA3ZmMwMDBmZjgwMDFmZjAwMDNmZTAwMDdmYzAwMGZmODAwMWZmMDAwM2ZlMDAwN2ZjMDAw", "name": "motion6", "sensitivity": 5}, {"enabled": true, "id": 2692, "map": "MTJmZjgwMDFmZjAwMDNmZTAwMDdmYzAwMGZmODAwMWZmMDAwM2ZlMGU4MDA=", "name": "motion7", "sensitivity": 5}, {"enabled": false, "id": 2693, "map": "", "name": "motion8", "sensitivity": 5}]}')},CloudAPI.cameraMotionDetectionRegions=function(){return $.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/motion_detection/regions/",type:"GET"})},CloudAPI.cameraP2PSettings=function(o,r,e,t){return o=o||CloudAPI.cameraID(),r=null==r?CloudAPI.handleNothing:r,e=null==e?CloudAPI.handleError:e,t=null==t?CloudAPI.handleNothing:t,$.ajax({url:CloudAPI.config.url_cameras+o+"/p2p_settings/",type:"GET",success:function(e){CloudAPI.cache.setP2PSettings(o,e),r(e)},error:e,complete:t})},CloudAPI.cameraSetP2PSettings=function(e){return $.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/p2p_settings/",type:"PUT",data:JSON.stringify(e),cache:!1,contentType:"application/json"})},CloudAPI.cameraLog=function(){return $.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/log/",type:"GET"})},CloudAPI.cameraLogDownload=function(e){var o=$.Deferred(),r=null;return(r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onreadystatechange=function(){r.readyState==XMLHttpRequest.DONE&&(200==r.status?o.resolve(r.responseText):o.reject())},r.open("GET",e,!0),r.send(),o.promise()},CloudAPI.cameraLogUpdate=function(){return $.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/log/update/",type:"POST"})},CloudAPI.cameraManagersList=function(e,o){e=e||CloudAPI.handleNothing,o=o||CloudAPI.handleError,$.ajax({url:CloudAPI.config.url_cmngrs,type:"GET",success:e,error:o})},CloudAPI.cameraManagerReset=function(e){return $.ajax({url:CloudAPI.config.url_cmngrs+e+"/reset/",type:"POST"})},CloudAPI.camerasList=function(e){e=e||{};var n=$.Deferred(),t={meta:{limit:20,offset:0,total_count:-1},objects:[]},a={limit:t.meta.limit,offset:t.meta.offset};for(var o in e)a[o]=e[o];function l(e){var o=$.Deferred();return $.ajax({url:CloudAPI.config.url_cameras,data:e,cache:!1,type:"GET"}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}),o}function s(o){var r=0,t=o.objects.length;r==t&&n.resolve(o);for(var e=0;e<t;e++)cam=o.objects[e],CloudAPI.cache.setCameraInfo(cam)?(console.log("update p2p_settings: ",cam.id),CloudAPI.cameraP2PSettings(cam.id).done(function(e){CloudAPI.cameraMemoryCard(cam.id).done(function(){(r+=1)==t&&n.resolve(o)}).fail(function(){(r+=1)==t&&n.resolve(o)})}).fail(function(){(r+=1)==t&&n.resolve(o)})):(r+=1)==t&&n.resolve(o)}return l(a).fail(function(){n.reject()}).done(function(e){if(t.meta.total_count=e.meta.total_count,$.merge(t.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)s(t);else{for(var o=[],r=t.meta.limit;r<e.meta.total_count;r+=t.meta.limit)a.offset=r,o.push(l(a));$.when.apply($,o).done(function(){for(var e=0;e<arguments.length;e++)$.merge(t.objects,arguments[e].objects);s(t)}).fail(function(){n.reject()})}}),n},CloudAPI.camerasListByCriterions=function(e,o,r){o=o||CloudAPI.handleNothing,r=r||CloudAPI.handleError,$.ajax({url:CloudAPI.config.url_cameras,data:e,type:"GET",success:o,error:r})},CloudAPI.cameraManagerInfo=function(e,o,r){o=o||CloudAPI.handleNothing,r=r||CloudAPI.handleError,$.ajax({url:CloudAPI.config.url_cmngrs+e+"/",type:"GET",success:o,error:r})},CloudAPI.cameraManagerSetTimezone=function(e,o,r,t){r=r||CloudAPI.handleNothing,t=t||CloudAPI.handleError;var n={};n.timezone=o,$.ajax({url:CloudAPI.config.url_cmngrs+e+"/",type:"PUT",success:r,error:t,data:JSON.stringify(n),contentType:"application/json"})},CloudAPI.storageClipList=function(){var t=$.Deferred(),n={meta:{limit:100,offset:0,total_count:-1},objects:[]},a={limit:n.meta.limit,offset:n.meta.offset,camid:CloudAPI.cameraID(),usecamtz:""};function l(e){var o=$.Deferred();return $.ajax({url:CloudAPI.config.url_clips,data:e,cache:!1,type:"GET"}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}),o}return l(a).fail(function(){t.reject()}).done(function(e){if(n.meta.total_count=e.meta.total_count,n.meta.expire=e.meta.expire,$.merge(n.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)t.resolve(n);else{for(var o=[],r=n.meta.limit;r<e.meta.total_count;r+=n.meta.limit)a.offset=r,o.push(l(a));$.when.apply($,o).done(function(){for(var e=0;e<arguments.length;e++)$.merge(n.objects,arguments[e].objects);t.resolve(n)}).fail(function(){t.reject()})}}),t},CloudAPI.storageClipListAnon=function(e){var l=$.Deferred();return CloudAPI.anonToken().done(function(r){var t={meta:{limit:100,offset:0,total_count:-1},objects:[]},n={limit:t.meta.limit,offset:t.meta.offset,usecamtz:""};function a(e){var o=$.Deferred();return $.ajax({url:CloudAPI.config.url_clips,data:e,cache:!1,type:"GET",headers:{Authorization:"SkyVR "+r.token}}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}),o}e&&(n.token=e),a(n).fail(function(){l.reject()}).done(function(e){if(t.meta.total_count=e.meta.total_count,t.meta.expire=e.meta.expire,$.merge(t.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)l.resolve(t);else{for(var o=[],r=t.meta.limit;r<e.meta.total_count;r+=t.meta.limit)n.offset=r,o.push(a(n));$.when.apply($,o).done(function(){for(var e=0;e<arguments.length;e++)$.merge(t.objects,arguments[e].objects);l.resolve(t)}).fail(function(){l.reject()})}})}).fail(function(){l.reject()}),l},CloudAPI.storageClipCreate=function(e,o,r,t,n){var a={};return a.camid=CloudAPI.cameraID(),a.title=e,a.group=o,a.start=r,a.end=t,a.delete_at=n,$.ajax({url:CloudAPI.config.url_clips,type:"POST",data:JSON.stringify(a),cache:!1,contentType:"application/json"})},CloudAPI.storageClip=function(e){return $.ajax({url:CloudAPI.config.url_clips+e+"/",type:"GET",cache:!1})},CloudAPI.serverTime=function(){return $.ajax({url:CloudAPI.config.url_server+"time/",type:"GET",cache:!1})},CloudAPI.storageClipAnon=function(o,e){var r=$.Deferred(),t={};return e&&(t.token=e),CloudAPI.anonToken().done(function(e){$.ajax({url:CloudAPI.config.url_clips+o+"/",type:"GET",data:t,cache:!1,headers:{Authorization:"SkyVR "+e.token}}).done(function(e){r.resolve(e)}).fail(function(){r.reject()})}).fail(function(){r.reject()}),r},CloudAPI.storageClipDelete=function(e){return $.ajax({url:CloudAPI.config.url_clips+e+"/",type:"DELETE",cache:!1})},CloudAPI.storageClipUpdate=function(e,o){return $.ajax({url:CloudAPI.config.url_clips+e+"/",data:JSON.stringify(o),type:"PUT",cache:!1,contentType:"application/json"})},CloudAPI.cameraSettings=function(){var a,e=$.Deferred(),o=[];function r(e){var o=$.Deferred();return e.always(function(){o.resolve()}),o}return o.push(r((a=$.Deferred(),CloudAPI.cameraMediaStreams().done(function(e){console.log("MediaStreams: ",e);var o=e.mstreams_supported,r=e.live_ms_id;if(0<o.length&&""!=r){for(var t="",n=0;n<o.length;n++)if(o[n].id==r){t=o[n].vs_id;break}""!=t?CloudAPI.cameraVideoStream(t).done(function(){a.resolve()}).fail(function(){a.reject()}):a.reject()}else a.resolve()}).fail(function(){a.reject()}),a))),CloudAPI.cache.cameraInfo().url||(o.push(r(CloudAPI.cameraVideo())),o.push(r(CloudAPI.cameraAudio())),o.push(r(CloudAPI.cameraLimits())),o.push(r(CloudAPI.cameraEventProcessingEventsMotion())),o.push(r(CloudAPI.cameraEventProcessingEventsSound())),o.push(r(CloudAPI.cameraMemoryCard()))),$.when.apply($,o).done(function(){e.resolve(CloudAPI.cache.cameraInfo())}).fail(function(){e.reject()}),e},CloudAPI.createCamsess=function(e){return e=e||{},$.ajax({url:CloudAPI.config.url_camsess,data:JSON.stringify(e),type:"POST",contentType:"application/json",cache:!1})},CloudAPI.updateCamsess=function(e,o){return o=o||{},$.ajax({url:CloudAPI.config.url_camsess+e+"/",data:JSON.stringify(o),type:"PUT",contentType:"application/json",cache:!1})},CloudAPI.cameraCreate=function(e){var o=$.Deferred();return e=e||{},$.ajax({url:CloudAPI.config.url_cameras,type:"POST",data:JSON.stringify(e),cache:!1,contentType:"application/json"}).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)}),o},CloudAPI.cameraDelete=function(e){var o=$.Deferred();return $.ajax({url:CloudAPI.config.url_cameras+e+"/",type:"DELETE",cache:!1}).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)}),o},CloudAPI.cameraUpdate=function(e,o){var r=$.Deferred();return o=o||{},$.ajax({url:CloudAPI.config.url_cameras+e+"/",type:"PUT",data:JSON.stringify(o),cache:!1,contentType:"application/json"}).done(function(e){r.resolve(e)}).fail(function(e){r.reject(e)}),r},CloudAPI.adminCameras=function(e){return e=e||{},$.ajax({url:CloudAPI.config.url_admin_cameras,data:e,type:"GET",cache:!1})},CloudAPI.adminCameraInfo=function(e){return $.ajax({url:CloudAPI.config.url_admin_cameras+e+"/",type:"GET",cache:!1})},CloudAPI.updateAdminCamera=function(e,o){return o=o||{},$.ajax({url:CloudAPI.config.url_admin_cameras+e+"/",type:"PUT",data:JSON.stringify(o),contentType:"application/json",cache:!1})},CloudAPI.store={},CloudAPI.store.volume=function(e){return e&&CloudAPI.setToStorage("volume",e),CloudAPI.getFromStorage("volume")},CloudAPI.store.prev_volume=function(e){return e&&CloudAPI.setToStorage("prev_volume",e),CloudAPI.getFromStorage("prev_volume")},CloudAPI.store.zoom=function(e){return null!=e&&CloudAPI.setToStorage("zoom",e),CloudAPI.getFromStorage("zoom")},CloudAPI.store.zoom_left=function(e){return null!=e&&CloudAPI.setToStorage("zoom_left",e),CloudAPI.getFromStorage("zoom_left")},CloudAPI.store.zoom_top=function(e){return null!=e&&CloudAPI.setToStorage("zoom_top",e),CloudAPI.getFromStorage("zoom_top")},CloudAPI.store.user_profile=function(e){return null!=e&&CloudAPI.setToStorage("user_profile",e),CloudAPI.getFromStorage("user_profile")},CloudAPI.store.svcp_host=function(e){return null!=e&&CloudAPI.setToStorage("svcp_host",e),CloudAPI.getFromStorage("svcp_host")},CloudAPI.storageTemp={},CloudAPI.storageMode="local",CloudAPI.detectStorageMode=function(){try{localStorage.setItem("detectStorageMode","yes")}catch(e){CloudAPI.storageMode="temp"}},CloudAPI.detectStorageMode(),CloudAPI.setToStorage=function(e,o){"local"==CloudAPI.storageMode?localStorage.setItem(e,o):CloudAPI.storageTemp[e]=o},CloudAPI.getFromStorage=function(e){return"local"==CloudAPI.storageMode?localStorage.getItem(e):CloudAPI.storageTemp[e]},CloudAPI.removeFromStorage=function(e){"local"==CloudAPI.storageMode?localStorage.removeItem(e):CloudAPI.storageTemp[e]=void 0},CloudAPI.loadApiTokenFromHref=function(){var e=window.location.href.split("#"),o=e[e.length-1];for(var r in o=o.split("&")){var t=o[r].split("=")[0],n=decodeURIComponent(o[r].split("=")[1]);"token"==t?(CloudAPI.config.apiToken=CloudAPI.config.apiToken||{},CloudAPI.config.apiToken.token=n,CloudAPI.config.apiToken.type="api"):"expire"==t&&(CloudAPI.config.apiToken=CloudAPI.config.apiToken||{},CloudAPI.config.apiToken.expire=n,CloudAPI.config.apiToken.expireTimeUTC=Date.parse(n+"Z"))}console.log("Href token: ",CloudAPI.config.apiToken),CloudAPI.setToStorage("SkyVR_apiToken",JSON.stringify(CloudAPI.config.apiToken))},CloudAPI.cleanupApiToken=function(){CloudAPI.removeFromStorage("SkyVR_apiToken"),CloudAPI.config.apiToken=null,$.ajaxSetup({crossDomain:!0,cache:!1,beforeSend:function(e,o){e.setRequestHeader("Authorization","")}})},CloudHelpers.containsPageParam("svcp_host")?CloudAPI.setURL(CloudAPI.pageParams.svcp_host):CloudAPI.getFromStorage("CloudAPI_svcp_host")?CloudAPI.setURL(CloudAPI.getFromStorage("CloudAPI_svcp_host")):CloudAPI.setURL(window.location.protocol+"//"+window.location.host.toString()+"/"),CloudAPI.events={},CloudAPI.events.listeners={},CloudAPI.events.names=["CAMERA_INFO_CHANGED"],CloudAPI.events.on=function(e,o,r){-1!=CloudAPI.events.names.indexOf(e)?(CloudAPI.events.listeners[e]||(CloudAPI.events.listeners[e]={}),CloudAPI.events.listeners[e][o]=r):console.error("[CLOUDAPI] Could not find event with name "+e)},CloudAPI.events.off=function(e,o){-1!=CloudAPI.events.names.indexOf(e)&&CloudAPI.events.listeners[e]?CloudAPI.events.listeners[e][o]?delete CloudAPI.events.listeners[e][o]:console.error("[CLOUDAPI] Could not find event with name "+e+" by id "+o):console.error("[CLOUDAPI] Could not find event with name "+e)},CloudAPI.events.trigger=function(e,r){if(-1!=CloudAPI.events.names.indexOf(e)){if(CloudAPI.events.listeners[e]){var t=CloudAPI.events.listeners[e];setTimeout(function(){for(var o in t)try{t[o](r)}catch(e){console.error("[CLOUDAPI] error on execute callback event ("+o+")",e)}},1)}}else console.error("[CLOUDAPI] Could not find event with name "+e)},window.CloudReturnCode={},CloudReturnCode.OK={name:"OK",code:-5049,text:"Success"},CloudReturnCode.OK_COMPLETIONPENDING={name:"OK_COMPLETIONPENDING",code:1,text:"Operation Pending"},CloudReturnCode.ERROR_NOT_CONFIGURED={name:"ERROR_NOT_CONFIGURED",code:-2,text:"Object not configured"},CloudReturnCode.ERROR_NOT_IMPLEMENTED={name:"ERROR_NOT_IMPLEMENTED",code:-1,text:"Function not implemented"},CloudReturnCode.ERROR_NO_MEMORY={name:"ERROR_NO_MEMORY",code:-12,text:"Out of memory"},CloudReturnCode.ERROR_ACCESS_DENIED={name:"ERROR_ACCESS_DENIED",code:-13,text:"Access denied"},CloudReturnCode.ERROR_BADARGUMENT={name:"ERROR_BADARGUMENT",code:-22,text:"Invalid argument"},CloudReturnCode.ERROR_STREAM_UNREACHABLE={name:"ERROR_STREAM_UNREACHABLE",code:-5049,text:"The stream specified is not reachable. Please check source URL or restart the stream"},CloudReturnCode.ERROR_EXPECTED_FILTER={name:"ERROR_EXPECTED_FILTER",code:-5050,text:"Expected filter"},CloudReturnCode.ERROR_NO_CLOUD_CONNECTION={name:"ERROR_NO_CLOUD_CONNECTION",code:-5051,text:"No cloud connection (has not conenction object or token is invalid)"},CloudReturnCode.ERROR_WRONG_RESPONSE={name:"ERROR_WRONG_RESPONSE",code:-5052,text:"Response from cloud expected in json, but got something else"},CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED={name:"ERROR_SOURCE_NOT_CONFIGURED",code:-5053,text:"Source not configured"},CloudReturnCode.ERROR_INVALID_SOURCE={name:"ERROR_INVALID_SOURCE",code:-5054,text:"Invalid source"},CloudReturnCode.ERROR_RECORDS_NOT_FOUND={name:"ERROR_RECORDS_NOT_FOUND",code:-5055,text:"Records are not found"},CloudReturnCode.ERROR_STREAM_UNREACHABLE_HLS={name:"ERROR_STREAM_UNREACHABLE_HLS",code:-5056,text:"The stream specified is not reachable (HLS)."},CloudReturnCode.ERROR_NOT_FOUND_HLS_PLUGIN={name:"ERROR_NOT_FOUND_HLS_PLUGIN",code:-5057,text:"HLS plugin not found."},CloudReturnCode.ERROR_COULD_NOT_DECODE_STREAM_OR_COULD_NOT_SET_COOKIE_HLS={name:"ERROR_COULD_NOT_DECODE_STREAM_OR_COULD_NOT_SET_COOKIE_HLS",code:-5058,text:"Could not decode stream or could not set cookie for streaming server (please allow cookie)."},CloudReturnCode.ERROR_WEBRTC_SERVER_ERROR={name:"ERROR_WEBRTC_SERVER_ERROR",code:-5059,text:"Unable to connect to server. Please check that you added an exception for the certificate, and that the port is available."},CloudReturnCode.ERROR_CAMERA_OFFLINE={name:"ERROR_CAMERA_OFFLINE",code:-5060,text:"Video source is offline"},CloudReturnCode.PLAYER_NOT_SUPPORTED={name:"PLAYER_NOT_SUPPORTED",code:-5061,text:"Player not supported"},CloudReturnCode.NOT_SUPPORTED_FORMAT={name:"NOT_SUPPORTED_FORMAT",code:-5062,text:"Not supported format"},CloudReturnCode.ERROR_NOT_AUTHORIZED={name:"ERROR_NOT_AUTHORIZED",code:-5401,text:"Failed authorization on cloud (wrong credentials)"},CloudReturnCode.ERROR_NOT_FOUND={name:"ERROR_NOT_FOUND",code:-5404,text:"Not found object"},window.CloudCameraPrivacyFilter={},CloudCameraPrivacyFilter.PS_OWNER_NOT_PUBLIC={name:"PS_OWNER_NOT_PUBLIC",code:0,text:"My cameras which not public"},CloudCameraPrivacyFilter.PS_OWNER={name:"PS_OWNER",code:1,text:"Only my cameras"},CloudCameraPrivacyFilter.PS_PUBLIC_NOT_OWNERS={name:"PS_PUBLIC_NOT_OWNERS",code:2,text:"Public cameras exclude my"},CloudCameraPrivacyFilter.PS_PUBLIC={name:"PS_PUBLIC",code:3,text:"All public cameras"},CloudCameraPrivacyFilter.PS_OWNERS_PUBLIC={name:"PS_OWNERS_PUBLIC",code:4,text:"My public cameras"},CloudCameraPrivacyFilter.PS_ALL={name:"PS_ALL",code:5,text:"All cameras"},window.CloudCameraRecordingMode={},CloudCameraRecordingMode.CONTINUES={name:"CONTINUES",code:0},CloudCameraRecordingMode.BY_EVENT={name:"BY_EVENT",code:1},CloudCameraRecordingMode.NO_RECORDING={name:"NO_RECORDING",code:2},window.CloudCameraStatus={},CloudCameraStatus.ACTIVE={name:"ACTIVE",code:0},CloudCameraStatus.UNAUTHORIZED={name:"UNAUTHORIZED",code:1},CloudCameraStatus.INACTIVE={name:"INACTIVE",code:2},CloudCameraStatus.INACTIVE_BY_SCHEDULER={name:"INACTIVE_BY_SCHEDULER",code:3},CloudCameraStatus.OFFLINE={name:"OFFLINE",code:4},window.CloudTrialConnection=function(){var n=this;n.mAPI=null,n.AccountProviderUrl=window.location.protocol+"//cnvrclient2.videoexpertsgroup.com/",n.setAccpUrl=function(e){n.AccountProviderUrl=e},n.setSvcpUrlBase=function(e){n.ServiceProviderUrl=e},n.setApiConfig=function(e,o,r){n.ApiHost=e,n.ApiPort=o,n.ApiSecurePort=r},n.setCamConfig=function(e,o,r){n.CamHost=e,n.CamPort=o,n.CamSecurePort=r},n.open=function(e){var o=CloudHelpers.promise();return n.TrialKey=e,n.RequestData={username:n.TrialKey,password:n.TrialKey,cloud_token:!0},n._asyncLogin(o),o},n.isOpened=function(){return null!=n.mAPI},n.close=function(){n.mAPI=null},n._getAPI=function(){return n.mAPI},n.getUserInfo=function(){var t=CloudHelpers.promise();return n.isOpened()?n.mAPI.getAccountInfo().done(function(r){n.mAPI.getAccountCapabilities().done(function(e){var o=new CloudUserInfo(n,r,e);t.resolve(o)}).fail(function(e){CloudHelpers.handleError(e,t)})}).fail(function(e){CloudHelpers.handleError(e,t)}):t.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),t},n.getServerTimeDiff=function(){return n.mAPI.diffServerTime},n._asyncLogin=function(r){CloudHelpers.request({url:n.AccountProviderUrl+"api/v1/account/login/",type:"POST",data:JSON.stringify(n.RequestData),contentType:"application/json"}).done(function(e){if(e.cloud_token&&e.cloud_token.token){var o=CloudHelpers.parseUri(e.svcp_auth_app_url).host;o=window.location.protocol+"//"+o+"/",n.mAPI=new CloudAPI(e.cloud_token,n.ServiceProviderUrl||o),n.mAPI.getServerTime().done(function(){r.resolve()}).fail(function(e){r.reject(e)})}else console.warn("Try again after 1 sec"),setTimeout(function(){n._asyncLogin(r)},1e3)}).fail(function(e){console.error(e),r.reject(e)})}},window.CloudTokenConnection=function(){var a=this;a.mAPI=null,a.ServiceProviderUrl=window.location.protocol+"//web.skyvr.videoexpertsgroup.com/",a.open=function(e,o,r){var t={token:e,expire:o,type:"api"};r&&(a.ServiceProviderUrl=r);var n=CloudHelpers.promise();return a.mAPI=new CloudAPI(t,a.ServiceProviderUrl),a.mAPI.getServerTime().done(function(){n.resolve()}).fail(function(e){n.reject(e)}),n},a.isOpened=function(){return null!=a.mAPI},a.close=function(){a.mAPI=null},a._getAPI=function(){return a.mAPI},a.getUserInfo=function(){var t=CloudHelpers.promise();return a.isOpened()?a.mAPI.getAccountInfo().done(function(r){a.mAPI.getAccountCapabilities().done(function(e){console.warn("caps:",e);var o=new CloudUserInfo(a,r,e);t.resolve(o)}).fail(function(e){CloudHelpers.handleError(e,t)})}).fail(function(e){CloudHelpers.handleError(e,t)}):t.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),t},a.getServerTimeDiff=function(){return a.mAPI.diffServerTime}},window.CloudShareConnection=function(){var n=this;n.mAPI=null,n.ServiceProviderUrl=window.location.protocol+"//web.skyvr.videoexpertsgroup.com/",n.open=function(e){var o={token:e,expire:"",type:"share"},r=CloudHelpers.promise();return n.mAPI=new CloudAPI(o,n.ServiceProviderUrl),n.mAPI.getServerTime().done(function(){r.resolve()}).fail(function(e){r.reject(e)}),r},n.isOpened=function(){return null!=n.mAPI},n.close=function(){n.mAPI=null},n._getAPI=function(){return n.mAPI},n.getUserInfo=function(){var t=CloudHelpers.promise();return n.isOpened()?n.mAPI.getAccountInfo().done(function(r){n.mAPI.getAccountCapabilities().done(function(e){console.warn("caps:",e);var o=new CloudUserInfo(n,r,e);t.resolve(o)}).fail(function(e){CloudHelpers.handleError(e,t)})}).fail(function(e){CloudHelpers.handleError(e,t)}):t.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),t},n.getServerTimeDiff=function(){return n.mAPI.diffServerTime}},window.CloudUserConnection=function(){var t,n,a=this;a.mAPI=null,a.AccountProviderUrl=window.location.protocol+"//cnvrclient2.videoexpertsgroup.com/",a.open=function(e,o){t=e,n=o;var r=CloudHelpers.promise();return a.RequestData={username:t,password:n,cloud_token:!0},a._asyncLogin(r),r},a.isOpened=function(){return null!=a.mAPI},a.close=function(){a.mAPI=null},a._getAPI=function(){return a.mAPI},a.getUserInfo=function(){var t=CloudHelpers.promise();return a.isOpened()?a.mAPI.getAccountInfo().done(function(r){a.mAPI.getAccountCapabilities().done(function(e){console.warn("caps:",e);var o=new CloudUserInfo(a,r,e);t.resolve(o)}).fail(function(e){if(500==e.status){var o=new CloudUserInfo(a,r);t.resolve(o)}else CloudHelpers.handleError(e,t)})}).fail(function(e){CloudHelpers.handleError(e,t)}):t.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),t},a.getServerTimeDiff=function(){return a.mAPI.diffServerTime},a._asyncLogin=function(r){CloudHelpers.request({url:a.AccountProviderUrl+"api/v1/account/login/",type:"POST",data:JSON.stringify(a.RequestData),contentType:"application/json"}).done(function(e){if(e.cloud_token&&e.cloud_token.token){var o=CloudHelpers.parseUri(e.svcp_auth_app_url).host;o=window.location.protocol+"//"+o+"/",a.mAPI=new CloudAPI(e.cloud_token,o),a.mAPI.getServerTime().done(function(){r.resolve()}).fail(function(e){r.reject(e)})}else console.warn("Try again after 1 sec"),setTimeout(function(){a._asyncLogin(r)},1e3)}).fail(function(e){console.error(e),r.reject(e)})}},window.CloudUserInfo=function(e,o,r){var t,n,a,l,s,i,c,u,d,m=this,p=e;function f(e,o){n=o,a=(t=e).id,l=e.email,s=e.first_name,i=e.last_name,c=e.preferred_name,o?(u=o.cameras_creation.limits.total_cameras,o.cameras_creation.limits.hosted_cameras,d=o.cameras_creation.created.total_cameras,o.cameras_creation.created.hosted_cameras):d=u=0}f(o,r),m._getConn=function(){return p},m._origJsonAccount=function(){return t},m._origJsonCapabilities=function(){return n},m.getID=function(){return a},m.getEmail=function(){return l},m.getFirstName=function(){return s},m.getLastName=function(){return i},m.getPreferredName=function(){return c},m.getCameraLimit=function(){return u},m.getCameraCreated=function(){return d},m.refresh=function(){var r=CloudHelpers.promise();return p&&p.isOpened()?p._getAPI().getAccountInfo().done(function(o){p._getAPI().getAccountCapabilities().done(function(e){f(o,e),r.resolve()}).fail(function(e){500==e.status?f(o):CloudHelpers.handleError(e,r)})}).fail(function(e){CloudHelpers.handleError(e,r)}):r.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),r}},window.CloudCamera=function(e,o){var r=this;r.type="camera";var t,n,a,l,s,i,c,u,d,m,p,f,C,v,g,y,_,h,P,I=e,T=o.id,A=o.cmngrid;function R(e){a=(t=e).login,l=e.password,n=e.url,m=e.name,i=e.timezone,s=e.status,c=e.latitude,u=e.longitude,p=e.rec_mode,f="on"==e.rec_status,d=e.delete_at,C=e.brand,v=e.group_name,g=e.fw_version,_=e.model,mSerialNumber=e.serial_number,h=e.uuid,y=e.led,P=!!e.public&&e.public}var E={};R(o),r._getConn=function(){return console.log("mConn = "+I),I},r._origJson=function(){return t},r.getID=function(){return T},r.getRecStatus=function(){console.warn("TODO")},r.hasPTZ=function(){console.warn("TODO")},r.getURL=function(){return n},r.setURL=function(e){n=e,E.url=e},r.getURLLogin=function(){return a},r.setURLLogin=function(e){a=e,E.login=e},r.getURLPassword=function(){return l},r.setURLPassword=function(e){l=e,E.password=e},r.getDeleteAt=function(){return d},r.getTimezone=function(){return i},r.setTimezone=function(e){i=e,E.timezone=e},r.isPublic=function(){return P},r.setPublic=function(e){P=e,E.public=e},r.getStatus=function(){var e=s.toUpperCase();return CloudCameraStatus[e]?CloudHelpers.copy(CloudCameraStatus[e]):(console.error("Unknown camera status"),null)},r.getName=function(){return m},r.setName=function(e){m=e,E.name=e},r.getLatitude=function(){return c},r.setLatitude=function(e){c=e,E.latitude=e},r.getLongitude=function(){return u},r.setLongitude=function(e){u=e,E.longitude=e},r.isRecording=function(){return f},r.getCameraManagerID=function(){return A},r.getBrand=function(){return C},r.getGroupName=function(){return v},r.getFirmwareVersion=function(){return g},r.getModel=function(){return _},r.getUUID=function(){return h},r.getLed=function(){return y},r.setRecordingMode=function(e){e.name==CloudCameraRecordingMode.CONTINUES.name?E.rec_mode="on":e.name==CloudCameraRecordingMode.BY_EVENT.name?E.rec_mode="by_event":e.name==CloudCameraRecordingMode.NO_RECORDING.name?E.rec_mode="off":console.error("[CloudCamera] Unknown mode of recording")},r.getRecordingMode=function(){return"on"==p?CloudHelpers.copy(CloudCameraRecordingMode.CONTINUES):"by_event"==p?CloudHelpers.copy(CloudCameraRecordingMode.BY_EVENT):"off"==p?CloudHelpers.copy(CloudCameraRecordingMode.NO_RECORDING):void console.error("[CloudCamera] Unknown mode of recording")},r.save=function(){var o=CloudHelpers.promise();return I._getAPI().updateCamera(T,E).done(function(e){R(e),E.timezone?I._getAPI().updateCameraManager(A,{timezone:E.timezone}).done(function(){i=E.timezone,E={},o.resolve()}).fail(function(e){CloudHelpers.handleError(e,o)}):(E={},o.resolve())}).fail(function(e){CloudHelpers.handleError(e,o)}),o},r.getPreview=function(){var r=CloudHelpers.promise();if(!I||!I.isOpened())return r.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),r;var t=I._getAPI().diffServerTime;return I._getAPI().cameraPreview(T).done(function(o){console.log(o);var e=CloudHelpers.parseUTCTime(o.time);curr_time=CloudHelpers.getCurrentTimeUTC()+t,60<(curr_time-e)/1e3?I._getAPI().cameraUpdatePreview(T).done(function(e){r.resolve(o.url)}).fail(function(e){CloudHelpers.handleError(e,r)}):r.resolve(o.url)}).fail(function(e){CloudHelpers.handleError(e,r)}),r},r.getTimeline=function(a,l){var s=CloudHelpers.promise();if(!I||!I.isOpened())return s.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),s;var e=CloudHelpers.formatUTCTime(a),o=CloudHelpers.formatUTCTime(l);return I._getAPI().storageTimeline(T,e,o,2).done(function(e){var o={};o.start=a,o.end=l,o.periods=[];var r=e.objects[0][2];for(var t in r){var n={};n.start=CloudHelpers.parseUTCTime(r[t][0]),n.end=n.start+1e3*r[t][1],o.periods.push(n)}s.resolve(o)}).fail(function(e){CloudHelpers.handleError(e,s)}),s},r.getTimelineDays=function(e){var t=CloudHelpers.promise();return I&&I.isOpened()?I._getAPI().storageActivity(T,e).done(function(e){var o=[];for(var r in e.objects)o.push(CloudHelpers.parseUTCTime(e.objects[r]+"T00:00:00"));t.resolve(o)}).fail(function(e){CloudHelpers.handleError(e,t)}):t.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),t},r.getCameraUsage=function(){var o=CloudHelpers.promise();return I&&I.isOpened()?I._getAPI().cameraUsage(T).done(function(e){o.resolve(e)}).fail(function(e){CloudHelpers.handleError(e,o)}):o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o};var S="COMMON_SHARING_TOKEN";function w(e){var o={};return o.token=e,o.camid=T,o.access="watch",I.ServiceProviderUrl&&(o.svcp=I.ServiceProviderUrl),I.ApiHost&&(o.api=I.ApiHost),I.ApiPort&&80!=I.ApiPort&&(o.api_p=I.ApiPort),I.ApiSecurePort&&443!=I.ApiSecurePort&&(o.api_sp=I.ApiSecurePort),CloudHelpers.base64_encode(JSON.stringify(o))}r.enableSharing=function(){var n=CloudHelpers.promise();return I&&I.isOpened()?I._getAPI().getCameraSharingTokensList(T).done(function(e){var o=!1;for(var r in e.objects){var t=e.objects[r];if(t.name==S)return o=!0,void(1==t.enabled?n.resolve(w(t.token)):I._getAPI().updateCameraSharingToken(T,t.id,{enabled:!0}).done(function(e){n.resolve(w(t.token))}).fail(function(e){CloudHelpers.handleError(e,n)}))}o||I._getAPI().creareCameraSharingToken(T,S,["live","play","clipsplay"]).done(function(e){n.resolve(w(e.token))}).fail(function(e){CloudHelpers.handleError(e,n)})}).fail(function(e){CloudHelpers.handleError(e,n)}):n.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),n},r.disableSharing=function(e){var t=CloudHelpers.promise();return I&&I.isOpened()?I._getAPI().getCameraSharingTokensList(T).done(function(e){for(var o in e.objects){var r=e.objects[o];if(r.name==S)return!0,void I._getAPI().updateCameraSharingToken(T,r.id,{enabled:!1}).done(function(e){console.log(e),t.resolve()}).fail(function(e){CloudHelpers.handleError(e,t)})}t.reject()}).fail(function(e){CloudHelpers.handleError(e,t)}):t.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),t};var O="COMMON_SHARING_TOKEN_FOR_STREAM";function b(e){var o={};return o.token=e,o.camid=T,o.cmngrid=A,o.access="all",o.api_p=80,o.api_sp=443,o.cam="cam.skyvr.videoexpertsgroup.com",o.cam_p=8888,o.cam_sp=8883,I.ServiceProviderUrl&&(o.svcp=I.ServiceProviderUrl),I.ApiHost&&(o.api=I.ApiHost),I.ApiPort&&80!=I.ApiPort&&(o.api_p=I.ApiPort),I.ApiSecurePort&&443!=I.ApiSecurePort&&(o.api_sp=I.ApiSecurePort),I.CamHost&&(o.cam=I.CamHost),I.CamPort&&(o.cam_p=I.CamPort),I.CamSecurePort&&(o.cam_sp=I.CamSecurePort),CloudHelpers.base64_encode(JSON.stringify(o))}r.enableSharingForStream=function(){var n=CloudHelpers.promise();return I&&I.isOpened()?I._getAPI().getCameraSharingTokensList(T).done(function(e){var o=!1;for(var r in e.objects){var t=e.objects[r];if(t.name==O)return o=!0,void(1==t.enabled?n.resolve(b(t.token)):I._getAPI().updateCameraSharingToken(T,t.id,{enabled:!0}).done(function(e){n.resolve(b(t.token))}).fail(function(e){CloudHelpers.handleError(e,n)}))}o||I._getAPI().creareCameraSharingToken(T,O,["all"]).done(function(e){n.resolve(b(e.token))}).fail(function(e){CloudHelpers.handleError(e,n)})}).fail(function(e){CloudHelpers.handleError(e,n)}):n.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),n},r.getStreamingURL=function(){var o=CloudHelpers.promise();return I&&I.isOpened()?I._getAPI().getCameraStreamingURLs(T).done(function(e){o.resolve(e)}).fail(function(e){CloudHelpers.handleError(e,o)}):o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o},r.setPublishPassword=function(e){E.publish_password=e}},window.CloudCameraListFilter=function(){var n=this;n.filterParams={detail:"detail",limit:50},n.setLimit=function(e){n.filterParams.limit=e},n.setOffset=function(e){n.filterParams.offset=e},n.setName=function(e){void 0!==e?n.filterParams.name=e:delete n.filterParams.name},n.setPartOfName=function(e){void 0!==e?n.filterParams.name__icontains=e:delete n.filterParams.name__icontains},n.sortByName=function(e){n.filterParams.order_by=(e?"-":"")+"name"},n.sortByDate=function(e){n.filterParams.order_by=(e?"-":"")+"created"},n.setOwner=function(e){console.warn("setPublic is deprecated"),void 0!==e?n.filterParams.is_owner=e:delete n.filterParams.is_owner},n.setPublic=function(e){console.warn("setPublic is deprecated"),void 0!==e?n.filterParams.public=e:delete n.filterParams.public},n.setForStream=function(e){void 0!==e&&void 0!==e?n.filterParams.url__isnull=e:delete n.filterParams.url__isnull},n.setPrivacy=function(e){void 0!==e&&e.name?"PS_OWNER_NOT_PUBLIC"==e.name?(n.filterParams.public=!1,n.filterParams.is_owner=!0):"PS_OWNER"==e.name?(delete n.filterParams.public,n.filterParams.is_owner=!0):"PS_PUBLIC_NOT_OWNERS"==e.name?(n.filterParams.public=!0,n.filterParams.is_owner=!1):"PS_PUBLIC"==e.name?(n.filterParams.public=!0,delete n.filterParams.is_owner):"PS_OWNERS_PUBLIC"==e.name?(n.filterParams.public=!0,n.filterParams.is_owner=!0):("PS_ALL"==e.name||console.error("Unknown privacy filter"),delete n.filterParams.public,delete n.filterParams.is_owner):(console.error("Unknown privacy filter"),delete n.filterParams.public,delete n.filterParams.is_owner)},n.setURL=function(e){void 0!==e?n.filterParams.url=e:delete n.filterParams.url},n.setLatLngBounds=function(e,o,r,t){console.warn("[CloudCamerasListFilter] SetLatLngBounds, TODO test -1 < lat,lang < 1"),e<=o&&(n.filterParams.latitude__gte=e,n.filterParams.latitude__lte=o),r<=t&&(n.filterParams.longitude__gte=r,n.filterParams.longitude__lte=t)},n._values=function(){return n.filterParams}},window.CloudCameraList=function(e){var l=this,s=e;l.getCamera=function(e){var o=CloudHelpers.promise();return s&&s.isOpened()?s._getAPI().getCamera(e).done(function(e){o.resolve(new CloudCamera(s,e))}).fail(function(e){CloudHelpers.handleError(e,o)}):o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o},l.createCamera=function(e,o,r){var t=CloudHelpers.promise();if(!s||!s.isOpened())return t.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),t;var n={url:e,login:o,password:r};return s._getAPI().createCamera(n).done(function(e){t.resolve(new CloudCamera(s,e))}).fail(function(e){CloudHelpers.handleError(e,t)}),t},l.createCameraForStream=function(){var o=CloudHelpers.promise();if(!s||!s.isOpened())return o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o;return s._getAPI().createCamera({}).done(function(e){o.resolve(new CloudCamera(s,e))}).fail(function(e){CloudHelpers.handleError(e,o)}),o},l.findOrCreateCamera=function(e){var n=CloudHelpers.promise(),o=new CloudCameraListFilter;o.setOwner(!0);var a=CloudHelpers.splitUserInfoFromURL(e);return o.setURL(a.url),a.login=a.login||"",s._getAPI().camerasList(o._values()).done(function(e){var o=!1;for(var r in e.objects){var t=e.objects[r];if(t.login=t.login||"",t.login==a.login){o=!0,n.resolve(new CloudCamera(s,t));break}}o||l.createCamera(a.url,a.login,a.password).done(function(e){n.resolve(e)}).fail(function(e){CloudHelpers.handleError(e,n)})}).fail(function(e){CloudHelpers.handleError(e,n)}),n},l.getCameraList=function(e){var t=CloudHelpers.promise();return(e=e||new CloudCameraListFilter)._values?s&&s.isOpened()?s._getAPI().camerasList(e._values()).done(function(e){var o=[];for(var r in e.objects)o.push(new CloudCamera(s,e.objects[r]));t.resolve(o)}).fail(function(e){CloudHelpers.handleError(e,t)}):t.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION):(console.error(CloudReturnCode.ERROR_EXPECTED_FILTER),t.reject(CloudReturnCode.ERROR_EXPECTED_FILTER)),t},l.getCameraListLight=function(e){var o=CloudHelpers.promise();if(!(e=e||new CloudCameraListFilter)._values)return console.error(CloudReturnCode.ERROR_EXPECTED_FILTER),o.reject(CloudReturnCode.ERROR_EXPECTED_FILTER),o;if(!s||!s.isOpened())return o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o;var r=e._values();return delete filterMap.detail,s._getAPI().camerasList(r).done(function(e){o.resolve(e.objects)}).fail(function(e){CloudHelpers.handleError(e,o)}),o},l.deleteCamera=function(e){var o=CloudHelpers.promise();return s&&s.isOpened()?s._getAPI().deleteCamera(e).done(function(){o.resolve()}).fail(function(e){CloudHelpers.handleError(e,o)}):o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o}},window.CloudSession=function(e,o){var r=this;r.type="session";var t,n,a,l,s,i,c,u,d,m,p,f,C,v,g,y,_,h=e,P=o.id,I=0,T=0,A=0;function R(e){n=(t=e).active,a=e.title,e.preview&&(l=e.preview.url),e.live_urls&&(g=e.live_urls.rtmp,y=e.live_urls.hls,_=e.live_urls.expire),c=e.latitude,u=e.longitude,s=e.streaming,i=e.public,d=e.start,m=e.end,p=e.has_records,e.statistics&&(T=e.statistics.peak_live||0,A=e.statistics.playback||0,I=e.statistics.live||0),v=e.author?e.author.preferred_name:"unknown",e.access&&(f=-1!=e.access.indexOf("all"),C=-1!=e.access.indexOf("watch"))}l="";R(o),r._getConn=function(){return h},r._origJson=function(){return t},r.hasAccessAll=function(){return f},r.hasAccessWatch=function(){return f||C},r.getID=function(){return P},r.isOnline=function(){return n},r.getTitle=function(){return a},r.getAuthorPreferredName=function(){return v},r.getStatisticsLive=function(){return I},r.getStatisticsPeakLive=function(){return T},r.getStatisticsPlayback=function(){return A},r.getStartTime=function(){return null==d?(console.error("[CloudSession] #"+P+" Start time is null"),0):CloudHelpers.parseUTCTime(d)},r.getEndTime=function(){return null==d?(console.error("[CloudSession] #"+P+" End time is null but session is mActive: "+n),0):CloudHelpers.parseUTCTime(m)},r.getPreview=function(){return l},r.getLatitude=function(){return c},r.getLongitude=function(){return u},r.isStreaming=function(){return s},r.isPublic=function(){return i},r.hasRecords=function(){return p},r.getLiveUrl_Rtmp=function(){return g},r.getLiveUrl_HLS=function(){return y},r.getLiveUrl_Expire=function(){return _},r.refresh=function(){var o=CloudHelpers.promise();return h._getAPI().getCamsess(P).done(function(e){R(e),o.resolve()}).fail(function(e){CloudHelpers.handleError(e,o)}),o}},window.CloudSessionListFilter=function(){var n=this;n.filterParams={limit:50,order_by:"-start"},n.setLimit=function(e){n.filterParams.limit=e},n.setOffset=function(e){n.filterParams.offset=e},n.setTitle=function(e){n.filterParams.title__icontains=e},n.setStartLessThen=function(e){n.filterParams.start__lte=e},n.setHasRecords=function(e){"any"==e||("yes"==e?(n.filterParams.has_records=!0,n.filterParams.active=!1):"no"==e?(n.filterParams.has_records=!1,n.filterParams.active=!1):console.error("[CloudSessionListFilter] setHasRecords, expected 'any', 'yes' or 'no'"))},n.setStreaming=function(e){"any"==e||("yes"==e?(n.filterParams.streaming=!0,n.filterParams.camera_online=!0,n.filterParams.active=!0):"no"==e?(n.filterParams.streaming=!1,delete n.filterParams.camera_online,n.filterParams.active=!1):console.error("[CloudSessionListFilter] setStreaming, expected 'any', 'yes' or 'no'"))},n.setAuthorName=function(e){n.filterParams.author_name__icontains=e},n.setAuthorID=function(e){e?n.filterParams.author_id=e:delete n.filterParams.author_id},n.setAuthorPreferredName=function(e){e?n.filterParams.author_preferred_name__icontains=e:delete n.filterParams.author_preferred_name__icontains},n.setWithDetails=function(){console.warn("[CloudSessionListFilter] 'setWithDetails' not supported anymore. Please use getSessionList or getSessionListLight")},n.setOnline=function(e){console.warn("[CloudSessionListFilter] 'setOnline' not supported anymore")},n.setPublic=function(e){"any"==e||("yes"==e?n.filterParams.public=!0:"no"==e?n.filterParams.public=!1:console.error("[CloudSessionListFilter] setOnline, expected 'any', 'yes' or 'no'"))},n.setLatLngBounds=function(e,o,r,t){e<=o?(n.filterParams.latitude__gte=e,n.filterParams.latitude__lte=o):console.error("[CloudCamerasListFilter] latitude_max must be greater or equal to latitude_min"),r<=t?(n.filterParams.longitude__gte=r,n.filterParams.longitude__lte=t):console.error("[CloudCamerasListFilter] longitude_max must be greater or equal to longitude_min")},n._values=function(){var e={};for(var o in n.filterParams)e[o]=n.filterParams[o];return e}},window.CloudSessionList=function(e){var n=e;this.getSession=function(e){var o=CloudHelpers.promise();return n&&n.isOpened()?n._getAPI().getCamsess(e).done(function(e){o.resolve(new CloudSession(n,e))}).fail(function(e){CloudHelpers.handleError(e,o)}):o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o},this.getSessionList=function(e){var t=CloudHelpers.promise();if(!(e=e||new CloudSessionListFilter)._values)return console.error(CloudReturnCode.ERROR_EXPECTED_FILTER),t.reject(CloudReturnCode.ERROR_EXPECTED_FILTER),t;if(!n||!n.isOpened())return t.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),t;var o=e._values();return o.detail="detail",n._getAPI().getCamsessList(o).done(function(e){var o=[];for(var r in e.objects)o.push(new CloudSession(n,e.objects[r]));t.resolve(o)}).fail(function(e){CloudHelpers.handleError(e,t)}),t},this.getSessionListLight=function(e){var o=CloudHelpers.promise();if(!(e=e||new CloudSessionListFilter)._values)return console.error(CloudReturnCode.ERROR_EXPECTED_FILTER),o.reject(CloudReturnCode.ERROR_EXPECTED_FILTER),o;if(!n||!n.isOpened())return o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o;var r=e._values();return delete r.detail,n._getAPI().getCamsessList(r).done(function(e){o.resolve(e.objects)}).fail(function(e){CloudHelpers.handleError(e,o)}),o},this.deleteSession=function(e){var o=CloudHelpers.promise();return n&&n.isOpened()?n._getAPI().deleteCamsess(e).done(function(){o.resolve()}).fail(function(e){CloudHelpers.handleError(e,o)}):o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o}},window.CloudPlayerEvent={},CloudPlayerEvent.CONNECTING={name:"CONNECTING",code:0,text:"Connection is establishing"},CloudPlayerEvent.CONNECTED={name:"CONNECTED",code:1,text:"Connection is established"},CloudPlayerEvent.PLAYED={name:"PLAYED",code:2,text:"Player changes state to PLAY."},CloudPlayerEvent.PAUSED={name:"PAUSED",code:3,text:"Player state is PAUSE."},CloudPlayerEvent.CLOSED={name:"CLOSED",code:6,text:"Player state is CLOSED."},CloudPlayerEvent.SEEK_COMPLETED={name:"SEEK_COMPLETED",code:17,text:"setPosition() is successfully finished."},CloudPlayerEvent.ERROR={name:"ERROR",code:105,text:"Player is disconnected from media stream due to an error"},CloudPlayerEvent.SOURCE_CHANGED={name:"SOURCE_CHANGED",code:3e3,text:"setSource() is successfully finished."},CloudPlayerEvent.POSITION_JUMPED={name:"POSITION_JUMPED",code:3001,text:"Position was changed by player (possible that player did not found records)."},window._cloudPlayers=window._cloudPlayers||{},window.CloudPlayer=function(a,e){var y=this;e=e||{},y.elid=a;var o,c=null,n=null,t=!0,l=0,s=!0,i=!1,u=0,d={},m="",p=null,f=null,C=null,v=null,g=null,_=null,h=!1,P=null,I=null,T=null,A=null,R=null,E=null;if(y.timePolingLiveUrls=15e3,y.player=document.getElementById(a),_cloudPlayers[a])return _cloudPlayers[a];var S=null,w=null,O=-1,b=-1,k={w:0,h:0};if(CloudHelpers.isChrome()&&!CloudHelpers.isMobile()?(videojs.options.hls=videojs.options.hls||{},videojs.options.html5.nativeAudioTracks=!0,videojs.options.html5.nativeVideoTracks=!0,videojs.options.hls.overrideNative=!1):(videojs.options.hls=videojs.options.hls||{},videojs.options.html5.nativeAudioTracks=!1,videojs.options.html5.nativeVideoTracks=!1,videojs.options.hls.overrideNative=!0),videojs.options.hls.withCredentials=!1,null==y.player)return console.error("[CloudPlayer] Not found element"),null;if("DIV"!=y.player.tagName)return console.error("[CloudPlayer] Expected DIV tag but got "+y.player.tagName),null;var N=-1,D=0,L=2e3,H=5e3,U=null,j=null;y.m={},y.m.waitSourceActivation=e.waitSourceActivation||0,y.m.waitSourceActivation<0&&(console.warn("[CloudPlayer] option waitSourceActivation must be greater than -1"),y.m.waitSourceActivation=0),y.m.useNativeHLS=e.useNativeHLS||!1,y.m.backwardAudio=!1,y.m.backwardAudio=e.backwardAudio||null!=y.player.getAttribute("backward-audio")||y.m.backwardAudio,y.defualtAutohide=CloudHelpers.isMobile()?0:3e3,void 0!==e.autohide?y.m.autohide=e.autohide:y.m.autohide=y.defualtAutohide,y.mPlayerFormat="flash";var M="";if(e.preferredPlayerFormat)M=e.preferredPlayerFormat;else try{M=localStorage.getItem("preferred_player_format")}catch(e){console.error("[CloudPlayer] error load format: ",e)}if("webrtc"==M||"html5"==M||"flash"==M?y.mPlayerFormat=M:console.error("[CloudPlayer] Unknown player format: ",M),e.useOnlyPlayerFormat){var x=e.useOnlyPlayerFormat;if("webrtc"!==x&&"html5"!==x&&"flash"!==x)console.error("Wrong value of useOnlyPlayerFormat, expected 'webrtc' or 'html5' or 'flash'");else{y.mPlayerFormat=x,A=x;try{localStorage.setItem("preferred_player_format",x)}catch(e){}}}void 0!==e.mute&&(y.m.mute=!0===e.mute),y.swf_backwardaudio="",y.player.classList.add("cloudplayer"),y.player.classList.add("green"),y.player.classList.add("black"),y.player.innerHTML='<div class="cloudplayer-loader" style="display: inline-block"></div><div class="cloudplayer-screenshot-loading" style="display: none">\t\t<div class="cloudplayer-screenshot-loading">     </div></div><div class="cloudplayer-error" style="display: none">\t<div class="cloudplayer-error-text" style="display: none"></div></div><div class="cloudplayer-controls-zoom-position">\t\t<div class="cloudplayer-zoom-position-cursor"></div></div><div class="cloudplayer-watermark"></div><div class="cloudplayer-sdkversion">SDK '+CloudSDK.version+'</div><div class="cloudplayer-info" style="display: none">\t\t<div class="cloudplayer-info-title">Settings</div>\t\t<div class="cloudplayer-info-close">X</div>\t\t<div class="cloudplayer-info-playerversion">Version: '+CloudSDK.version+" ("+CloudSDK.datebuild+')</div>\t\t<div class="cloudplayer-info-playertype">Used player:</div>\t\t<div class="cloudplayer-info-player-mode" style="'+(null!==A?"display: none":"")+'">Preferred format: \t\t\t<div class="cloudplayer-player-mode cloudplayer-webrtc-mode" style="display: none">WebRTC</div> \t\t<div class="cloudplayer-player-mode cloudplayer-flash-mode selected">RTMP</div> \t\t<div class="cloudplayer-player-mode cloudplayer-html5-mode">HLS</div>\t\t</div>\t\t\x3c!-- div class="cloudplayer-info-latency">Player Latency: \t\t\t<div class="cloudplayer-info-latency-minimal">Minimal Latency</div>\t\t\t/  \t\t<div class="cloudplayer-info-latency-smoothless">Maximum Smoothness</div>\t\t</div --\x3e\t\t\x3c!-- div class="cloudplayer-info-latency-not-supported">Player Latency: Setting is not available for HTML5 player</div --\x3e\t\t<div class="cloudplayer-info-bufferlength"></div>\t\t<div class="cloudplayer-info-audio-stream">Audio stream: \t\t\t<div class="cloudplayer-info-audio-stream-on">On</div>\t\t\t/  \t\t<div class="cloudplayer-info-audio-stream-off">Off</div>\t\t</div></div><div class="cloudplayer-backwardaudio-container">'+(y.m.backwardAudio?'<object data="'+y.swf_backwardaudio+'" type="application/x-shockwave-flash" id="backwardaudio_swf_single" align="top">\t\t<param name="movie" value="'+y.swf_backwardaudio+'" />\t\t<embed type="application/x-shockwave-flash" src="'+y.swf_backwardaudio+'">\t\t<param name="allowScriptAccess" value="always"/>\t\t<param value="allowNetworking" value="all"/>\t\t<param name="menu" value="true" />\t\t<param name="wmode" value="transparent"/>\t\t\x3c!-- param name="bgcolor" value="#ffffff" / --\x3e\t\t<param name="menu" value="false" /></object>':"")+'</div><div class="cloudplayer-controls-zoom">\t<div class="cloudplayer-zoom-up"></div>\t<div class="cloudplayer-zoom-progress zoom10x"></div>\t<div class="cloudplayer-zoom-down"></div></div><div class="cloudplayer-controls">\t<div class="cloudplayer-settings"></div>\t<div class="cloudplayer-volume-mute"></div>\t<div class="cloudplayer-volume-down"></div>\t<div class="cloudplayer-volume-progress vol7"></div>\t<div class="cloudplayer-volume-up"></div>\t<div class="cloudplayer-play" style="display: none"></div>\t<div class="cloudplayer-stop" style="display: none"></div>\t<div class="cloudplayer-microphone"></div>\t<div class="cloudplayer-time"></div>\t<div class="cloudplayer-fullscreen"></div></div><div class="cloudcameracalendar-content"></div><div class="cloudplayer-big-play-button" style="display: none"></div><video crossorigin="anonymous" id="'+a+'_vjs" class="video-js" preload="auto" class="video-js vjs-default-skin vjs-live" muted=true autoplay=true preload playsinline="true"></video><video crossorigin="anonymous" id="'+a+'_vjs2" class="video-js" preload="auto" class="video-js vjs-default-skin vjs-live" muted=true autoplay=true preload playsinline="true" ></video><video crossorigin="anonymous" id="'+a+'_native_hls" class="cloudplayer-native-hls" autoplay=true preload  playsinline="true" ></video><video crossorigin="anonymous" id="'+a+'_webrtc" class="cloudplayer-webrtc" autoplay=true preload  playsinline="true" ></video><div class="cloudplayer-black-screen" style="display: none">\t\t<div class="cloudplayer-watermark"></div>\t\t<div class="cloudplayer-sdkversion">SDK '+CloudSDK.version+"</div></div>",y.vjs=videojs(a+"_vjs",{controls:!1}),y.vjs2=videojs(a+"_vjs2",{controls:!1}).ready(function(){y.vjs2.el().style.display="none"}),y.vjs.on("error",function(e){if(le(),null!=y.vjs.error()){var o=y.vjs.error();4!=o.code||CloudHelpers.supportFlash()||CloudHelpers.isMobile()?3==o.code&&CloudHelpers.isMobile()?de(CloudReturnCode.ERROR_COULD_NOT_DECODE_STREAM_OR_COULD_NOT_SET_COOKIE_HLS):de({name:"VIDEOJS_ERROR",text:"Code "+o.code+": "+o.message,code:-6e3}):de({name:"REQUIRE_FLASH",text:"Please install and enable <a target='_black' href='https://get.adobe.com/flashplayer/'>Adobe Flash Player</a> and try again",code:-6001})}y.stop("by_vjs_error")});var F=null;y.time=0;var W=y.player.getElementsByClassName("cloudplayer-controls")[0],B=y.player.getElementsByClassName("cloudplayer-controls-zoom")[0],z=y.player.getElementsByClassName("cloudplayer-controls-zoom-position")[0],$=y.player.getElementsByClassName("cloudplayer-play")[0],G=y.player.getElementsByClassName("cloudplayer-info")[0],q=y.player.getElementsByClassName("cloudplayer-stop")[0],V=y.player.getElementsByClassName("cloudplayer-loader")[0],J=y.player.getElementsByClassName("cloudplayer-error")[0],Z=y.player.getElementsByClassName("cloudplayer-error-text")[0],K=y.player.getElementsByClassName("cloudplayer-time")[0],Y=y.player.getElementsByClassName("cloudplayer-big-play-button")[0];p=y.player.getElementsByClassName("cloudplayer-webrtc")[0],g=y.player.getElementsByClassName("cloudplayer-native-hls")[0];var X=y.player.getElementsByClassName("cloudplayer-info-playertype")[0],Q=y.player.getElementsByClassName("cloudplayer-settings")[0],ee=y.player.getElementsByClassName("cloudplayer-info-close")[0],oe=y.player.getElementsByClassName("cloudplayer-webrtc-mode")[0],re=y.player.getElementsByClassName("cloudplayer-flash-mode")[0],te=y.player.getElementsByClassName("cloudplayer-html5-mode")[0];function ne(){J.style.display="none",Z.style.display="none"}function ae(){1==y.mShowedBigPlayButton?le():t||(V.style.display="inline-block",t=!0)}function le(){t&&(V.style.display="none",t=!1)}function se(e){e=e||{},oe.style.display=e.rtc||e.webrtc?"":"none",re.style.display=!CloudHelpers.isMobile()&&e.rtmp?"":"none",te.style.display=e.hls?"":"none",oe.classList.remove("selected"),re.classList.remove("selected"),te.classList.remove("selected"),"webrtc"==y.mPlayerFormat?oe.classList.add("selected"):"flash"==y.mPlayerFormat?re.classList.add("selected"):"html5"==y.mPlayerFormat&&te.classList.add("selected")}o=y.player.getElementsByClassName("cloudcameracalendar-content")[0],Q.onclick=function(){""!=G.style.display?G.style.display="":G.style.display="none"},ee.onclick=function(){G.style.display="none"},oe.onclick=function(){y.setPlayerFormat("webrtc"),y.play()},re.onclick=function(){y.setPlayerFormat("flash"),y.play()},te.onclick=function(){y.setPlayerFormat("html5"),y.play()},CloudHelpers.isMobile()&&(re.style.display="none"),se();var ie=y.player.getElementsByClassName("cloudplayer-black-screen")[0];function ce(){CloudHelpers.isFireFox()?console.warn("in firefox not good solution for a hiding adobe flash player"):ie.style.display="block"}function ue(){ie.style.display=""}function de(e){console.error(e),y._setError(e),y.showErrorText(e.text),console.error(e.text)}le();var me=60,pe=15,fe=null,Ce=0,ve=null,ge=null,ye=null,_e=null;function he(e,o){function r(e,o,r){setTimeout(function(){d[e](o,r)},1)}for(var t in d)r(t,e,o)}function Pe(){var e=0;"camera"==y.mSrc.type&&(e=CloudHelpers.getOffsetTimezone(y.mSrc.getTimezone()));var o=new Date;return o.setTime(o.getTime()+e)," "+("0000"+o.getUTCFullYear()).slice(-4)+"-"+("00"+(o.getUTCMonth()+1)).slice(-2)+"-"+("00"+o.getUTCDate()).slice(-2)+" "+("00"+o.getUTCHours()).slice(-2)+":"+("00"+o.getUTCMinutes()).slice(-2)+":"+("00"+o.getUTCSeconds()).slice(-2)}function Ie(){clearInterval(R),K.innerHTML=""}function Te(){console.warn("[PLAYER] Start poling player time"),clearInterval(R),R=setInterval(function(){if(i&&!s){var e=0;if("session_records"==fe)e=Math.floor(ye.currentTime()),e+=ve[Ce].startUTC-ge;else if("camera_records"==fe)e=U.startUTC+1e3*S.currentTime();else if("camera_live"==fe)if("webrtc0"==m||"webrtc1"==m||"webrtc2"==m)e=p?p.currentTime:0;else if("native-hls"==m)e=g?g.currentTime:0;else{e=1e3*y.vjs.currentTime();try{t=y.vjs.videoHeight(),n=y.vjs.videoWidth(),k.w==n&&k.h==t||(setTimeout(function(){var e=y.vjs.el().getElementsByTagName("object")[0];e&&(e.style.width="calc(100% - 5px)",setTimeout(function(){e.style.width=""},1e3))},1e3),k.w=n,k.h=t)}catch(e){}}else e=1e3*y.vjs.currentTime();e==y.time?(ae(),l++,0==y.time&&me<l?(y.stop("by_poling_time_1"),de(CloudReturnCode.ERROR_STREAM_UNREACHABLE)):0!=y.time&&pe<l?(console.warn("Restart player"),y.stop("by_poling_time_2"),-1!=N&&y.time>N&&(N=Math.floor(y.time)),y.play()):console.warn("[PLAYER] Wait stream "+l)):(l=0,y.mShowedBigPlayButton,Y.style.display="none","session_records"==fe?(y.time=e,K.innerHTML=("00"+(o=((o=y.time)-(r=o%60))/60)%60).slice(-2)+":"+("00"+r).slice(-2)):"camera_records"==fe?(y.time=e,K.innerHTML=function(e){var o=0;"camera"==y.mSrc.type&&(o=CloudHelpers.getOffsetTimezone(y.mSrc.getTimezone()));var r=new Date;return r.setTime(e+o)," "+("0000"+r.getUTCFullYear()).slice(-4)+"-"+("00"+(r.getUTCMonth()+1)).slice(-2)+"-"+("00"+r.getUTCDate()).slice(-2)+" "+("00"+r.getUTCHours()).slice(-2)+":"+("00"+r.getUTCMinutes()).slice(-2)+":"+("00"+r.getUTCSeconds()).slice(-2)}(y.time)):"camera_live"==fe?(y.time=e,K.innerHTML=Pe(),y.isRange()&&CloudHelpers.getCurrentTimeUTC()>b&&(Ie(),y.stop("by_ended_timerange2"))):(y.time=-1==N?1e3*y.vjs.currentTime():U.startUTC+1e3*y.vjs.currentTime(),K.innerHTML=Pe()),le(),ne()),y.isRange()&&y.time>b&&(Ie(),y.stop("by_ended_timerange"))}else le(),K.innerHTML="";var o,r,t,n},1e3)}function Ae(){if(null!=U){var a=U.endUTC,e=CloudHelpers.formatUTCTime(a-5*CloudHelpers.ONE_SECOND);if(j=null,y.isRange()&&b<e)return;if(null==c._getAPI())return;c._getAPI().storageRecordsFirst(y.mSrc.getID(),e,3).done(function(e){if(0==e.meta.total_count)j=null;else for(var o=e.objects.length,r=0;r<o;r++){var t=CloudHelpers.parseUTCTime(e.objects[r].start);if(a<=t&&null==j){(j=e.objects[r]).startUTC=CloudHelpers.parseUTCTime(j.start),j.endUTC=CloudHelpers.parseUTCTime(j.end);var n=j.url;0==n.indexOf("http://")&&(n=n.replace("http://",location.protocol+"//")),w.src([{src:n,type:"video/mp4"}]),w.off("loadeddata"),w.on("loadeddata",function(){w.pause()});break}}})}else j=null}function Re(){"session"==y.mSrc.type?y.mSrc.refresh().done(function(){fe="session_live",CloudHelpers.useHls()?(console.log("Set url (hls): "+y.mSrc.getLiveUrl_HLS()),Te(),function e(o){o=o||y.mSrc.getID();var r=new XMLHttpRequest;r.open("GET",y.mSrc.getLiveUrl_HLS()),r.onload=function(){if(200===r.status){if(y.mSrc.getID()!=o)return;y._applyMediaTiket(y.mSrc.getLiveUrl_HLS(),y.mSrc.getLiveUrl_Expire()),y._startPolingMediaTicket(),y.vjs.src([{src:y.mSrc.getLiveUrl_HLS(),type:"application/x-mpegURL"}]),r=null}else if(404===r.status){if(y.mSrc.getID()!=o)return void console.warn("[CLOUDPLAYER] polingSessionHLSList, camid was changed stop poling hls list, currentCmaID="+y.mSrc.getID()+", camid="+o);if(me<++l)return y.stop("by _polingSessionHLSList"),void de(CloudReturnCode.ERROR_STREAM_UNREACHABLE_HLS);setTimeout(function(){console.warn("Wait one sec "+y.mSrc.getLiveUrl_HLS()),r=null,e(o)},1e3)}else console.error("Unhandled")},r.send()}()):y.vjs.ready(function(){console.log("Set url (rtmp): "+y.mSrc.getLiveUrl_Rtmp()),y.vjs.options().flash.swf=CloudSDK.flashswf||"last/video-js-by-vxg-buff200.swf",y.vjs.src([{src:y.mSrc.getLiveUrl_Rtmp(),type:"rtmp/mp4"}]),ce()}),y.vjs.on("ended",function(){y.stop("by_vjs_ended_2")}),y.vjs.on("loadeddata",function(){le(),ke(),Ne(),ue()}),Te()}):de(CloudReturnCode.ERROR_INVALID_SOURCE)}function Ee(e){"session"==y.mSrc.type?c._getAPI().getCamsessRecords(y.mSrc.getID()).done(function(e){if(0==e.meta.total_count);else{for(var o in Ce=0,ve=e.objects,fe="session_records",ve)console.log(ve[o]),ve[o].startUTC=Math.floor(CloudHelpers.parseUTCTime(ve[o].start)/1e3),ve[o].endUTC=Math.floor(CloudHelpers.parseUTCTime(ve[o].end)/1e3),0==o&&(ge=ve[o].startUTC,console.log(ge));ye=y.vjs,_e=y.vjs2,ye.src([{src:ve[Ce].url,type:"video/mp4"}]),function o(){Ce+1<ve.length&&(_e.src([{src:ve[Ce+1].url,type:"video/mp4"}]),_e.one("loadeddata",function(){_e.pause()})),ye.one("ended",function(){if(++Ce<ve.length){var e=ye;ye=_e,_e=e,ye.play(),_e.el().style.display="none",ye.el().style.display="",console.log("Switched players"),o()}else y.stop("by_preapreToPlayNextSessionRecord")})}(),y.vjs.one("loadeddata",function(){le(),ke(),Ne()}),y.vjs2.one("loadeddata",function(){le(),ke(),Ne()}),Te()}}).fail(function(e){console.error(e)}):de(CloudReturnCode.ERROR_INVALID_SOURCE)}function Se(e){y.mSrc?(l=0,"camera"==y.mSrc.type?function(s){if("camera"==y.mSrc.type){y.updateAudioCaps&&y.updateAudioCaps(y.mSrc.getID()),fe="camera_records";var i=N,e=CloudHelpers.formatUTCTime(i-2*CloudHelpers.ONE_MINUTE);null!=c._getAPI()&&c._getAPI().storageRecordsFirst(y.mSrc.getID(),e,25).done(function(e){if(s==F){var o=e.objects.length,r=U=null;ue();for(var t=0,n=0;n<o;n++)if(rec=e.objects[n],rec.startUTC=CloudHelpers.parseUTCTime(rec.start),rec.endUTC=CloudHelpers.parseUTCTime(rec.end),null==r&&rec.startUTC>i&&(r=rec,console.log("firstRecordAfterT selected")),rec.startUTC>i&&t++,!(i>rec.endUTC||i<rec.startUTC)&&null==U&&i>=rec.startUTC&&i<=rec.endUTC){U=rec;break}if(y.isRange()&&null==U)for(n=0;n<o&&(rec=e.objects[n],rec.startUTC=CloudHelpers.parseUTCTime(rec.start),rec.endUTC=CloudHelpers.parseUTCTime(rec.end),!(rec.startUTC>b));n++)if(null==U&&i<rec.startUTC&&rec.startUTC<b){U=rec,i=rec.startUTC;break}if(y.isRange()||null!=U||0!=t){var a=!1;if(y.isRange()||null!=U||null==r||(i=(U=r).startUTC,a=!0),null==U)return le(),de(CloudReturnCode.ERROR_RECORDS_NOT_FOUND),void Ie();if(s==F){if(y.isRange()&&b<i)return le(),Ie(),void y.stop("by_ended_time_range_2");a&&he(CloudPlayerEvent.POSITION_JUMPED,{new_pos:i}),S=y.vjs,w=y.vjs2,S.el().style.display="",w.el().style.display="none",Ae(),S.ready(function(){var e=U.url;0==e.indexOf("http://")&&(e=e.replace("http://",location.protocol+"//")),S.src([{src:e,type:"video/mp4"}]);var o=i-U.startUTC,r=U.endUTC-U.startUTC;console.log(o+" / "+r),S.currentTime(Math.floor(o/1e3))}),S.off("loadeddata"),S.off("ended"),w.off("ended"),S.on("ended",l),w.on("ended",l),Te()}else console.warn("_uniqPlay not current [[_loadCameraRecords fail]]")}else setTimeout(function(){y.setPosition(CloudPlayer.POSITION_LIVE),y.play(),he(CloudPlayerEvent.POSITION_JUMPED,{new_pos:CloudHelpers.getCurrentTimeUTC()})},10)}else console.warn("_uniqPlay not current [[_loadCameraRecords fail]]");function l(){if(console.warn("ended"),y.isRange()&&null==j)return console.warn("stop player"),le(),Ie(),void y.stop("by_ended_time_range_3");if(null!=j){var e=S;S=w,w=e,S.el().style.display="",w.el().style.display="none",U=j,j=null,S.ready(function(){S.play()}),Ae()}}})}else de(CloudReturnCode.ERROR_INVALID_SOURCE)}(e):de(CloudReturnCode.ERROR_INVALID_SOURCE)):de(CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED)}function we(){console.log("[PLAYER] vjs_play, mEvent: ",n);var e=CloudHelpers.useHls()&&CloudHelpers.isSafari(),o=CloudHelpers.isIOS()||CloudHelpers.isAndroid(),r=CloudHelpers.isFrame()&&CloudHelpers.useHls(),t=CloudHelpers.isChrome()&&!CloudHelpers.autoPlayAllowed&&CloudHelpers.useHls();if(!n&&(o||e||r||t)){Ie();try{y.vjs.pause()}catch(e){console.warn("_vjs_play: skip error",e)}l=0,console.warn("_vjs_play. is mobile. show big button"),!0,Y.style.display="block",Y.onclick=function(e){n=e,Y.style.display="none",document.getElementById("player1_vjs_Html5_api")&&(document.getElementById("player1_vjs_Html5_api").setAttribute("webkit-playsinline",!0),document.getElementById("player1_vjs_Html5_api").setAttribute("playsinline",!0)),!1,l=0,y.vjs.play(),Ie(),Te()},console.log("vjs_play ")}else y.vjs.play(),Ie(),Te()}if(y.showErrorText=function(e){le(),J.style.display="inline-block",Z.style.display="inline-block",Z.innerHTML=e,ue()},y.getCalendarContent=function(){return o},y.setSource=function(e){if(ne(),clearInterval(P),y.mSrc=e,c=null==y.mSrc?($.style.display="none",null):($.style.display="inline-block",e._getConn()),y.isRange()){var o=CloudHelpers.getCurrentTimeUTC();O<o&&o<b?y.setPosition(CloudPlayer.POSITION_LIVE):y.setPosition(O)}else y.setPosition(CloudPlayer.POSITION_LIVE);he(CloudPlayerEvent.SOURCE_CHANGED)},y.getSource=function(){return y.mSrc},y.removeCallback=function(e){delete d[e]},y.addCallback=function(e,o){"function"==typeof o?(d[e]&&(console.warn(e+" - already registered callback, will be removed before add"),y.removeCallback(e)),d[e]=o):console.error("Second parameter expected function")},y.setPlayerFormat=function(e){if("webrtc"==(e=e.toLowerCase())||"flash"==e||"html5"==e){y.mPlayerFormat=e;try{localStorage.setItem("preferred_player_format",y.mPlayerFormat)}catch(e){console.error("[CloudPlayer] error save format: ",e)}se()}else console.error("Player format expected 'webrtc' or 'flash' or 'html5'")},y.getPlayerFormat=function(){return sMode},y.play=function(e){i&&y.stop("by_play"),"camera"==y.mSrc.type||"session"==y.mSrc.type?(F=Math.random(),n=e,console.warn("[PLAYER] mUniqPlay: "+F),q.style.display="inline-block",$.style.display="none",i=!(s=!1),Ie(),Te(),y._reset_vjs(),ne(),-1==N?function(e){if(e==F){if(!y.mSrc)return console.error("[CloudPlayer] source not set"),y.setError(100);if("active"!=y.mSrc._origJson().status)return 0==y.m.waitSourceActivation&&de(CloudReturnCode.ERROR_CAMERA_OFFLINE),xe(e);l=0,"camera"==y.mSrc.type?(xe(e),y._polingLoadCameraLiveUrl(e)):"session"==y.mSrc.type?y.mSrc.isOnline()?Re():Ee():(console.error("[CloudPlayer] invalid source"),y.setError(100))}else console.warn("_uniqPlay not current [cameraLiveUrls fail]")}(F):(console.warn("Try load records from "+CloudHelpers.formatUTCTime(N)),Se(F)),ae()):de(CloudReturnCode.ERROR_INVALID_SOURCE)},y.setPosition=function(e){y.time=0,(N=e)==CloudHelpers.POSITION_LIVE&&(h=!0)},void 0!==e.position&&y.setPosition(N),y.getPosition=function(){return i?-1==N?"webrtc0"!=m&&"webrtc1"!=m&&"webrtc2"!=m||!p||0==p.currentTime?"native-hls"==m&&g&&0!=g.currentTime?CloudHelpers.getCurrentTimeUTC()+(c?c.getServerTimeDiff():0):"webrtc0"!=m&&"webrtc1"!=m&&"webrtc2"!=m&&y.vjs&&0!=y.vjs.currentTime()?CloudHelpers.getCurrentTimeUTC()+(c?c.getServerTimeDiff():0):0:CloudHelpers.getCurrentTimeUTC()+(c?c.getServerTimeDiff():0):0==y.time?N:Math.floor(y.time):0},y.isLive=function(){return-1==N&&!s},y.stop=function(e){console.log("[PLAYER] stop called "+e),h=i=!(s=!(F=null)),console.log("[PLAYER] self.stop: somebody call"),y._reset_vjs(),null!=f&&(f.stopWS(),p.style.display="none"),null!=C&&(C.stopWS(),p.style.display="none"),null!=v&&(v.stopWS(),p.style.display="none"),null!=_&&(_.stop(),g.style.display="none"),q.style.display="none",$.style.display="inline-block",Ie(),clearInterval(E),y._stopPolingMediaTicket(),le()},y.close=function(){y.stop("by_close"),clearInterval(y.currentTime),clearInterval(P)},y.destroy=function(){y.stop("by_destroy"),clearInterval(y.currentTime),clearInterval(P),y.vjs.dispose(),y.vjs2.dispose(),delete window._cloudPlayers[y.elid]},y.error=function(){return y.mLastError||-1},y.onError=function(e){I=e},y.onChannelStatus=function(e){T=e},y._setError=function(e){setTimeout(function(){y.stop("by_setError")},10),y.mLastError=e,I&&setTimeout(function(){I(y,e)},10)},y.setRange=function(e,o){console.warn("[PLAYER] setRange"),O=e,b=o},void 0!==e.range){var Oe=parseInt(e.range.min,10),be=parseInt(e.range.max,10);y.setRange(Oe,be)}function ke(){y.currentZoom=0;var e=y.player.getElementsByClassName("cloudplayer-controls-zoom")[0],r=y.player.getElementsByClassName("cloudplayer-controls-zoom-position")[0],o=y.player.getElementsByClassName("cloudplayer-zoom-up")[0],t=y.player.getElementsByClassName("cloudplayer-zoom-down")[0],n=y.player.getElementsByClassName("cloudplayer-zoom-progress")[0],f=y.player.getElementsByClassName("cloudplayer-zoom-position-cursor")[0],C=document.getElementById(a+"_vjs"),v=document.getElementById(a+"_vjs2"),g=y.player.getElementsByClassName("cloudplayer-webrtc")[0];CloudHelpers.isMobile()&&(e.style.display="none"),y.zoomCursorDownBool=!1,y.zoomCursorX=0,y.zoomCursorY=0,y.zoomCursorWidth=160,y.zoomCursorHeight=120,y.zoomControlsWidth=0,y.zoomControlsHeight=0,y.setNewZoom=function(e){if(30<=e&&(e=30),e<=10&&(e=10),y.currentZoom!=e){y.currentZoom=e;var o="scale("+y.currentZoom/10+")";C.style.transform=o,v.style.transform=o,g.style.transform=o,f.style.transform="scale("+10/y.currentZoom+")",n.className=n.className.replace(/zoom\d+x/g,"zoom"+Math.ceil(y.currentZoom)+"x"),r.style.display=10==y.currentZoom?"none":"",C.style.left="",C.style.top="",v.style.left="",v.style.top="",g.style.left="",g.style.top="",f.style.left="",f.style.top=""}},y.setNewZoom(10),y.zoomUp=function(){y.setNewZoom(y.currentZoom+5)},y.zoomDown=function(){y.setNewZoom(y.currentZoom-5)},y.zoomProgressDownBool=!1,y.zoomProgressDown=function(e){y.zoomProgressDownBool=!0},y.zoomProgressMove=function(e){if(1==y.zoomProgressDownBool){var o=e.pageY-CloudHelpers.getAbsolutePosition(e.currentTarget).y,r=n.offsetHeight,t=r/5;o=10*(Math.floor((r-o)/t)/2+1),y.setNewZoom(o)}},y.zoomProgressLeave=function(e){y.zoomProgressDownBool=!1},y.zoomProgressUp=function(e){if(1==y.zoomProgressDownBool){var o=e.pageY-CloudHelpers.getAbsolutePosition(e.currentTarget).y,r=n.offsetHeight,t=r/5;o=10*(Math.floor((r-o)/t)/2+1),y.setNewZoom(o)}y.zoomProgressDownBool=!1},y.zoomCursorDown=function(e){y.zoomCursorX=e.pageX,y.zoomCursorY=e.pageY,y.zoomCursorWidth=f.offsetWidth,y.zoomCursorHeight=f.offsetHeight,y.zoomControlsWidth=r.offsetWidth,y.zoomControlsHeight=r.offsetHeight,y.zoomCursorDownBool=!0},y.zoomCursorUp=function(e){console.log("zoomCursorUp"),y.zoomCursorDownBool=!1},y.zoomCursorMove=function(e){if(1==y.zoomCursorDownBool){var o=y.zoomCursorX-e.pageX,r=y.zoomCursorY-e.pageY;y.zoomCursorX=e.pageX,y.zoomCursorY=e.pageY;var t=f.offsetLeft-o,n=f.offsetTop-r,a=y.zoomControlsWidth-y.zoomCursorWidth*(10/y.currentZoom),l=y.zoomControlsHeight-y.zoomCursorHeight*(10/y.currentZoom),s=-1*a/2,i=a/2,c=-1*l/2,u=l/2;t<s&&(t=s),n<c&&(n=c),i<=t&&(t=i),u<=n&&(n=u),f.style.left=t+"px",f.style.top=n+"px";var d=y.currentZoom/10-1,m=Math.floor(t/a*d*-100),p=Math.floor(n/l*d*-100);C.style.left=m+"%",C.style.top=p+"%",v.style.left=m+"%",v.style.top=p+"%",g.style.left=m+"%",g.style.top=p+"%"}},o.onclick=y.zoomUp,t.onclick=y.zoomDown,f.addEventListener("mousedown",y.zoomCursorDown,!1),f.addEventListener("mousemove",y.zoomCursorMove,!1),f.addEventListener("mouseleave",y.zoomCursorUp,!1),f.addEventListener("mouseup",y.zoomCursorUp,!1),n.addEventListener("mousedown",y.zoomProgressDown,!1),n.addEventListener("mousemove",y.zoomProgressMove,!1),n.addEventListener("mouseleave",y.zoomProgressLeave,!1),n.addEventListener("mouseup",y.zoomProgressUp,!1)}function Ne(){var e=y.player.getElementsByClassName("cloudplayer-volume-mute")[0],o=y.player.getElementsByClassName("cloudplayer-volume-down")[0],r=y.player.getElementsByClassName("cloudplayer-volume-progress")[0],t=y.player.getElementsByClassName("cloudplayer-volume-up")[0];y.m=y.m||{},y.m.volume=.5,e.style.display="inline-block",y.m.mute?(o.style.display="none",r.style.display="none",t.style.display="none",e.classList.add("unmute")):(o.style.display="inline-block",r.style.display="inline-block",t.style.display="inline-block",e.classList.remove("unmute")),y.mute=function(){y.isAudioChannelExists()&&(y.m.mute=!y.m.mute,y.m.mute?(o.style.display="none",r.style.display="none",t.style.display="none",e.style.display="inline-block",r.className=r.className.replace(/vol\d+/g,"vol0"),e.classList.add("unmute")):(o.style.display="inline-block",r.style.display="inline-block",t.style.display="inline-block",e.style.display="inline-block",e.classList.remove("unmute"),r.className=r.className.replace(/vol\d+/g,"vol"+Math.floor(10*y.m.volume))),y.vjs.volume(y.m.mute?0:""+y.m.volume.toFixed(1)),y.vjs2.volume(y.m.mute?0:""+y.m.volume.toFixed(1)))},y.volume=function(e){if(y.isAudioChannelExists())return null==e?y.m.volume:(e=(e=1<e?1:e)<0?0:e,y.m.volume=Math.ceil(10*e)/10,y.vjs.volume(y.m.mute?0:y.m.volume.toFixed(1)),y.vjs2.volume(y.m.mute?0:y.m.volume.toFixed(1)),void(r.className=r.className.replace(/vol\d+/g,"vol"+Math.ceil(10*y.m.volume))))},y.volup=function(){y.isAudioChannelExists()&&Math.round(10*y.m.volume)<10&&(y.m.volume=y.m.volume+.1,y.vjs.volume(y.m.mute?0:y.m.volume.toFixed(1)),y.vjs2.volume(y.m.mute?0:y.m.volume.toFixed(1)),r.className=r.className.replace(/vol\d+/g,"vol"+Math.ceil(10*y.m.volume)))},y.voldown=function(){y.isAudioChannelExists()&&0<Math.round(10*y.m.volume)&&(y.m.volume=y.m.volume-.1,y.vjs.volume(y.m.mute?0:y.m.volume.toFixed(1)),y.vjs2.volume(y.m.mute?0:y.m.volume.toFixed(1)),r.className=r.className.replace(/vol\d+/g,"vol"+Math.floor(10*y.m.volume)))},e.onclick=y.mute,o.onclick=y.voldown,t.onclick=y.volup,y.vjs.ready(function(){y.isAudioChannelExists()&&(y.vjs.muted(!1),y.volume(y.m.volume))}),y.isAudioChannelExists()||(o.style.display="none",r.style.display="none",t.style.display="none",e.style.display="none")}function De(e,o){if(o.rtc)if(console.warn("webrtc0 - depracated"),m="webrtc0",X.innerHTML="Used player: WebRTC (v0)",window.location.protocol.startsWith("file"))y.player.showErrorText("Please open from browser");else{var r="https:"==location.protocol?"wss://":"ws://",t=location.hostname,n=8080;c.ServiceProviderUrl;if(o.rtc){var a=CloudHelpers.parseUri(o.rtc).protocol;"http"==a||"ws"==a?r="ws://":"https"==a||"wss"==a?r="wss://":console.warn("Unknown protocol in '"+o+"'"),t=CloudHelpers.parseUri(o.rtc).host,n=CloudHelpers.parseUri(o.rtc).port}var l=r+t+":"+n+"/";y.vjs.el().style.display="none",y.vjs2.el().style.display="none",g.style.display="none",p.style.display="block",window.CloudPlayerWebRTC0?((f=new CloudPlayerWebRTC0(p,l,o.rtmp)).onServerError=function(e){console.error("[WebRTC0] Event error ",e),de(CloudReturnCode.ERROR_WEBRTC_SERVER_ERROR),y.stop("by_webrtc0_error")},f.startWS(),Te()):console.error("Not found module CloudPlayerWebRTC0")}else de(CloudReturnCode.NOT_SUPPORTED_FORMAT)}function Le(e,o){if(o.webrtc)if(m="webrtc1",X.innerHTML="Used player: WebRTC (v1)",window.location.protocol.startsWith("file"))y.player.showErrorText("Please open from browser");else{location.protocol,location.hostname,c.ServiceProviderUrl;if(y.vjs.el().style.display="none",y.vjs2.el().style.display="none",g.style.display="none",p.style.display="block",window.CloudPlayerWebRTC){var r=CloudHelpers.promise();CloudPlayerWebRTC.version!=o.webrtc.version?(console.warn("Expected version webrtc.version (v"+o.webrtc.version+")  mismatch with included CloudPlayerWebRTC (v"+CloudPlayerWebRTC.version+")"),r=CloudHelpers.requestJS(o.webrtc.scripts.player)):r.resolve(),r.done(function(){(C=new CloudPlayerWebRTC(p,o.webrtc.connection_url,o.webrtc.ice_servers)).onServerError=function(e){console.error("[WebRTC1] Event error ",e),de(CloudReturnCode.ERROR_WEBRTC_SERVER_ERROR),y.stop("by_webrtc1_error")},C.startWS(),Te()})}else console.error("Not found module CloudPlayerWebRTC")}else de(CloudReturnCode.NOT_SUPPORTED_FORMAT)}function He(e,o){if(o.webrtc)if(m="webrtc2",X.innerHTML="Used player: WebRTC (v2)",window.location.protocol.startsWith("file"))y.player.showErrorText("Please open from browser");else if(y.vjs.el().style.display="none",y.vjs2.el().style.display="none",g.style.display="none",p.style.display="block",window.CloudPlayerWebRTC2){var r=CloudHelpers.promise();CloudPlayerWebRTC2.version!=o.webrtc.version?(console.warn("Expected version webrtc.version (v"+o.webrtc.version+")  mismatch with included CloudPlayerWebRTC (v"+CloudPlayerWebRTC2.version+")"),r=CloudHelpers.requestJS(o.webrtc.scripts.player,function(e){for(e=e.replace("CloudPlayerWebRTC =","CloudPlayerWebRTC2 =");-1!==e.indexOf("CloudPlayerWebRTC.");)e=e.replace("CloudPlayerWebRTC.","CloudPlayerWebRTC2.");return e})):r.resolve(),r.done(function(){console.log("[PLAYER] ",o.webrtc.connection_url),(v=new CloudPlayerWebRTC2(p,o.webrtc.connection_url,o.webrtc.ice_servers,{send_video:!1,send_audio:!1})).onServerError=function(e){console.error("[WebRTC2] Event error ",e),de(CloudReturnCode.ERROR_WEBRTC_SERVER_ERROR),y.stop("by_webrtc2_error")},v.startWS(),Te()})}else console.error("Not found module CloudPlayerWebRTC2");else de(CloudReturnCode.NOT_SUPPORTED_FORMAT)}function Ue(e,o){if(o.rtmp){X.innerHTML="Used player: Flash",y.vjs.ready(function(){console.log("[PLAYER] Set url (rtmp): "+o.rtmp),y.vjs.options().flash.swf=CloudSDK.flashswf||"swf/video-js-by-vxg-buff200.swf",y.vjs.src([{src:o.rtmp,type:"rtmp/mp4"}]),ce()}),y.vjs.off("ended"),y.vjs.on("ended",function(){y.stop("by_rtmp_ended")});var r=!1;y.vjs.off("loadeddata"),y.vjs.on("loadeddata",function(){console.warn("loadeddata"),r=!0,ue(),e==F?(le(),ke(),Ne(),we()):console.warn("[PLAYER]  _uniqPlay not current [loadeddata]")}),y.vjs.off("loadedmetadata"),y.vjs.on("loadedmetadata",function(){console.warn("loadedmetadata")}),setTimeout(function(){console.log("[PLAYER] Set url (rtmp) 2: "+o.rtmp),r||y.vjs.src([{src:o.rtmp,type:"rtmp/mp4"}])},5e3),Ie(),Te(),CloudHelpers.isChrome()&&!CloudHelpers.autoPlayAllowed?we():y.vjs.play()}else de(CloudReturnCode.NOT_SUPPORTED_FORMAT)}function je(e,o){var r;o.hls?y.m.useNativeHLS?(r=o).hls?(m="native-hls",X.innerHTML="Used player: NativeHLS",window.location.protocol.startsWith("file")?y.player.showErrorText("Please open from browser"):(y.vjs.el().style.display="none",y.vjs2.el().style.display="none",p.style.display="none",g.style.display="block",window.CloudPlayerNativeHLS?((_=new CloudPlayerNativeHLS(g,r.hls)).play(),Te()):console.error("[PLAYER]  Not found module CloudPlayerNativeHLS"))):de(CloudReturnCode.NOT_SUPPORTED_FORMAT):(X.innerHTML="Used player: HTML5 (hls)",m="hls",console.log("[PLAYER] Set url (hls): "+o.hls),clearInterval(E),function e(o,r){if(r==F){var t=new XMLHttpRequest;t.open("GET",o.hls),t.withCredentials=!1,t.onload=function(){if(r==F)if(200===t.status){if(r!=F)return;y._applyMediaTiket(o.hls,o.expire),y._startPolingMediaTicket(r),y.vjs.src([{src:o.hls,type:"application/x-mpegURL"}]),t=null}else if(404===t.status){if(r!=F)return void console.warn("[VXGCLOUDPLAYER] polingHLSList, camid was changed stop poling hls list, currentCmaID="+y.mSrc.getID());if(me<++l)return void de(CloudReturnCode.ERROR_STREAM_UNREACHABLE_HLS);setTimeout(function(){console.warn("Wait one sec "+o.hls),t=null,e(o,r)},1e3)}else console.error("Unhandled");else console.warn("_uniqPlay not current [_polingCameraHLSList 2]")},t.send()}else console.warn("_uniqPlay not current [_polingCameraHLSList]")}(o,e),y.vjs.off("ended"),y.vjs.on("ended",function(){y.stop("by_hls_ended")}),y.vjs.off("loadeddata"),y.vjs.on("loadeddata",function(){console.warn("loadeddata"),ue(),e==F?(le(),ke(),Ne(),we()):console.warn("_uniqPlay not current [loadeddata]")}),y.vjs.off("loadedmetadata"),y.vjs.on("loadedmetadata",function(){console.warn("loadedmetadata")}),Ie(),Te(),CloudHelpers.isChrome()&&!CloudHelpers.autoPlayAllowed?we():y.vjs.play()):de(CloudReturnCode.NOT_SUPPORTED_FORMAT)}function Me(r){if(null!=F&&r!=F)return console.warn("[_polingCameraStatus] _uniqPlay not current 1"),void clearInterval(P);if(!y.mSrc)return console.warn("[_polingCameraStatus] no source"),void clearInterval(P);if("camera"!=y.mSrc.type)return console.warn("[_polingCameraStatus] no type camera"),void clearInterval(P);var e=y.mSrc.getID(),t=y.mSrc._origJson().status;c._getAPI().getCamera2(e,{}).done(function(e){var o=e.status;if(null!=F&&r!=F)return console.warn("[_polingCameraStatus] _uniqPlay not current (2) "+r+"!="+F),void clearInterval(P);"active"!==o&&0!=y.m.waitSourceActivation&&D>y.m.waitSourceActivation&&(de(CloudReturnCode.ERROR_CAMERA_OFFLINE),D=0),t!=o&&(console.warn("switched camera status: from "+t+" to "+o+" mLiveModeAutoStart: "+h),y.mSrc._origJson().status=o,h&&("active"==o?y.play():(y.stop("by_poling_camera_status"),de(CloudReturnCode.ERROR_CAMERA_OFFLINE),xe(r))),T&&setTimeout(function(){T(y,o)},10))}).fail(function(e){console.error("[_polingCameraStatus] ",e)})}function xe(o){setTimeout(function(){h=!0,clearInterval(P),Me(o),D=100;var e=3e3;e="active"==y.mSrc._origJson().status?H:L,P=setInterval(function(){0<D&&(D+=e),Me(o)},e)},100)}y.isRange=function(){return-1!=O&&-1!=b},y.resetRange=function(){console.warn("[PLAYER] resetRange"),b=O=-1},ke(),y.isAudioChannelExists=function(){return!0},y.updateAudioStream=function(){el_info_audio_stream.style.display="none",c._getAPI().cameraMediaStreams(y.currentCamID).done(function(e){if(e.mstreams_supported&&1<e.mstreams_supported.length){for(var o in el_info_audio_stream.style.display="block",y.mstreams.audio_on="",y.mstreams.audio_off="",y.mstreams.current=e.live_ms_id,e.mstreams_supported)e.mstreams_supported[o].as_id&&e.mstreams_supported[o].vs_id?y.mstreams.audio_on=e.mstreams_supported[o].id:e.mstreams_supported[o].vs_id&&(y.mstreams.audio_off=e.mstreams_supported[o].id);y.mstreams.audio_on==y.mstreams.current?el_info_audio_stream_on.classList.add("selected"):y.mstreams.audio_off==y.mstreams.current&&el_info_audio_stream_off.classList.add("selected")}else el_info_audio_stream.style.display="none";y.isAudioChannelExists()}).fail(function(e){console.error(e),el_info_audio_stream.style.display="none"})},Ne(),y._polingLoadCameraLiveUrl=function(r){r==F?"camera"==y.mSrc.type?(y.updateAudioCaps&&y.updateAudioCaps(y.mSrc.getID()),fe="camera_live",m="",c._getAPI().cameraLiveUrls(y.mSrc.getID()).done(function(e){if(r==F){se(e);var o=1;e.webrtc&&(o=e.webrtc.version.split(".")[0],o=parseInt(o,10)),e.hls||e.rtmp||(A="webrtc"),null===A?("webrtc"==y.mPlayerFormat&&(e.rtc&&CloudHelpers.supportWebRTC()?De(0,e):e.webrtc&&1===o&&CloudHelpers.supportWebRTC()?Le(0,e):e.webrtc&&2===o&&CloudHelpers.supportWebRTC()?He(0,e):je(r,e)),"flash"==y.mPlayerFormat&&(CloudHelpers.useHls()?je(r,e):Ue(r,e)),"html5"==y.mPlayerFormat&&je(r,e)):"flash"===A?Ue(r,e):"html5"===A?je(r,e):e.rtc&&"webrtc"===A?De(0,e):e.webrtc&&1===o&&"webrtc"===A?Le(0,e):e.webrtc&&2===o&&"webrtc"===A?He(0,e):de(CloudReturnCode.NOT_SUPPORTED_FORMAT)}else console.warn("_uniqPlay not current [_polingLoadCameraLiveUrl.done]")}).fail(function(e){console.error(e),r==F?e.status&&503==e.status&&++l<y.timePolingLiveUrls?setTimeout(function(){y._polingLoadCameraLiveUrl(r)},1e3):console.error(e):console.warn("_uniqPlay not current [_polingLoadCameraLiveUrl.fail]")})):de(CloudReturnCode.ERROR_INVALID_SOURCE):console.warn("_uniqPlay not current [_polingLoadCameraLiveUrl]")},y._reset_vjs=function(){y.vjs.reset(),y.vjs.controls(!1),y.vjs.muted(!1),y.vjs.autoplay(!0),y.vjs.volume(.5),y.vjs.el().style.display="",y.vjs2.reset(),y.vjs2.controls(!1),y.vjs2.muted(!1),y.vjs2.autoplay(!0),y.vjs2.volume(.5),y.vjs2.el().style.display="none",y.volume(y.m.volume),Ie(),y._stopPolingMediaTicket()},y.isPlaying=function(){return i},y.set_controls_opacity=function(e){W.style.opacity=e,B.style.opacity=e,z.style.opacity=e,G.style.opacity=e},y.restartTimeout=function(){y.m.autohide<0?y.set_controls_opacity("0"):0!=y.m.autohide?(y.set_controls_opacity("0.7"),clearTimeout(y.timeout),y.timeout=setTimeout(function(){y.set_controls_opacity("0")},y.m.autohide)):y.set_controls_opacity("0.7")},y.player.addEventListener("mousemove",y.restartTimeout,!0),y.player.addEventListener("touchmove",y.restartTimeout,!0),y.player.addEventListener("touchstart",y.restartTimeout,!0),y.restartTimeout(),$.onclick=y.play,q.onclick=y.stop,y.size=function(e,o){console.error("[CloudPlayer] size not support")},y.initFullscreenControls=function(){var e,o,r=y.player.getElementsByClassName("cloudplayer-fullscreen")[0];y.changedFullscreen=function(){console.log("changedFullscreen"),document.webkitIsFullScreen?(e=y.player.style.height,o=y.player.style.width,y.player.style.height="100%",y.player.style.width="100%",console.log("changedFullscreen -> fullscreen")):(y.player.style.height=e,y.player.style.width=o,console.log("changedFullscreen -> NOT fullscreen"))},document.addEventListener&&(document.addEventListener("webkitfullscreenchange",y.changedFullscreen,!1),document.addEventListener("mozfullscreenchange",y.changedFullscreen,!1),document.addEventListener("fullscreenchange",y.changedFullscreen,!1),document.addEventListener("MSFullscreenChange",y.changedFullscreen,!1)),y.fullscreen=function(){console.log("fullscreen: clicked"),1==document.webkitIsFullScreen?document.webkitCancelFullScreen():document.mozFullScreen?document.mozCancelFullScreen():document.msFullscreenElement&&null!=document.msFullscreenElement?document.msExitFullscreen():y.player.mozRequestFullScreen?y.player.mozRequestFullScreen():y.player.requestFullscreen?y.player.requestFullscreen():y.player.webkitRequestFullscreen?y.player.webkitRequestFullscreen():y.player.msRequestFullscreen&&y.player.msRequestFullscreen()},r.onclick=y.fullscreen},y.initFullscreenControls(),y.initHLSMechanism=function(){y._applyMediaTiket=function(e,o){console.log("media-tiсket: old = "+y.hls_mediaticket_value),-1!=e.indexOf("?")&&(y.hls_mediaticket_value="?"+e.split("?")[1]),u=Date.parse(o+"Z"),console.log("media-tiсket: new = "+y.hls_mediaticket_value)},y._stopPolingMediaTicket=function(){clearInterval(y._polingMediaTicketInterval)},y._startPolingMediaTicket=function(t){if(y._stopPolingMediaTicket(),console.warn("_startPolingMediaTicket"),t==F){if(!videojs.Hls)return console.error("Not found hls plugin"),void de(CloudReturnCode.ERROR_NOT_FOUND_HLS_PLUGIN);videojs.Hls.xhr.beforeRequest=function(e){return e.withCredentials=!1,e},y._polingMediaTicketInterval=setInterval(function(){if(i)if(t==F){var e=(new Date).getTime()+c.getServerTimeDiff(),o=u-e;(o=Math.round(o/1e3))<30&&(console.log("media-tiсket: Updating"),"camera"==y.mSrc.type?c._getAPI().cameraLiveUrls(y.mSrc.getID()).done(function(e){t==F?(y._applyMediaTiket(e.hls,e.expire),console.log("media-tiсket: Updated")):console.warn("_uniqPlay not current [cameraLiveUrls done]")}).fail(function(e){0!=e.status&&(console.error("media-tiсket: stop poling ",e),y._stopPolingMediaTicket()),t==F||console.warn("_uniqPlay not current  [cameraLiveUrls fail]")}):"session"==y.mSrc.type&&y.mSrc.refresh().done(function(){y._applyMediaTiket(y.mSrc.getLiveUrl_HLS(),y.mSrc.getLiveUrl_Expire()),y._startPolingMediaTicket()}).fail(function(e){0!=e.status&&(console.error("media-tiсket: stop poling ",r),y._stopPolingMediaTicket())}))}else console.warn("_polingMediaTicketInterval [_uniqPlay]");else y._stopPolingMediaTicket()},1e4)}else console.warn("_uniqPlay not current [_startPolingMediaTicket]")}},y.initHLSMechanism(),window._cloudPlayers[a]=y},CloudPlayer.POSITION_LIVE=-1,window.CloudPlayerNativeHLS=function(e,o){var r=e,t=o;console.warn("[NativeHLS] canPlay: application/vnd.apple.mpegurl => ",r.canPlayType("application/vnd.apple.mpegurl")),console.warn("[NativeHLS] canPlay: application/x-mpegURL => ",r.canPlayType("application/x-mpegURL")),console.warn("[NativeHLS] canPlay: video/mp4 => ",r.canPlayType("video/mp4")),this.play=function(){0<r.children.length&&r.removeChild(r.children[0]);var e=document.createElement("source");e.src=t,e.type="video/mp4",r.append(e),r.load()},this.stop=function(){0<r.children.length&&r.removeChild(r.children[0])},r.addEventListener("abort",function(){console.warn("[NativeHLS] abort")},!0),r.addEventListener("canplay",function(){console.warn("[NativeHLS] canplay")},!0),r.addEventListener("canplaythrough",function(){console.warn("[NativeHLS] canplaythrough")},!0),r.addEventListener("durationchange",function(){console.warn("[NativeHLS] durationchange")},!0),r.addEventListener("emptied",function(){console.warn("[NativeHLS] emptied")},!0),r.addEventListener("encrypted",function(){console.warn("[NativeHLS] encrypted")},!0),r.addEventListener("ended",function(){console.warn("[NativeHLS] ended")},!0),r.addEventListener("error",function(e,o){console.error("[NativeHLS] error ",e),console.error("[NativeHLS] error ",o)},!0),r.addEventListener("interruptbegin",function(){console.warn("[NativeHLS] interruptbegin")},!0),r.addEventListener("interruptend",function(){console.warn("[NativeHLS] interruptend")},!0),r.addEventListener("loadeddata",function(){console.warn("[NativeHLS] loadeddata"),r.play()},!0),r.addEventListener("loadedmetadata",function(){console.warn("[NativeHLS] loadedmetadata")},!0),r.addEventListener("loadstart",function(){console.warn("[NativeHLS] loadstart")},!0),r.addEventListener("mozaudioavailable",function(){console.warn("[NativeHLS] mozaudioavailable")},!0),r.addEventListener("pause",function(){console.warn("[NativeHLS] pause")},!0),r.addEventListener("play",function(){console.warn("[NativeHLS] play")},!0),r.addEventListener("playing",function(){console.warn("[NativeHLS] playing")},!0),r.addEventListener("progress",function(){console.warn("[NativeHLS] progress")},!0),r.addEventListener("ratechange",function(){console.warn("[NativeHLS] ratechange")},!0),r.addEventListener("seeked",function(){console.warn("[NativeHLS] seeked")},!0),r.addEventListener("seeking",function(){console.warn("[NativeHLS] seeking")},!0),r.addEventListener("stalled",function(){console.warn("[NativeHLS] stalled")},!0),r.addEventListener("suspend",function(){console.warn("[NativeHLS] suspend")},!0),r.addEventListener("timeupdate",function(){console.warn("[NativeHLS] timeupdate")},!0),r.addEventListener("volumechange",function(){console.warn("[NativeHLS] volumechange")},!0),r.addEventListener("waiting",function(){console.warn("[NativeHLS] waiting")},!0)},window.CloudPlayerWebRTC0=function(e,o,r){var t,n=e,a=o,l=r,s=null,i={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:13.250.13.83:3478?transport=udp"],username:"YzYNCouZM1mhqhmseWk6",credential:"YzYNCouZM1mhqhmseWk6"}]},c=this,u=Math.floor(8990*Math.random()+10).toString();c.onWsError=function(e){console.error(e)},CloudHelpers.isSafari()&&navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then(function(e){console.log("[WEBRTC0] Camera permission granted")}).catch(function(e,o){console.error(e,o)}),c.resetState=function(){t.close()},c.handleIncomingError=function(e){console.error("[WEBRTC0] IncomingError: ",e),resetState()},c.resetVideoElement=function(){n.pause(),n.src="",n.load()},c.onIncomingSDP=function(e){e.sdp=e.sdp.replace(/profile-level-id=[^;]+/,"profile-level-id=42e01f"),console.log("[WEBRTC0] Incoming SDP is "+JSON.stringify(e)),s.setRemoteDescription(e).then(function(){console.log("Remote SDP set"),"offer"==e.type&&(console.log("[WEBRTC0] Got SDP offer, creating answer"),s.createAnswer().then(c.onLocalDescription).catch(function(e){console.error("[WEBRTC0] createAnswer: ",e)}))}).catch(function(e){console.error("[WEBRTC0] setRemoteDescription: ",e)})},c.onLocalDescription=function(e){console.log("[WEBRTC0] Got local description: "+JSON.stringify(e)),s.setLocalDescription(e).then(function(){console.log("[WEBRTC0] Sending SDP answer"),sdp={sdp:s.localDescription},t.send(JSON.stringify(sdp)),console.warn("[WEBRTC0] Streaming")})},c.onIncomingICE=function(e){console.log("[WEBRTC0] Incoming ICE: "+JSON.stringify(e));var o=new RTCIceCandidate(e);s.addIceCandidate(o).catch(function(e){console.error("[WEBRTC0] addIceCandidate ",e)})},c.onServerMessage=function(o){switch(console.log("[WEBRTC0] Received "+o.data),o.data){case"HELLO":return void console.log("[WEBRTC0] Registered with server, waiting for stream");default:if(o.data.startsWith("ERROR"))return void c.handleIncomingError(o.data);try{msg=JSON.parse(o.data)}catch(e){return void(e instanceof SyntaxError?handleIncomingError("Error parsing incoming JSON: "+o.data):handleIncomingError("Unknown error parsing response: "+o.data))}null==s&&c.createCall(msg),null!=msg.sdp?c.onIncomingSDP(msg.sdp):null!=msg.ice?c.onIncomingICE(msg.ice):c.handleIncomingError("Unknown incoming JSON: "+msg)}},c.stopWS=function(){t.close()},c.onServerClose=function(e){c.resetVideoElement(),null!=s&&(s.close(),s=null)},c.onServerError=function(e){console.error("[WEBRTC0] Unable to connect to server, did you add an exception for the certificate?")},c.onRemoteStreamAdded=function(e){videoTracks=e.stream.getVideoTracks(),audioTracks=e.stream.getAudioTracks(),0<videoTracks.length?(console.log("[WEBRTC0] Incoming stream: "+videoTracks.length+" video tracks and "+audioTracks.length+" audio tracks"),n.srcObject=e.stream):c.handleIncomingError("[WEBRTC0] Stream with unknown tracks added, resetting")},c.errorUserMediaHandler=function(){console.error("[WEBRTC0] Browser doesn't support getUserMedia!")},c.createCall=function(e){connect_attempts=0,(s=new RTCPeerConnection(i)).onaddstream=c.onRemoteStreamAdded,e.sdp||console.log("[WEBRTC0] WARNING: First message wasn't an SDP message!?"),s.onicecandidate=function(e){null!=e.candidate?t.send(JSON.stringify({ice:e.candidate})):console.error("[WEBRTC0] ICE Candidate was null, done")},console.log("[WEBRTC0] Created peer connection for call, waiting for SDP")},c.startWS=function(){if(c.connect_attempts++,3<c.connect_attempts)console.error("[WEBRTC0] Too many connection attempts, aborting. Refresh page to try again");else{console.log("[WEBRTC0] Connecting to server..."),loc=null,(t=new WebSocket(a)).addEventListener("open",function(e){t.send("HELLO "+u),console.log("[WEBRTC0] Registering with server"),t.send("SPAWN "+l)}),t.addEventListener("error",c.onServerError),t.addEventListener("message",c.onServerMessage),t.addEventListener("close",c.onServerClose)}}},window.CloudPlayerWebRTC=function(e,o,r){var t,n=e,a=o,l=null,s={iceServers:r},i=this;i.onWsError=function(e){console.error(e)},CloudHelpers.isSafari()&&navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then(function(e){console.log("[WEBRTC] Camera permission granted")}).catch(function(e,o){console.error(e,o)}),i.resetState=function(){t.close()},i.handleIncomingError=function(e){console.error("[WEBRTC] ERROR: "+e),resetState()},i.resetVideoElement=function(){n.pause(),n.src="",n.load()},i.onIncomingSDP=function(e){e.sdp=e.sdp.replace(/profile-level-id=[^;]+/,"profile-level-id=42e01f"),console.log("[WEBRTC] Incoming SDP is "+JSON.stringify(e)),l.setRemoteDescription(e).then(function(){console.log("Remote SDP set"),"offer"==e.type&&(console.log("[WEBRTC] Got SDP offer, creating answer"),l.createAnswer().then(i.onLocalDescription).catch(function(e){console.error("[WEBRTC] "+e)}))}).catch(function(e){console.error("[WEBRTC] "+e)})},i.onLocalDescription=function(e){console.log("[WEBRTC] Got local description: "+JSON.stringify(e)),l.setLocalDescription(e).then(function(){console.log("[WEBRTC] Sending SDP answer"),sdp={sdp:l.localDescription},t.send(JSON.stringify(sdp)),console.error("[WEBRTC] Streaming")})},i.onIncomingICE=function(e){console.log("[WEBRTC] Incoming ICE: "+JSON.stringify(e));var o=new RTCIceCandidate(e);l.addIceCandidate(o).catch(function(e){console.error("[WEBRTC] "+e)})},i.onServerMessage=function(o){switch(console.log("[WEBRTC] Received "+o.data),o.data){case"HELLO":return void console.log("[WEBRTC] Registered with server, waiting for stream");default:if(o.data.startsWith("ERROR"))return void i.handleIncomingError(o.data);try{msg=JSON.parse(o.data)}catch(e){return void(e instanceof SyntaxError?handleIncomingError("Error parsing incoming JSON: "+o.data):handleIncomingError("Unknown error parsing response: "+o.data))}null==l&&i.createCall(msg),null!=msg.sdp?i.onIncomingSDP(msg.sdp):null!=msg.ice?i.onIncomingICE(msg.ice):i.handleIncomingError("Unknown incoming JSON: "+msg)}},i.stopWS=function(){t.close()},i.onServerClose=function(e){console.error("Closed WebRTC "+e.reason),i.resetVideoElement(),null!=l&&(l.close(),l=null)},i.onServerError=function(e){console.error("[WEBRTC] Unable to connect to server, did you add an exception for the certificate?")},i.onRemoteStreamAdded=function(e){videoTracks=e.stream.getVideoTracks(),audioTracks=e.stream.getAudioTracks(),0<videoTracks.length?(console.log("[WEBRTC] Incoming stream: "+videoTracks.length+" video tracks and "+audioTracks.length+" audio tracks"),n.srcObject=e.stream):i.handleIncomingError("[WEBRTC] Stream with unknown tracks added, resetting")},i.errorUserMediaHandler=function(){console.error("[WEBRTC] Browser doesn't support getUserMedia!")},i.createCall=function(e){connect_attempts=0,(l=new RTCPeerConnection(s)).onaddstream=i.onRemoteStreamAdded,e.sdp||console.log("[WEBRTC] WARNING: First message wasn't an SDP message!?"),l.onicecandidate=function(e){null!=e.candidate?t.send(JSON.stringify({ice:e.candidate})):console.warn("[WEBRTC] ICE Candidate was null, done")},console.log("[WEBRTC] Created peer connection for call, waiting for SDP")},i.startWS=function(){if(i.connect_attempts++,3<i.connect_attempts)console.error("[WEBRTC] Too many connection attempts, aborting. Refresh page to try again");else{console.log("[WEBRTC] Connecting to server..."),loc=null,(t=new WebSocket(a)).addEventListener("open",function(e){t.send("HELLO "+window.CloudPlayerWebRTC.version),console.log("[WEBRTC] Registering with server"),t.send("SPAWN")}),t.addEventListener("error",i.onServerError),t.addEventListener("message",i.onServerMessage),t.addEventListener("close",i.onServerClose)}}},window.CloudPlayerWebRTC.version="1.0.0",window.CloudPlayerWebRTC2=function(e,o,r,t){t=t||{};var a=this;console.log("[WEBRTC2] ",t);var l=e,s="",n=o||"",i=t.send_video||!1,c=t.send_audio||!1,u={},d={iceServers:r||[]},m=!1,p=null;a.onWsError=function(e){console.error("[WEBRTC2] ",e)},a.resetState=function(){p.close()},a.handleIncomingError=function(e){console.error("[WEBRTC2] ERROR: "+e),a.resetState()},a.resetVideoElement=function(){l&&l.srcObject&&(l.pause(),l.srcObject=null,s="",l.load())},a.createWatchingConnection=function(o){connect_attempts=0,console.assert(!(o in u)),objPeer=new RTCPeerConnection(d),objPeer.strPeerUID=o,u[o]=objPeer,objPeer.onaddstream=a.onRemoteStreamAdded,objPeer.onicecandidate=function(e){null!=e.candidate?p.send(JSON.stringify({to:o,ice:e.candidate})):console.error("[WEBRTC2] ICE Candidate was null, done")},console.log("[WEBRTC2] Created peer connection for call, waiting for SDP")},a.createPublishingConnection=function(r){connect_attempts=0,console.assert(!(r in u)),m=!0,c||i?navigator.mediaDevices.getUserMedia({audio:c,video:i}).then(function(e){console.log("[WEBRTC2] Local stream successfully received");var o=new RTCPeerConnection(d);o.strPeerUID=r,(u[r]=o).onaddstream=a.onRemoteStreamAdded,o.onicecandidate=function(e){null!=e.candidate?p.send(JSON.stringify({to:r,ice:e.candidate})):console.error("[WEBRTC2] ICE Candidate was null, done")},o.onconnectionstatechange=function(e){console.error("[WEBRTC2] Connection state changed "+o.connectionState)},console.log("[WEBRTC2] Created peer connection for publishing"),o.addStream(e),console.log("[WEBRTC2] Local SDP set"),o.createOffer().then(function(e){o.setLocalDescription(e),console.log("[WEBRTC2] Sending SDP offer"),sdp={to:r,sdp:e},p.send(JSON.stringify(sdp)),console.error("[WEBRTC2] Streaming")}).catch(function(e){console.error("[WEBRTC2] ",e)})}).catch(function(e,o){console.error(e,o)}):console.error("[WEBRTC2] Publisher must send audio or video stream")},a.onIncomingSDP=function(o,r,t){console.log("[WEBRTC2] Incoming SDP from "+o+": "+JSON.stringify(t)),r.setRemoteDescription(t).then(function(){console.log("[WEBRTC2] Remote SDP set"),m?(console.assert("answer"===t.type),console.log("[WEBRTC2] Got SDP answer from "+o)):(console.assert("offer"===t.type),console.log("[WEBRTC2] Got SDP offer from "+o),onLocalDescription=function(e){console.log("[WEBRTC2] Got local description: "+JSON.stringify(e)),r.setLocalDescription(e).then(function(){console.log("[WEBRTC2] Sending SDP answer to "+o),t={to:o,sdp:r.localDescription},p.send(JSON.stringify(t)),console.error("[WEBRTC2] Streaming")})},i||c?(console.log("[WEBRTC2] Watcher is configured to send stream"),navigator.mediaDevices.getUserMedia({audio:c,video:i}).then(function(e){r.addStream(e),console.log("[WEBRTC2] Local SDP set, creating answer"),r.createAnswer().then(onLocalDescription).catch(function(e){console.error("[WEBRTC2] "+e)})})):(console.log("[WEBRTC2] Creating answer without stream sending"),r.createAnswer().then(onLocalDescription).catch(function(e){console.error("[WEBRTC2] "+e)})))}).catch(function(e){console.error("[WEBRTC2] "+e)})},a.onIncomingICE=function(e,o,r){console.log("[WEBRTC2] Incoming ICE from "+e+": "+JSON.stringify(r));var t=new RTCIceCandidate(r);o.addIceCandidate(t).catch(function(e){console.error("[WEBRTC2] "+e)})},a.onServerMessage=function(o){if(console.log("[WEBRTC2] Received "+o.data),o.data.startsWith("HELLO"))console.log("[WEBRTC2] Registered with server, waiting for stream");else{if(o.data.startsWith("SESSION_STARTED")){var e=o.data.split(" ")[1];return console.log("[WEBRTC2] Publisher "+e+" is going to start session"),void a.createWatchingConnection(e)}if(o.data.startsWith("SESSION_STOPPED")){e=o.data.split(" ")[1];return console.log("[WEBRTC2] Session of publisher "+e+" is terminated"),void(e in u&&(u[e]&&(u[e].close(),u[e]=null),delete u[e],l&&s===e&&a.resetVideoElement()))}if(o.data.startsWith("START_SESSION")){e=o.data.split(" ")[1];return console.log("[WEBRTC2] Watcher "+e+" has come and awaiting for publishing"),void a.createPublishingConnection(e)}if(o.data.startsWith("ERROR"))a.handleIncomingError(o.data);else{var r=null,t="",n=null;try{t=(r=JSON.parse(o.data)).from,n=u[t]}catch(e){return void(e instanceof SyntaxError?a.handleIncomingError("Error parsing incoming JSON: "+o.data):a.handleIncomingError("Unknown error parsing response: "+o.data))}null!=r.sdp?a.onIncomingSDP(t,n,r.sdp):null!=r.ice?a.onIncomingICE(t,n,r.ice):a.handleIncomingError("Unknown incoming JSON: "+r)}}},a.stopWS=function(){p.close()},a.onServerClose=function(e){for(strSessionPartnerPeerUID in console.error("Closed WebRTC "+e.reason),a.resetVideoElement(),u)u[strSessionPartnerPeerUID]&&(u[strSessionPartnerPeerUID].close(),u[strSessionPartnerPeerUID]=null);u={}},a.onServerError=function(e){console.error("[WEBRTC2] Unable to connect to server, did you add an exception for the certificate?")},a.onRemoteStreamAdded=function(e){videoTracks=e.stream.getVideoTracks(),audioTracks=e.stream.getAudioTracks(),0<videoTracks.length||0<audioTracks.length?(console.log("[WEBRTC2] Incoming stream: "+videoTracks.length+" video tracks and "+audioTracks.length+" audio tracks"),l&&""===s&&(l.srcObject=e.stream,s=e.currentTarget.strPeerUID)):a.handleIncomingError("[WEBRTC2] Stream with unknown tracks added, resetting")},a.errorUserMediaHandler=function(){console.error("[WEBRTC2] Browser doesn't support getUserMedia!")},a.startWS=function(){if(a.connect_attempts++,3<a.connect_attempts)console.error("[WEBRTC2] Too many connection attempts, aborting. Refresh page to try again");else{console.log("[WEBRTC2] Connecting to server..."),(p=new WebSocket(n)).addEventListener("open",function(e){p.send("HELLO "+window.CloudPlayerWebRTC2.version),console.log("[WEBRTC2] Registering with server")}),p.addEventListener("error",a.onServerError),p.addEventListener("message",a.onServerMessage),p.addEventListener("close",a.onServerClose)}}},window.CloudPlayerWebRTC2.version="2.0.0",window.CloudCameraTimelineMode={},CloudCameraTimelineMode.MINUTES_MODE={name:"MINUTES_MODE",code:0},CloudCameraTimelineMode.HOUR_MODE={name:"HOUR_MODE",code:1},CloudCameraTimelineMode.HOURS_12_MODE={name:"HOURS_12_MODE",code:2},window.CloudCameraTimelineView=function(e,o){var h=this,p=null,a=0,r=null,f=108e5,C={},t=0,v=!1,n=0,l=0,g=0,s=e,i=null,u=0,c=null,y=-1,_=-1,d=!1,m=0,P=0,I=!1,T=0,A=0,R=!1;function E(e){if(null==e||"object"!=typeof e)return e;var o=e.constructor();for(var r in e)e.hasOwnProperty(r)&&(o[r]=e[r]);return o}void 0!==(o=o||{}).calendar&&(R=1==o.calendar);var S={HOURS_12_MODE:{len_ms:324e5,step_short:18e5,step_long:9e6},HOUR_MODE:{len_ms:54e5,step_short:3e5,step_long:18e5},MINUTES_MODE:{len_ms:9e5,step_short:6e4,step_long:3e5}},w=E(S.MINUTES_MODE);if(h.elem=document.getElementById(e),null==h.elem)return console.error("[CloudCameraTimeline] Not found element"),null;if("DIV"!=h.elem.tagName)return console.error("[CloudCameraTimeline] Expected DIV tag but got "+h.elem.tagName),null;h.elem.classList.add("cloudcameratimeline"),h.elem.classList.add("green"),h.elem.classList.add("black"),h.elem.innerHTML='<div class="cloudcameratimeline-calendar" style="display: none"></div><div class="cloudcameratimeline-left"></div><div class="cloudcameratimeline-content">\t\t<div class="cloudcameratimeline-scale"></div>\t\t<div class="cloudcameratimeline-data"></div>\t\t<div class="cloudcameratimeline-cursor"></div></div></div><div class="cloudcameratimeline-right"></div><div class="cloudcameratimeline-goto-live disabled"></div>',h.left_border=Math.floor(CloudHelpers.getCurrentTimeUTC()-w.len_ms/2),h.right_border=Math.floor(h.left_border+w.len_ms);var O=h.elem.getElementsByClassName("cloudcameratimeline-content")[0],b=h.elem.getElementsByClassName("cloudcameratimeline-data")[0],k=h.elem.getElementsByClassName("cloudcameratimeline-calendar")[0],N=h.elem.getElementsByClassName("cloudcameratimeline-cursor")[0],D=h.elem.getElementsByClassName("cloudcameratimeline-scale")[0],L=h.elem.getElementsByClassName("cloudcameratimeline-goto-live")[0],H=h.elem.getElementsByClassName("cloudcameratimeline-left")[0],U=h.elem.getElementsByClassName("cloudcameratimeline-right")[0],j=null;function M(){n!=D.offsetWidth&&(n=D.offsetWidth),l=n/(h.right_border-h.left_border),g=(h.right_border-h.left_border)/n}function x(e){var o=e;return o-=o%1e3,o-=o%f}function F(){clearInterval(h._polingCursor),L.classList.remove("now"),L.classList.add("disabled")}function W(){if(null!=p&&"camera"==p.type){var e=p.getID(),o=CloudHelpers.formatUTCTime(u);if(null==r._getAPI())return;r._getAPI().storageRecordsFirst(e,o,1).done(function(e){for(var o in e.objects){var r=e.objects[o],t=CloudHelpers.parseUTCTime(r.start),n=CloudHelpers.parseUTCTime(r.end),a=x(t);x(n);C[a]||(C[a]={status:1,data:[]});var l=0,s=0;for(var i in C[a].data){(c=C[a].data[i]).end>s&&(s=c.end),c.start<t&&t-2e3<c.end&&(n>c.end?(C[a].data[i].end=n,l=1,h._eventRedrawTimeline()):l=2)}if(0==l&&s<n){var c={start:t,end:n};C[a].data.push(c),h._eventRedrawTimeline()}u<n&&(u=n+CloudHelpers.ONE_SECOND)}})}}function B(e){return Math.floor((e-h.left_border)*l)}function z(e){if(e=e||{},null!=c&&null!=c.getSource()?c.isLive()?(L.classList.remove("disabled"),L.classList.add("now")):(L.classList.remove("disabled"),L.classList.remove("now")):(L.classList.remove("now"),L.classList.add("disabled")),t<h.left_border-1e3||t>h.right_border+1e3)"none"!=N.style.display&&(N.style.display="none");else if("inline-block"!=N.style.display&&(N.style.display="inline-block"),0!=t){var o=B(t);if(-5<o&&o<n)N.style.left=o+T+"px",100*(n-o)/n<3&&("poling"!=e.sender&&"click"!=e.sender||h.isRange()||d||I||(console.log("[TIMELINE] Auto move if not user drag"),setTimeout(function(){console.log("[TIMELINE] mCursorPosition: "+t),h.moveToPosition(t)},100)));else"none"!=N.style.display&&(N.style.display="none")}else"none"!=N.style.display&&(N.style.display="none")}function $(){(new Date).getTime();var e=x(h.left_border),o=x(h.right_border)+f;if(o<e)return console.error("[ERROR] start must be more than end"),!1;if(h.isRange()){if(e<mRangeMin_Normalize)return console.error("[ERROR] Going beyond the range (start)"),!1;if(o>mRangeMax_Normalize)return console.error("[ERROR] Going beyond the range (end)"),!1}for(var r=b.getElementsByTagName("crect"),t=0,n=e;n<=o;n+=f){var a=C[n];if(a&&1==a.status)for(var l=0;l<a.data.length;l++)if(!(a.data[l].end<h.left_border||a.data[l].start>h.right_border)){var s=B(a.data[l].start),i=s+"px",c=B(a.data[l].end)-s+"px";if(t<r.length)r[t].style.display="",r[t].style.left=i,r[t].style.width=c,t++;else{var u='<crect style="left: '+i+"; width: "+c+'"></crect>';b.innerHTML+=u,t++}}}for(n=t;n<r.length;n++)"none"!=r[n].style.display&&(r[n].style.display="none")}function G(o){var e=CloudHelpers.promise(),r=C[o];return r&&1==r.status?e.resolve():null!=p?(C[o]={},C[o].status=0,C[o].data=[],p.getTimeline(o,o+f).done(function(e){C[o]&&(C[o].status=1,C[o].data=e.periods),$()}).fail(function(){C[o]&&(C[o].status=-1),e.reject()})):e.reject(),e}function q(){console.warn("_disposeTimeline"),u=0,C={},b.innerHTML="",F(),clearInterval(i),null!=j&&j.dispose()}function V(){console.warn("_changedSource"),q(),null!=c?(p=c.getSource())?(a=CloudHelpers.getOffsetTimezone(p.getTimezone()),r=p._getConn(),null!=j&&j.setSource(p),F(),h._polingCursor=setInterval(function(){t=0!=c?c.getPosition():0,z({sender:"poling"})},1e3),clearInterval(i),u=CloudHelpers.getCurrentTimeUTC()-CloudHelpers.ONE_MINUTE,i=setInterval(W,3e4)):(p=r=null,a=0):p=null,h.redrawTimeline({sender:"changed_source"})}function J(e,o){console.warn("_playerEvent ",e),"SOURCE_CHANGED"==e.name?V():"POSITION_JUMPED"==e.name&&(console.warn("POSITION_JUMPED",c),h.moveToPosition(o.new_pos))}function Z(){T=0,"none"!=H.style.display&&(T+=50),"none"!=k.style.display&&(T+=50),A=0,"none"!=U.style.display&&(A+=50),"none"!=L.style.display&&(A+=50),0==T&&(T=2),0==A&&(A=2),O.style.width="calc(100% - "+(T+A)+"px)",O.style.left=T+"px",b.style.width="calc(100% - "+(T+A)+"px)",b.style.left=T+"px",D.style.width="calc(100% - "+(T+A)+"px)",D.style.left=T+"px"}if(k.onclick=function(){null!=j&&j.toggleCalendar()},L.onclick=function(e){if(null!=c&&null!=c.getSource()){var o=L.classList.value;-1==o.indexOf("now")&&-1==o.indexOf("disabled")&&(c.setPosition(CloudPlayer.POSITION_LIVE),c.play(e),h.moveToPosition(CloudHelpers.getCurrentTimeUTC())),-1!=o.indexOf("now")&&h.moveToPosition(CloudHelpers.getCurrentTimeUTC())}},M(),h.hideCalendarButton=function(){"none"!=k.style.display&&(k.style.display="none"),Z(),h.redrawTimeline()},h.showCalendarButton=function(){"none"==k.style.display&&(k.style.display=""),Z(),h.redrawTimeline()},h.hideArrowsButtons=function(){"none"!=H.style.display&&(H.style.display="none"),"none"!=U.style.display&&(U.style.display="none"),Z(),h.redrawTimeline()},h.showArrowsButtons=function(){"none"==H.style.display&&(H.style.display=""),"none"==U.style.display&&(U.style.display=""),Z(),h.redrawTimeline()},h.hideGotoLiveButton=function(){"none"!=L.style.display&&(L.style.display="none"),Z(),h.redrawTimeline()},h.showGotoLiveButton=function(){"none"==L.style.display&&(L.style.display=""),Z(),h.redrawTimeline()},h.setPlayer=function(e){q(),c&&c.removeCallback(s),e?(null!=(c=e)?R&&((j=new CloudCameraCalendarView(c.getCalendarContent(),o)).onChangeDate=function(e,o){null!=c?(c.setPosition(e-a),h.moveToPosition(e-a),c.play(o)):console.error("[TIMELINE] player is null")}):console.error("[TIMELINE] player is null"),V(),c.addCallback(s,J)):(c=null,V())},h.setRange=function(e,o){console.warn("[TIMELINE] setRange todo"),y=e,_=o,mRangeMin_Normalize=x(e),mRangeMax_Normalize=x(o)+f,h.elem.classList.add("range"),M();var r=_-y,t=y,n=_,a=S.HOUR_MODE.len_ms;if(r<=a)h.hideArrowsButtons();else{n=y+a;var l=CloudHelpers.getCurrentTimeUTC();l<_&&y<l&&n<l&&(n=l+Math.floor(a/2),_<n&&(n=_),t=n-a)}var s=E(S.HOUR_MODE);h.animationTo(t,n,s)},h.isRange=function(){return-1!=y&&-1!=_},h.resetRange=function(){console.warn("[TIMELINE] resetRange"),_=y=-1,h.elem.classList.remove("range"),h.showArrowsButtons(),M()},h.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Spt","Oct","Nov","Dec"],h.dateFormat=function(e,o){var r="";if(h.isRange()){var t=(e=((e=Math.floor((e-y)/1e3))-e%60)/60)%60;r=("00"+(e-t)/60).slice(-2)+":"+("00"+t).slice(-2)}else{var n=new Date;n.setTime(e+a);r=("00"+n.getUTCHours()).slice(-2)+":"+("00"+n.getUTCMinutes()).slice(-2);o&&(r+=" ("+n.getUTCDate()+" "+h.months[n.getUTCMonth()]+")")}return r},h._eventRedrawTimeline=function(){setTimeout(h.redrawTimeline,10)},h.redrawTimeline=function(e){if(e=e||{},v)console.warn("redrawTimeline busy");else{v=!0,M();var o=Math.floor(h.left_border/w.step_short),r=Math.floor(h.right_border/w.step_short)+1;h.isRange()&&(h.left_border<=y?H.classList.add("disabled"):H.classList.remove("disabled"),h.right_border>=_?U.classList.add("disabled"):U.classList.remove("disabled")),D.innerHTML='<vtext id="texttimelinetest"><vtext>';var t=document.getElementById("texttimelinetest");t.innerHTML=h.dateFormat(h.left_border,!1);var n=t.clientWidth;t.innerHTML=h.dateFormat(h.left_border,!0);for(var a=t.clientWidth,l=w.step_long;l<n*g;)l+=w.step_long;var s=2*l;D.innerHTML+="<hline></hline>";for(var i=o;i<r;i++){var c=i*w.step_short,u=B(c);if(c%w.step_long==0){var d=c%s==0,m=u-(d?a:n)/2;D.innerHTML+='<vline style="left: '+u+'px"></vline>',c%l==0&&(D.innerHTML+='<vtext style="left: '+m+'px">'+h.dateFormat(c,d)+"</vtext>")}else D.innerHTML+='<vlineshort style="left: '+u+'px"></vline>'}if(z(e),null!=p)if(function(e,o){var r=x(e),t=x(o)+f;if(t<r)return console.error("[ERROR] start must be more than end"),!1;for(var n=!0,a=r;a<=t;a+=f)C[a]?1!=C[a].status&&(n=!1):n=!1;return n}(h.left_border,h.right_border))$();else{if(h.isRange()&&(h.left_border<mRangeMin_Normalize||h.right_border>mRangeMax_Normalize))return void(v=!1);!function(e,o){var r=x(e),t=x(o)+f;if(t<r)return console.error("[ERROR] start must be more than end");if(h.isRange()){if(e<mRangeMin_Normalize)return console.error("[ERROR] Going beyond the range (left)");if(t>mRangeMax_Normalize)return console.error("[ERROR] Going beyond the range (right)")}if(null!=p)for(var n=r;n<=t;n+=f){var a=C[n];(!a||a&&-1==a.status)&&G(n)}}(h.left_border,h.right_border)}v=!1}},h.redrawTimeline(),window.addEventListener("resize",function(){console.warn("resize"),h.redrawTimeline()}),h.animationTo=function(o,r,t){I=!0,t=t||w;var n=25,e=o-h.left_border,a=r-h.right_border;if(0==e&&0==a)return console.warn("Already in current position"),h.redrawTimeline({sender:"animation"}),void(I=!1);for(var l=t.step_short-w.step_short,s=t.step_long-w.step_long,i=0!=l&&0!=s,c=(h.left_border,h.right_border,[]),u=3.14/n,d=0,m=0;m<n;m++){d+=y=Math.sin(m*u),c.push({k:y})}var p=e/d,f=a/d,C=l/d,v=s/d,g=c[0].k;c[0].left=h.left_border+g*p,c[0].right=h.right_border+g*f,i&&(c[0].step_short=w.step_short+g*C,c[0].step_long=w.step_long+g*v);for(m=1;m<n;m++){var y=c[m].k;c[m].left=c[m-1].left+y*p,c[m].right=c[m-1].right+y*f,i&&(c[m].step_short=c[m-1].step_short+y*C,c[m].step_long=c[m-1].step_short+y*v)}c[n-1].left=o,c[n-1].right=r;var _=0;setTimeout(function e(){h.left_border=Math.floor(c[_].left),h.right_border=Math.floor(c[_].right),i&&(w.step_short=Math.floor(c[_].step_short),w.step_long=Math.floor(c[_].step_long)),h.redrawTimeline({sender:"animation"}),++_<n?setTimeout(e,10):(i&&(w=E(t)),h.left_border=o,h.right_border=r,h.redrawTimeline({sender:"animation"}),I=!1)},15)},h.fixBorderLimit=function(e,o){var r={};if(r.left=e,r.right=o,h.isRange())r.right>_&&(r.right=_,r.left=r.right-w.len_ms),r.left<y&&(r.left=y,r.right=r.left+w.len_ms);else{var t=CloudHelpers.getCurrentTimeUTC()+w.len_ms/2;if(r.right>t){var n=r.right-t;r.left=r.left-n,r.right=r.right-n}}return r},h.moveToRight=function(){var e=h.right_border-h.left_border;e=Math.floor(.75*e);var o=h.left_border+e,r=h.right_border+e,t=h.fixBorderLimit(o,r);h.animationTo(t.left,t.right)},U.onclick=h.moveToRight,h.moveToLeft=function(){var e=h.right_border-h.left_border;e=Math.floor(.75*e);var o=h.left_border-e,r=h.right_border-e,t=h.fixBorderLimit(o,r);h.animationTo(t.left,t.right)},H.onclick=h.moveToLeft,h.moveToPosition=function(e){console.log("moveToPosition");var o=Math.floor((h.right_border-h.left_border)/2),r=e-o,t=e+o;h.isRange()&&(r<y||_<t)?console.error("Can not move beyond range"):h.animationTo(r,t)},h.mousedown=function(e){if(!d){m=e.offsetX,P=e.offsetX,d=!0,O.style.cursor="move";try{window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}catch(e){console.error(e)}}},h.mousemove=function(e){if(d&&!h.isRange()){var o=e.offsetX-P;if(void 0!==e.movementX&&(o=e.movementX),0!=o){var r=Math.floor(o*g);P+=o;var t=h.fixBorderLimit(h.left_border-r,h.right_border-r);h.left_border=t.left,h.right_border=t.right,h.redrawTimeline({sender:"mousemove"})}}},h.mouseup=function(e){d&&(O.style.cursor="default",d=!1)},h.mouseout=function(e){if(d){if(e.relatedTarget&&"CRECT"==e.relatedTarget.nodeName||e.target&&"CRECT"==e.target.nodeName)return;if(e.relatedTarget&&"cloudcameratimeline-cursor"==e.relatedTarget.className||e.target&&"cloudcameratimeline-cursor"==e.target.className)return;O.style.cursor="default",d=!1}},O.addEventListener("mousedown",h.mousedown),O.addEventListener("mousemove",h.mousemove),O.addEventListener("mouseup",h.mouseup),O.addEventListener("mouseout",h.mouseout),b.onclick=function(e){if(null!=c)if(null!=p){if(m==P){var o=e.currentTarget.getBoundingClientRect(),r=e.clientX-o.left,t=Math.floor(r*g);(t+=h.left_border)>=CloudHelpers.getCurrentTimeUTC()&&c?(c.stop("by_timeline_1"),c.setPosition(CloudPlayer.POSITION_LIVE),c.play()):t&&c&&(c.stop("by_timeline_2"),c.setPosition(t),c.play()),z({sender:"click"})}}else console.log("[CloudCameraTimeline] source is null");else console.log("[CloudCameraTimeline] player is null")},h.setMode=function(e){var o=null;if(!S[e.name])return console.error("Unknown timeline mode"),-1;o=S[e.name];var r=(h.right_border-h.left_border)/2+h.left_border,t=E(o),n=o.len_ms/2;return h.animationTo(r-n,r+n,t),0},h.getMode=function(){return w},h.destroy=function(){clearInterval(i)},void 0!==o.arrows&&(1==o.arrows?h.showArrowsButtons():h.hideArrowsButtons()),void 0!==o.gotoLive&&(1==o.gotoLive?h.showGotoLiveButton():h.hideGotoLiveButton()),void 0!==o.range){var K=o.range.min,Y=o.range.max;h.setRange(K,Y)}R?h.showCalendarButton():h.hideCalendarButton(),console.log("options: ",o)},window.CloudCameraCalendarView=function(e,o){var t=e;o=o||{};var a=this,r=null,_={},n=null,l=null,s=(new Date).getMonth(),i=(new Date).getFullYear(),c=100*i+s,u=100*i+s;function d(e,o){return["January","February","March","April","May","June","July","August","September","October","November","December"][o%12]+" "+e}function h(e,o,r){return e+"-"+("00"+(o+1)).slice(-2)+"-"+("00"+r).slice(-2)}function m(e,o){var r=new Date;r.setFullYear(e),r.setMonth(o),r.setDate(1);for(var t=r.getDay(),n=(o-1+12)%12,a=0==o?e-1:e,l=(o+1+12)%12,s=11==o?e+1:e,i=new Date(s,l,0),c=i.getDate(),u=i.getDay(),d=new Date(a,n,0).getDate(),m=["Su","Mo","To","We","Th","Fr","Sa"],p=[],f=0;f<t;f++)p.push({d:d,cl:"disabled",dt:h(s,l,d)}),d--;for(f=1;f<=c;f++)p.push({d:f,cl:"",dt:h(e,o,f)});var C=0;for(f=u+1;f<7;f++)C++,p.push({d:C,cl:"disabled",dt:h(s,l,C)});for(f=0;f<_.length;f++)for(var v=_[f],g=0;g<p.length;g++)p[g].dt===v&&(p[g].cl+="active-day");var y='<div class="cal-row">';for(f=0;f<m.length;f++)y+='<div class="cal-day name">'+m[f]+"</div>";y+="</div>",y+='<div class="cal-row">';for(f=0;f<p.length;f++)f%7==0&&0<f&&(y+='</div><div class="cal-row">'),y+='<div class="cal-day '+p[f].cl+'" dt="'+p[f].dt+'">'+p[f].d+"</div>";return y+="</div>"}t.innerHTML='\t<div class="cloudcameracalendar-header">\t\t<div class="cloudcameracalendar-prev-month">&#9664;</div>\t\t<div class="cloudcameracalendar-title">'+d(i,s)+'</div>\t\t<div class="cloudcameracalendar-next-month">&#9654;</div>\t\t<div class="cloudcameracalendar-close"></div>\t</div>\t<div class=\'cloudcameracalendar-table\'>'+m(i,s)+"\t</div>";var p=t.getElementsByClassName("cloudcameracalendar-close")[0],f=t.getElementsByClassName("cloudcameracalendar-prev-month")[0],C=t.getElementsByClassName("cloudcameracalendar-next-month")[0],v=t.getElementsByClassName("cloudcameracalendar-table")[0],g=t.getElementsByClassName("cloudcameracalendar-title")[0];p.onclick=function(e){return e.preventDefault(),e.stopPropagation(),!(t.style.display="")},a.renderContent=function(){g.innerHTML=d(i,s),v.innerHTML=m(i,s);for(var e=t.getElementsByClassName("active-day"),o=0;o<e.length;o++)e[o].onclick=function(e){var o=this.getAttribute("dt");a.onChangeDate&&a.onChangeDate(Date.parse(o),e)};var r=100*i+s;f.style.display=r<=c?"none":"",C.style.display=u<=r?"none":""},a.renderContent(),a.updateActivity=function(){if(null==r)return console.log("[CALENDAR] mConn is null"),_=[],void a.renderContent();r._getAPI().storageActivity(n,!0).done(function(e){l=new Date,_=e.objects;for(var o=0;o<_.length;o++){var r=_[o].split("-"),t=parseInt(r[1],10)-1,n=100*parseInt(r[0],10)+t;u=0==o?c=n:(c=Math.min(n,c),Math.max(n,u))}a.renderContent()})},a.setSource=function(e){s=(new Date).getMonth(),i=(new Date).getFullYear(),(l=null)!=e?(r=e._getConn(),n=e.getID(),CloudHelpers.getOffsetTimezone(e.getTimezone()),a.updateActivity()):(r=null,0,_=[],a.renderContent())},a.dispose=function(){r=null},f.onclick=function(){(s-=1)<0&&(s=11,i-=1),a.renderContent()},C.onclick=function(){11<(s+=1)&&(s=0,i+=1),a.renderContent()},a.isVisible=function(){return""!==t.style.display},a.showCalendar=function(){if(console.log("[CALENDAR] show"),t.style.display="block",null!=r)if(null!=l){var e=new Date;e.setUTCHours(24),e.setUTCMinutes(0),e.setUTCSeconds(0),(new Date).getTime()>e.getTime()&&l.getTime()<e.getTime()&&a.updateActivity()}else a.updateActivity();else a.renderContent()},a.hideCalendar=function(){console.log("[CALENDAR] hide"),t.style.display=""},a.toggleCalendar=function(){console.log("[CALENDAR] toggle"),a.isVisible()?a.hideCalendar():a.showCalendar()}},window.CloudSessionTimeline=function(e){var y=this,m=null,o={};function _(e){if(null==e||"object"!=typeof e)return e;var o=e.constructor();for(var r in e)e.hasOwnProperty(r)&&(o[r]=e[r]);return o}o.h12={to:"min",len_ms:324e5,step_short:18e5,step_long:9e6},o.hr={to:"h12",len_ms:54e5,step_short:3e5,step_long:18e5},o.min={to:"hr",len_ms:9e5,step_short:6e4,step_long:3e5};var h=_(o.min);if(y.elem=document.getElementById(e),null==y.elem)return console.error("[CloudPlayerTimeline] Not found element"),null;if("DIV"!=y.elem.tagName)return console.error("[CloudPlayerTimeline] Expected DIV tag but got "+y.elem.tagName),null;y.elem.classList.add("cloudplayertimeline"),y.elem.classList.add("green"),y.elem.classList.add("black"),y.elem.innerHTML='<div class="cloudplayertimeline-content">\t\t<div class="cloudplayertimeline-scale session"></div>\t\t<div class="cloudplayertimeline-data session"></div>\t\t<div class="cloudplayertimeline-cursor"></div></div>',y.left_border=CloudHelpers.getCurrentTimeUTC()-h.len_ms/2,y.right_border=y.left_border+h.len_ms,y.el_data=y.elem.getElementsByClassName("cloudplayertimeline-data")[0];var p=y.elem.getElementsByClassName("cloudplayertimeline-cursor")[0];function r(){clearInterval(y._polingCursor)}y.el_scale=y.elem.getElementsByClassName("cloudplayertimeline-scale")[0],y.setPlayer=function(e){r(),y.plr=e,y.plr&&(r(),y._polingCursor=setInterval(function(){var e=y.plr.getPosition();if((e<y.left_border||e>y.right_border)&&"none"!=p.style.display&&(p.style.display="none"),"inline-block"!=p.style.display&&(p.style.display="inline-block"),0!=e){var o=y.calcPosition(e)+50+"px";p.style.left=o}},1e3))},y.calcPosition=function(e){return Math.floor((e-y.left_border)*y.distPx)},y.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Spt","Oct","Nov","Dec"],y.dateFormat=function(e,o){var r=new Date;r.setTime(e);var t=("00"+r.getUTCHours()).slice(-2)+":"+("00"+r.getUTCMinutes()).slice(-2);return o&&(t+=" ("+r.getUTCDate()+" "+y.months[r.getUTCMonth()]+")"),t},y.redrawTimeline=function(){null!=(m=null!=y.plr?y.plr.getSource():null)&&(y.left_border=m.getStartTime(),y.right_border=m.getEndTime(),h.step_short=(y.right_border-y.left_border)/20),p.style.display="none",y.containerWidth=y.el_scale.offsetWidth,y.distPx=y.containerWidth/(y.right_border-y.left_border),y.distSec=(y.right_border-y.left_border)/y.containerWidth;var e=Math.floor(y.left_border/h.step_short),o=Math.floor(y.right_border/h.step_short)+1;y.el_data.innerHTML="",y.el_scale.innerHTML='<vtext id="texttimelinetest"><vtext>';var r=document.getElementById("texttimelinetest");r.innerHTML=y.dateFormat(y.left_border,!1);var t=r.clientWidth;r.innerHTML=y.dateFormat(y.left_border,!0);for(var n=r.clientWidth,a=h.step_long;t*y.distSec>a;)a+=h.step_long;var l=2*a;y.el_scale.innerHTML+="<hline></hline>";for(var s=e;s<o;s++){var i=s*h.step_short,c=y.calcPosition(i);if(i%h.step_long==0){var u=i%l==0,d=c-(u?n:t)/2;y.el_scale.innerHTML+='<vline style="left: '+c+'px"></vline>',i%a==0&&(y.el_scale.innerHTML+='<vtext style="left: '+d+'px">'+y.dateFormat(i,u)+"</vtext>")}else y.el_scale.innerHTML+='<vlineshort style="left: '+c+'px"></vline>'}y.el_data.innerHTML="",null!=m&&m.getTimeline(y.left_border,y.right_border).done(function(e){var o=e.periods;y.el_data.innerHTML="";for(var r=0;r<o.length;r++){var t=y.calcPosition(o[r].start),n='<crect style="left: '+t+"px; width: "+(y.calcPosition(o[r].end)-t)+'px"></crect>';y.el_data.innerHTML+=n}}).fail(function(e){console.error(e)})},y.redrawTimeline(),window.addEventListener("resize",y.redrawTimeline),y.animationTo=function(e,o,r){r=r||h;for(var t=25,n=e-y.left_border,a=o-y.right_border,l=r.step_short-h.step_short,s=r.step_long-h.step_long,i=0!=l&&0!=s,c=[],u=[],d=[],m=[],p=3.14/t,f=0,C=0;C<t;C++){f+=v=Math.sin(C*p)}for(C=0;C<t;C++){var v=Math.sin(C*(3.14/t));c.push(v*(n/f)),u.push(v*(a/f)),i&&(d.push(v*(l/f)),m.push(v*(s/f)))}var g=0;setTimeout(function e(){y.left_border+=c[g],y.right_border+=u[g],i&&(h.step_short+=d[g],h.step_long+=m[g]),y.redrawTimeline(),++g<t?setTimeout(e,10):(i&&(h=_(r)),y.redrawTimeline())},15)},y.fixBorderLimit=function(e,o){var r={};r.left=e,r.right=o;var t=CloudHelpers.getCurrentTimeUTC()+h.len_ms/2;if(r.right>t){var n=r.right-t;r.left=r.left-n,r.right=r.right-n}return r},y._clickOnData=function(e){if(null!=y.plr)if(null!=m){var o=Math.floor(e.offsetX*y.distSec);(o+=y.left_border)&&y.plr&&(y.plr.stop("by_session_timeline_1"),y.plr.setPosition(o),y.plr.play())}else console.log("[CloudCameraTimeline] source is null");else console.log("[CloudCameraTimeline] player is null")},y.el_data.onclick=y._clickOnData,y._startMove=!1,y._lastMoveX=0,y.mousedown=function(e){y._lastMoveX=e.offsetX,y._startMove=!0,y.el_data.style.cursor="move"},y.mousemove=function(e){if(y._startMove){var o=e.offsetX-y._lastMoveX;if(0!=o){var r=Math.floor(o*y.distSec);y._lastMoveX=e.offsetX;var t=y.fixBorderLimit(y.left_border-r,y.right_border-r);y.left_border=t.left,y.right_border=t.right,y.redrawTimeline()}}},y.mouseup=function(e){y._startMove=!1,y.el_data.style.cursor="default"},y.el_data.addEventListener("mousedown",y.mousedown),y.el_data.addEventListener("mousemove",y.mousemove),y.el_data.addEventListener("mouseup",y.mouseup),y.el_data.addEventListener("mouseout",y.mouseup)},window.CloudSDK=window.CloudSDK||{},CloudSDK.version="2.0.52",CloudSDK.datebuild="181102",console.log("CloudSDK.version="+CloudSDK.version+"_"+CloudSDK.datebuild),window.CloudPlayerSDK=function(e,o){console.log(o);var t=this;if(t.options=o||{},t.player=null,t.conn=null,t.filter=null,t.cm=null,t.mCameraID=null,t.camera=null,t.svcp_url=null,t.sharedKey=null,t.playerElementID=null,window._CloudPlayerSDK=window._CloudPlayerSDK||{},!e||""===e)throw"Player container element ID is required.";if(t.playerElementID=e,-1===t.playerElementID.indexOf("%")&&(t.playerElementID=encodeURIComponent(t.playerElementID)),t.conn=new CloudShareConnection,window._CloudPlayerSDK[e])throw"Oops! CloudPlayerSDK instance with player element ID: "+e+" already exist. Try use another ID.";window._CloudPlayerSDK[e]={},t.player=new CloudPlayer(e,t.options),console.log("self.options: ",t.options),t.options.timeline&&(t.timeline=new CloudCameraTimelineView(t.options.timeline,t.options),t.timeline.setPlayer(t.player)),t.setSource=function(e){if(!e||""===e){var o="Access token required";return console.error(o),t.player.showErrorText(o),CloudReturnCode.ERROR_INVALID_SOURCE}try{var r=atob(e);r=JSON.parse(r),console.log("[CloudPlayerSDK] access_token: ",r),r.token&&r.camid&&r.access&&""!==r.token&&""!==r.camid&&""!==r.access&&(t.sharedKey=r.token,t.mCameraID=r.camid),r.svcp&&""!=r.svcp&&(t.svcp_url=r.svcp),r.api&&""!=r.api&&(t.svcp_url=location.protocol+"//"+r.api,"http:"==location.protocol?t.svcp_url+=r.api_p?":"+r.api_p:"":"https:"==location.protocol&&(t.svcp_url+=r.api_sp?":"+r.api_sp:""),t.svcp_url+="/")}catch(e){o="Invalid access token format";return console.error(o),t.player.showErrorText(o),CloudReturnCode.ERROR_INVALID_SOURCE}return t.player.stop("by_plrsdk_3"),null!=t.svcp_url&&(t.conn.ServiceProviderUrl=t.svcp_url),t.conn.open(t.sharedKey),t.conn?(t.cm=new CloudCameraList(t.conn),t.cm.getCamera(t.mCameraID).done(function(e){t.camera=e,t.player.setSource(t.camera),console.log(t.camera),console.log(t.camera._origJson()),t.player.play()}).fail(function(e){console.log(e),t.player.showErrorText("Channel not found")}),CloudReturnCode.OK):(t.player.showErrorText("Access token invalid"),CloudReturnCode.ERROR_NO_CLOUD_CONNECTION)},t.getSource=function(){return t.sharedKey?t.sharedKey:CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED},t.play=function(){if(!t.camera)return CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED;t.player.play()},t.stop=function(){if(!t.camera)return CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED;t.player.stop("by_plrsdk_1")},t.pause=function(){if(!t.camera)return CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED},t.close=function(){t.player.stop("by_plrsdk_2"),t.player.close(),t.player.player.innerHTML="",t.conn.close(),window._CloudPlayerSDK[e]&&delete window._CloudPlayerSDK[e]},t.destroy=function(){t.player.stop("by_plrsdk_2"),t.player.player.innerHTML="",t.player.destroy(),t.conn.close(),t.timeline&&t.timeline.destroy(),window._CloudPlayerSDK[t.playerElementID]&&delete window._CloudPlayerSDK[t.playerElementID]},t.isPlaying=function(){return t.camera?t.player.isPlaying():CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED},t.setPosition=function(e){if(!t.camera)return CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED;t.player.stop("by_plrsdk_2"),t.player.setPosition(e),t.player.play()},t.getPosition=function(){return t.camera?t.player.getPosition():CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED},t.showTimeline=function(e){return t.camera?t.timeline?(document.getElementById(t.options.timeline).style.display=e?"block":"hide",!0):(console.error(CloudReturnCode.ERROR_NOT_CONFIGURED.text),null):(console.error(CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED.text),null)},t.getChannelName=function(){return t.camera?t.camera.getName():CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED},t.setRange=function(e,o){t.player.setRange(e,o),t.timeline&&t.timeline.setRange(e,o)},t.resetRange=function(){t.player.resetRange(),t.timeline&&t.timeline.resetRange()},t.mOnError_callback=null,t.onError=function(e){e?(t.mOnError_callback=e,t.player.onError(function(e,o){t.mOnError_callback(t,o)})):t.player.onError(null)},t.mOnChannelStatus_callback=null,t.onChannelStatus=function(e){if(!e)return t.mOnChannelStatus_callback=null,void t.player.onChannelStatus(null);t.mOnChannelStatus_callback=e,t.player.onChannelStatus(function(e,o){t.mOnChannelStatus_callback(t,o)})}},window.StreamerSWF=window.StreamerSWF||{},StreamerSWF.elemId="streamer_swf",StreamerSWF.obj=void 0,StreamerSWF.log=function(e){console.log("[StreamerSWF] "+e)},StreamerSWF.warn=function(e){console.warn("[StreamerSWF] "+e)},StreamerSWF.error=function(e){console.error("[StreamerSWF] "+e)},StreamerSWF.startedPublish=function(){},StreamerSWF.stoppedPublish=function(){},StreamerSWF.showSecuritySettings=function(){},StreamerSWF.hideSecuritySettings=function(){},StreamerSWF.activityLevel=function(e){console.log("audio lvl "+e)},StreamerSWF.flash=function(){return StreamerSWF.obj?StreamerSWF.obj.vjs_activate||(StreamerSWF.obj=document.getElementById(StreamerSWF.elemId),StreamerSWF.obj||StreamerSWF.error("Element '"+StreamerSWF.elemId+"' not found"),StreamerSWF.log("reinit")):(StreamerSWF.obj=document.getElementById(StreamerSWF.elemId),StreamerSWF.obj||StreamerSWF.error("Element '"+StreamerSWF.elemId+"' not found"),StreamerSWF.log("Init")),StreamerSWF.obj},StreamerSWF.activate=function(e,o){var r=StreamerSWF.flash();if(r)if(r.vjs_activate){var t=StreamerSWF.private.is()||!1;r.vjs_activate(e,t,o)}else StreamerSWF.error("Function vjs_activate not found"),StreamerSWF.obj=void 0},StreamerSWF.support=function(){var e=StreamerSWF.flash();if(e)return e.vjs_support?e.vjs_support():(StreamerSWF.error("Function vjs_support not found"),void(StreamerSWF.obj=void 0))},StreamerSWF.status=function(){var e=StreamerSWF.flash();if(e)return e.vjs_status?e.vjs_status():(StreamerSWF.error("Function vjs_status not found"),void(StreamerSWF.obj=void 0))},StreamerSWF.deactivate=function(){var e=StreamerSWF.flash();e&&(e.vjs_deactivate?e.vjs_deactivate():(console.error("Function vjs_deactivate not found"),StreamerSWF.obj=void 0))},StreamerSWF.isActivated=function(){return"activated"==StreamerSWF.status()},StreamerSWF.isDeactivated=function(){return"deactivated"==StreamerSWF.status()},StreamerSWF.isTransitive=function(){return"transitive"==StreamerSWF.status()},StreamerSWF.private={},StreamerSWF.private.retry=function(e,o){var r=0,t=!1,n=window.setInterval(function(){e()&&(window.clearInterval(n),o(t)),50<r++&&(window.clearInterval(n),o(t=!0))},10)},StreamerSWF.private.isIE10OrLater=function(e){var o=e.toLowerCase();if(0===o.indexOf("msie")&&0===o.indexOf("trident"))return!1;var r=/(?:msie|rv:)\s?([\d\.]+)/.exec(o);if(r&&10<=parseInt(r[1],10))return!0;var t=/edge/.exec(o);return!(!t||"edge"!=t[0])},StreamerSWF.private.detectPrivateMode=function(o){var r;if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){r=!1},function(e){console.log(e),r=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var t;try{t=window.indexedDB.open("test")}catch(e){r=!0}void 0===r&&StreamerSWF.private.retry(function(){return"done"===t.readyState},function(e){e||(r=!t.result)})}else if(StreamerSWF.private.isIE10OrLater(window.navigator.userAgent)){r=!1;try{window.indexedDB||(r=!0)}catch(e){r=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(e){r=!0}void 0===r&&(r=!1,window.localStorage.removeItem("test"))}StreamerSWF.private.retry(function(){return void 0!==r},function(e){o(r)})},StreamerSWF.private.is=function(){return void 0===StreamerSWF.private.is_&&console.error("[StreamerSWF.private] cannot detect"),StreamerSWF.private.is_},StreamerSWF.private.detectPrivateMode(function(e){void 0===(StreamerSWF.private.is_=e)?console.error("[StreamerSWF.private] cannot detect"):(StreamerSWF.private.is_=e,console.log(e?"[StreamerSWF.private] private":"[StreamerSWF.private] not private"))}),window.CloudStreamerSDK=function(e,o){console.log(o);var n=this;n.options=o||{},n.conn=null,n.cm=null,n.mCameraID=null,n.camera=null,n.sharedKey=null,n.mAccessToken=null,n.streamer=document.getElementById(e),n.m={},n.conn=new CloudShareConnection,n.config={},n.config.ws_port=8888,n.config.wss_port=8883,n.config.host="cam.skyvr.videoexpertsgroup.com",n.api_host="web.skyvr.videoexpertsgroup.com",n.api_port=null;var r=n.api_security_port=null;n.streamer.classList.add("cloudstreamer"),n.streamer.classList.add("green"),n.streamer.classList.add("black"),n.streamer.innerHTML='<div class="cloudstreamer-loader" style="display: none"></div><div class="cloudstreamer-error" style="display: none">\t<div class="cloudstreamer-error-text" style="display: none"></div></div><div class="cloudstreamer-watermark"></div><div class="cloudstreamer-sdkversion">SDK '+CloudSDK.version+'</div><div class="cloudstreamer-black-screen" style="display: none">\t\t<div class="cloudstreamer-watermark"></div>\t\t<div class="cloudstreamer-sdkversion">SDK '+CloudSDK.version+'</div></div><div class="cloudplayer-controls">\t<div class="cloudplayer-stop" style="display: none"></div>\t<div class="cloudplayer-play" style="display: none"></div>\t<div class="cloudplayer-time"></div>\t<div class="cloudplayer-fullscreen"></div></div><video class="cloudstreamer-webcam-video" autoplay="true"></video>';var t=n.streamer.getElementsByClassName("cloudstreamer-loader")[0],a=n.streamer.getElementsByClassName("cloudstreamer-error")[0],l=n.streamer.getElementsByClassName("cloudstreamer-error-text")[0],s=n.streamer.getElementsByClassName("cloudstreamer-webcam-video")[0],i=n.streamer.getElementsByClassName("cloudplayer-stop")[0],c=n.streamer.getElementsByClassName("cloudplayer-play")[0],u=!1;function d(){u&&(t.style.display="none",u=!1)}n._setError=function(e){setTimeout(n.stop,10),n.mLastError=e,n.mCallback_onError&&n.mCallback_onError(n,e)},n.showErrorText=function(e){d(),a.style.display="inline-block",l.style.display="inline-block",l.innerHTML=e,i.style.display="none",c.style.display="none",s.srcObject=null},n.setSource=function(e){if(a.style.display="none",l.style.display="none",c.style.display="none",!e||""===e){var o="Access token required";return console.error(o),n.showErrorText(o),CloudReturnCode.ERROR_INVALID_SOURCE}if("https:"==location.protocol){try{var r=atob(e);r=JSON.parse(r),console.log(r),r.token&&r.camid&&r.access&&""!==r.token&&""!==r.camid&&""!==r.access&&(n.sharedKey=r.token,n.mCameraID=r.camid),r.api&&(n.api_host=r.api,console.log("self.api_host: ",n.api_host)),r.api_p&&(n.api_port=r.api_p,console.log("self.api_port: ",n.api_port)),r.api_security_port&&(n.api_security_port=r.api_security_port,console.log("self.api_security_port: ",n.api_security_port))}catch(e){o="Invalid access token format";return console.error(o),CloudReturnCode.ERROR_INVALID_SOURCE}var t=n.api_host;"web.skyvr.videoexpertsgroup.com"==n.api_host?t="https://"+n.api_host:"https:"===location.protocol?(t="https://"+n.api_host,null!=n.api_secutiry_port&&(t+=":"+n.api_secutiry_port)):"http:"===location.protocol&&(t="http://"+n.api_host,null!=n.api_secutiry_port&&(t+=":"+n.api_secutiry_port)),n.conn.ServiceProviderUrl=t+"/",n.conn.open(n.sharedKey),n.mAccessToken=e,c.style.display=""}else n.showErrorText("Streamer is not available when page not secure.")},n.getSource=function(){return n.mAccessToken?n.mAccessToken:CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED},n.start=function(){if(!n.sharedKey)return CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED;console.warn("[CloudStreamerSDK] Start"),n.stop("by_strm_sdk_1"),navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!0}).then(function(e){s.srcObject=e,n.conn&&n.conn._getAPI().cameraStreamUrls_webrtc(n.mCameraID).done(function(e){if(console.log("stream_urls: ",e),e.webrtc){var o=CloudHelpers.promise();CloudPlayerWebRTC2.version!=e.webrtc.version?(console.warn("Expected version webrtc.version (v"+e.webrtc.version+")  mismatch with included CloudPlayerWebRTC (v"+CloudPlayerWebRTC2.version+")"),o=CloudHelpers.requestJS(e.webrtc.scripts.player,function(e){for(e=e.replace("CloudPlayerWebRTC =","CloudPlayerWebRTC2 =");-1!==e.indexOf("CloudPlayerWebRTC.");)e=e.replace("CloudPlayerWebRTC.","CloudPlayerWebRTC2.");return e})):o.resolve(),o.done(function(){(r=new CloudPlayerWebRTC2(null,e.webrtc.connection_url,e.webrtc.ice_servers,{send_video:!0,send_audio:!0})).startWS(),i.style.display="",c.style.display="none"}).fail(function(e){console.error("err: ",e),n.showErrorText("Problem with protocol of streaming")})}else n.showErrorText("Channel not support webrtc streamer")}).fail(function(e){console.error("err: ",e),n.showErrorText("Channel for streaming not found")})}).catch(function(e){n.sharedKey=null,console.error(e),console.error("Something went wrong! ",e),-1!=(""+e).indexOf("Requested device not found")&&n.showErrorText("Not found camera")})},c.onclick=n.start,n.stop=function(){if(i.style.display="none",c.style.display=n.mAccessToken?"":"none",s.srcObject=null,!n.sharedKey)return CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED;try{r&&r.stopWS()}catch(e){console.error(e)}},i.onclick=n.stop,n.initFullscreenControls=function(){var e,o,r=n.streamer.getElementsByClassName("cloudplayer-fullscreen")[0];n.changedFullscreen=function(){console.log("changedFullscreen"),document.webkitIsFullScreen?(e=n.player.style.height,o=n.player.style.width,n.streamer.style.height="100%",n.streamer.style.width="100%",console.log("changedFullscreen -> fullscreen")):(n.streamer.style.height=e,n.streamer.style.width=o,console.log("changedFullscreen -> NOT fullscreen"))},document.addEventListener&&(document.addEventListener("webkitfullscreenchange",n.changedFullscreen,!1),document.addEventListener("mozfullscreenchange",n.changedFullscreen,!1),document.addEventListener("fullscreenchange",n.changedFullscreen,!1),document.addEventListener("MSFullscreenChange",n.changedFullscreen,!1)),n.fullscreen=function(){console.log("fullscreen: clicked"),1==document.webkitIsFullScreen?document.webkitCancelFullScreen():document.mozFullScreen?document.mozCancelFullScreen():document.msFullscreenElement&&null!=document.msFullscreenElement?document.msExitFullscreen():n.streamer.mozRequestFullScreen?n.streamer.mozRequestFullScreen():n.streamer.requestFullscreen?n.streamer.requestFullscreen():n.streamer.webkitRequestFullscreen?n.streamer.webkitRequestFullscreen():n.streamer.msRequestFullscreen&&n.streamer.msRequestFullscreen()},r.onclick=n.fullscreen},n.initFullscreenControls()},window.CloudStreamerFlash=function(e,o){console.log(o);var n=this;n.options=o||{},n.conn=null,n.cm=null,n.mCameraID=null,n.camera=null,n.sharedKey=null,n.mAccessToken="",n.streamer=document.getElementById(e),n.m={},n.conn=new CloudShareConnection,n.config={},n.config.ws_port=8888,n.config.wss_port=8883,n.config.host="cam.skyvr.videoexpertsgroup.com",n.streamer.classList.add("cloudstreamer"),n.streamer.classList.add("green"),n.streamer.classList.add("black"),StreamerSWF.log=function(e){console.log("[CloudStreamerFlash]",e)},StreamerSWF.error=function(e){console.error("[CloudStreamerFlash]",e)},StreamerSWF.warn=function(e){console.warn("[CloudStreamerFlash]",e)},StreamerSWF.startedPublish=function(){console.log("[CloudStreamerFlash] publishing started")},StreamerSWF.stoppedPublish=function(){console.log("[CloudStreamerFlash] publishing stopped")},StreamerSWF.activityLevel=function(e){},n.streamer.innerHTML='<div class="cloudstreamer-loader" style="display: none"></div><div class="cloudstreamer-error" style="display: none">\t<div class="cloudstreamer-error-text" style="display: none"></div></div><div class="cloudstreamer-watermark"></div><div class="cloudstreamer-sdkversion">SDK '+CloudSDK.version+'</div><div class="cloudstreamer-black-screen" style="display: none">\t\t<div class="cloudstreamer-watermark"></div>\t\t<div class="cloudstreamer-sdkversion">SDK '+CloudSDK.version+'</div></div><object class="streamer-swf" id="streamer_swf" type="application/x-shockwave-flash" data="'+CloudSDK.streamer_swf+'" width="100%" height="100%" ><param name="movie" value="'+CloudSDK.streamer_swf+'" /><embed src="'+CloudSDK.streamer_swf+'"><param name="allowScriptAccess" value="always"/><param value="allowNetworking" value="all"/><param name="wmode" value="transparent"/><param name="menu" value="false" /></object>';var r=n.streamer.getElementsByClassName("cloudstreamer-loader")[0],a=n.streamer.getElementsByClassName("cloudstreamer-error")[0],l=n.streamer.getElementsByClassName("cloudstreamer-error-text")[0];n.streamer.getElementsByClassName("streamer-swf")[0];console.log(StreamerSWF.flash()),n.onStarted=function(e){console.log("[CloudStreamerFlash] activate streaming to rtmp_url: ",e),StreamerSWF.activate(e,"PCMU")};var t=!(n.onStopped=function(){console.log("[CloudStreamerFlash] deactivate"),StreamerSWF.deactivate()});function s(){t&&(r.style.display="none",t=!1)}n._setError=function(e){setTimeout(n.stop,10),n.mLastError=e,n.mCallback_onError&&n.mCallback_onError(n,e)},n.showErrorText=function(e){s(),a.style.display="inline-block",l.style.display="inline-block",l.innerHTML=e},n.setSource=function(e){if(a.style.display="none",l.style.display="none",!e||""===e){var o="Access token required";return console.error(o),n.showErrorText(o),CloudReturnCode.ERROR_INVALID_SOURCE}if(CloudHelpers.isMobile())n.showErrorText("Mobile streamer is not available yet");else if(CloudHelpers.isChrome())n.showErrorText("Streamer is not available yet for Chrome. But you can open this page in Edge or Firefox to start streaming from your web camera.");else if(CloudHelpers.supportFlash()||!CloudHelpers.isFireFox()){if("https:"!=window.location.protocol){try{var r=atob(e);r=JSON.parse(r),console.log(r),r.token&&r.camid&&r.access&&""!==r.token&&""!==r.camid&&""!==r.access&&(n.sharedKey=r.token,n.mCameraID=r.camid),r.svcp&&""!=r.svcp&&(n.svcp_url=r.svcp,console.log("self.svcp_url: ",n.svcp_url))}catch(e){o="Invalid access token format";return console.error(o),CloudReturnCode.ERROR_INVALID_SOURCE}if(n.mAccessToken=e,null!=n.svcp_url){n.conn.ServiceProviderUrl=n.svcp_url;var t=CloudHelpers.parseUri(n.svcp_url);n.config.host=t.host}return n.conn.open(n.sharedKey),n.conn?(n.cm=new CloudCameraList(n.conn),n.cm.getCamera(n.mCameraID).done(function(e){n.mCamera=e,console.log("camera: ",n.mCamera._origJson()),n.start()}).fail(function(e){n.showErrorText("Channel for streaming not found")}),CloudReturnCode.OK):CloudReturnCode.ERROR_NO_CLOUD_CONNECTION}n.showErrorText("Streamer are not available yet with https")}else n.showErrorText("In Firefox Streamer available using by flash now.<br>Please install flash <a href='https://get.adobe.com/flashplayer' target='_blank'>https://get.adobe.com/flashplayer</a><br> or maybe enable Plugin 'Shockwave Flash' in your browser <a href='about:addons' target='_blank'>about:addons</a>.")},n.getSource=function(){return n.sharedKey?n.mAccessToken:CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED};var i=null;function c(){clearInterval(i)}n.start=function(){if(!n.mCamera)return CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED;if(!StreamerSWF.flash().vjs_activate)return c(),void(i=setInterval(function(){StreamerSWF.flash().vjs_activate&&(n.start(),c())},1e3));console.warn("[CloudStreamerFlash] Start"),n.stop("by_strm_sdk_1");var e=n.mCamera.getCameraManagerID();n.mCamera._getConn()._getAPI().resetCameraManager(e,{}).done(function(e){console.log(e),n.config.token=e.token,n.config.camid=n.mCamera.getID(),n.initWebSocket()}).fail(function(e){console.error(e)})},n.stop=function(){if(c(),!n.camera)return CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED;if(console.warn("Stop"),n.ws&&n.ws.socket)try{n.ws.socket.close()}catch(e){console.error(e)}try{StreamerSWF.deactivate()}catch(e){console.error(e)}},n.initWebSocket=function(){var e=n.config.srv||n.config.host;if(n.ws={},console.log("self.config.host: "+n.config.host),console.log("self.config.srv: "+n.config.srv),"http:"!=window.location.protocol)return"https:"==window.location.protocol?void console.error("Not supported https yet"):void console.error("Expected protocol http or https");e="ws://"+e+":"+n.config.ws_port,e+="/ctl/NEW/"+n.config.token+"/",n.ws.socket=new WebSocket(e),n.ws.socket.onopen=function(){console.log("WS Opened"),n._register()},n.ws.socket.onclose=function(e){console.log("Closed")},n.ws.socket.onmessage=function(e){console.log("Received: "+e.data);try{var o=JSON.parse(e.data),r=o.cmd;n.handlers[r]?n.handlers[r](o):console.warn("Not found handler "+r)}catch(e){console.error(e)}},n.ws.socket.onerror=function(e){console.error("Error: "+e.message)}},n.m_nMessageID=0,n.makeCommand=function(e){return n.m_nMessageID++,{cmd:e,msgid:n.m_nMessageID}},n.makeCommandDone=function(e,o,r){var t=n.makeCommand("done");return t.orig_cmd=e,t.refid=o,t.status=r,t},n._register=function(){var e=n.makeCommand("register");e.pwd="",e.reg_token=n.config.token,e.ver="0.1",e.tz="UTC",e.vendor="web",n.sendMessage(e)},n.sendMessage=function(e){n.ws.socket.send(JSON.stringify(e))},n.handlers={},n.handlers.configure=function(e){e.server&&(n.config.srv=e.server),e.uuid&&(n.config.uuid=e.uuid)},n.handlers.bye=function(e){e.reason&&"RECONNECT"==e.reason&&setTimeout(function(){n.initWebSocket()},1200)},n.handlers.hello=function(e){e.media_server&&(n.config.media_server=e.media_server),e.sid&&(n.config.sid=e.sid),e.upload_url&&(n.config.upload_url=e.upload_url),n.sendMessage(n.makeCommandDone("hello",e.msgid,"OK"));var o=n.makeCommand("cam_register");o.ip="127.0.0.1",o.uuid=n.config.uuid,o.brand="None",o.model="Unknown",o.sn="nope",o.type="cm",o.version="0",o.initial_mode="cloud",n.sendMessage(o)},n.handlers.cam_hello=function(e){n.sendMessage(n.makeCommandDone("cam_hello",e.msgid,"OK")),n.config.camid=e.cam_id,e.media_url&&(n.config.media_url=e.media_url),e.media_uri&&(n.config.media_server=e.media_uri),e.path&&(n.config.media_url=e.path)},n.handlers.get_cam_status=function(e){var o=n.makeCommand("cam_status");o.cam_id=n.config.camid,o.ip="127.0.0.1",o.activity=!0,o.streaming=!0,o.status_led=!1,n.sendMessage(o)},n.handlers.get_supported_streams=function(e){var o=n.makeCommand("supported_streams");o.cam_id=n.config.camid,o.audio_es=["Aud"],o.video_es=["Vid"],o.streams=[{id:"Main",video:"Vid",audio:"Aud"}],n.sendMessage(o)},n.stream_start_counter=0,n.handlers.stream_start=function(e){var o="rtmp://"+n.config.media_server+"/"+n.config.media_url+"Main";o+="?sid="+n.config.sid,console.log(o),0==n.stream_start_counter&&(n.stream_start_counter++,n.options.onStarted?n.options.onStarted(o):n.options.onStarted||n.onStarted(o)),n.sendMessage(n.makeCommandDone("stream_start",e.msgid,"OK"))},n.handlers.stream_stop=function(e){n.stream_start_counter--,n.sendMessage(n.makeCommandDone("stream_start",e.msgid,"OK")),0==n.stream_start_counter&&(n.options.onStopped?n.options.onStarted(stream_url):n.options.onStarted||n.onStopped())}};